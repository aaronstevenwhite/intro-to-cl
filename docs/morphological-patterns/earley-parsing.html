<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.321">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Computational Linguistics - Top-Down Parsing with Earley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../morphological-patterns/probabilistic-context-free-grammars.html" rel="next">
<link href="../morphological-patterns/cky-parsing.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../morphological-patterns/index.html">The nature of morphological patterns</a></li><li class="breadcrumb-item"><a href="../morphological-patterns/earley-parsing.html">Top-Down Parsing with Earley</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Introduction to Computational Linguistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Languages as formal objects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/multisets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multisets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/tuples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tuples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/cardinality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cardinality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/set-relations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set relations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/power-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Power Sets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/products.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Products</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/relations-and-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Relations and Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/sequences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sequences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-as-formal-objects/languages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Languages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Grammars as languages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/defining-regular-expressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Defining Regular Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/evaluating-regular-expressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluating Regular Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/loading-a-lexicon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading a Lexicon</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/basic-matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/implementing-the-regular-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementing the Regular Operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/wild-cards-and-character-ranges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wild cards and character ranges</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/quantifiers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantifiers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../grammars-as-languages/groups-and-greediness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Groups and Greediness</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Uncertainty about Languages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/what-is-a-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is a probability?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/how-we-model-possibilities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How we model possibilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/what-it-means-to-measure-a-possibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What it means to measure a possibility</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/some-useful-definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Some useful definitions</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Random Variables and Probability Distributions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/random-variables-and-probability-distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classifying probability spaces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/random-variables-and-probability-distributions/random-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/random-variables-and-probability-distributions/probability-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability distributions</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/some-more-useful-definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Some useful definitions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../uncertainty-about-languages/statistical-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Inference</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Languages in terms of Strings</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-in-terms-of-strings/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-in-terms-of-strings/distance-in-the-abstract.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance in the abstract</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../languages-in-terms-of-strings/levenshtein-distance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Levenshtein distance</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">The nature of phonological patterns</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/generation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/the-generativist-conceit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Generativist Conceit</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Formal definition</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/formal-definition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/formal-definition/two-equivalent-definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Two equivalent definitions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/formal-definition/the-regular-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The regular operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/formal-definition/translating-between-formalisms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Translating Regular Expressions to NFAs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/formal-definition/beyond-the-regular-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The intersection operation via complement</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Recognition and parsing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/recognition-and-parsing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/recognition-and-parsing/recognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recognition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/recognition-and-parsing/parsing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parsing</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
 <span class="menu-text">Phonological rules as FSAs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/phonological-rules-as-fsas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/phonological-rules-as-fsas/parsing-and-transduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parsing and Transduction Algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/phonological-rules-as-fsas/rule-formalism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phonological Rule Formalism</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Generative capacity</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/generative-capacity/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phonological-patterns/generative-capacity/pumping-lemma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Pumping Lemma for Regular Languages</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
 <span class="menu-text">The nature of morphological patterns</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of Context-Free Grammars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Operations on Context-Free Grammars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/normal-forms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal Forms for Context-Free Grammars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/cky-parsing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bottom-Up Parsing with CKY</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/earley-parsing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Top-Down Parsing with Earley</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../morphological-patterns/probabilistic-context-free-grammars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic Context-Free Grammars for Morphological Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">
 <span class="menu-text">Analysis as deduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis-as-deduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">
 <span class="menu-text">The nature of syntactic patterns</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syntactic-patterns/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignments-1-and-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments 1 and 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignments-3-and-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments 3 and 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignments-5-and-6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments 3 and 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignments-7-and-8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments 7 and 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignments-9-and-10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments 9 and 10</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/final-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#top-down-vs.-bottom-up-parsing" id="toc-top-down-vs.-bottom-up-parsing" class="nav-link active" data-scroll-target="#top-down-vs.-bottom-up-parsing">Top-Down vs.&nbsp;Bottom-Up Parsing</a></li>
  <li><a href="#dotted-rules" id="toc-dotted-rules" class="nav-link" data-scroll-target="#dotted-rules">Dotted Rules</a>
  <ul class="collapse">
  <li><a href="#earley-algorithm-pseudocode" id="toc-earley-algorithm-pseudocode" class="nav-link" data-scroll-target="#earley-algorithm-pseudocode">Earley Algorithm Pseudocode</a></li>
  </ul></li>
  <li><a href="#detailed-example-parsing-unhappiness" id="toc-detailed-example-parsing-unhappiness" class="nav-link" data-scroll-target="#detailed-example-parsing-unhappiness">Detailed Example: Parsing “unhappiness”</a>
  <ul class="collapse">
  <li><a href="#step-by-step-chart-filling" id="toc-step-by-step-chart-filling" class="nav-link" data-scroll-target="#step-by-step-chart-filling">Step-by-Step Chart Filling</a></li>
  <li><a href="#visualizing-the-chart-state" id="toc-visualizing-the-chart-state" class="nav-link" data-scroll-target="#visualizing-the-chart-state">Visualizing the Chart State</a></li>
  <li><a href="#reconstructing-the-parse-tree" id="toc-reconstructing-the-parse-tree" class="nav-link" data-scroll-target="#reconstructing-the-parse-tree">Reconstructing the Parse Tree</a></li>
  </ul></li>
  <li><a href="#handling-ambiguity-the-unlockable-example" id="toc-handling-ambiguity-the-unlockable-example" class="nav-link" data-scroll-target="#handling-ambiguity-the-unlockable-example">Handling Ambiguity: The “unlockable” Example</a></li>
  <li><a href="#the-three-operations-of-earley" id="toc-the-three-operations-of-earley" class="nav-link" data-scroll-target="#the-three-operations-of-earley">The Three Operations of Earley</a></li>
  <li><a href="#advantages-of-earley-for-morphological-analysis" id="toc-advantages-of-earley-for-morphological-analysis" class="nav-link" data-scroll-target="#advantages-of-earley-for-morphological-analysis">Advantages of Earley for Morphological Analysis</a></li>
  <li><a href="#real-world-example-predicting-next-morphemes" id="toc-real-world-example-predicting-next-morphemes" class="nav-link" data-scroll-target="#real-world-example-predicting-next-morphemes">Real-World Example: Predicting Next Morphemes</a></li>
  <li><a href="#detailed-example-parsing-unhappiness-1" id="toc-detailed-example-parsing-unhappiness-1" class="nav-link" data-scroll-target="#detailed-example-parsing-unhappiness-1">Detailed Example: Parsing “unhappiness”</a>
  <ul class="collapse">
  <li><a href="#step-by-step-chart-filling-1" id="toc-step-by-step-chart-filling-1" class="nav-link" data-scroll-target="#step-by-step-chart-filling-1">Step-by-Step Chart Filling</a></li>
  <li><a href="#visualizing-the-chart-state-1" id="toc-visualizing-the-chart-state-1" class="nav-link" data-scroll-target="#visualizing-the-chart-state-1">Visualizing the Chart State</a></li>
  <li><a href="#reconstructing-the-parse-tree-1" id="toc-reconstructing-the-parse-tree-1" class="nav-link" data-scroll-target="#reconstructing-the-parse-tree-1">Reconstructing the Parse Tree</a></li>
  </ul></li>
  <li><a href="#handling-ambiguity-the-unlockable-example-1" id="toc-handling-ambiguity-the-unlockable-example-1" class="nav-link" data-scroll-target="#handling-ambiguity-the-unlockable-example-1">Handling Ambiguity: The “unlockable” Example</a></li>
  <li><a href="#the-three-operations-of-earley-1" id="toc-the-three-operations-of-earley-1" class="nav-link" data-scroll-target="#the-three-operations-of-earley-1">The Three Operations of Earley</a></li>
  <li><a href="#advantages-of-earley-for-morphological-analysis-1" id="toc-advantages-of-earley-for-morphological-analysis-1" class="nav-link" data-scroll-target="#advantages-of-earley-for-morphological-analysis-1">Advantages of Earley for Morphological Analysis</a></li>
  <li><a href="#real-world-example-predicting-next-morphemes-1" id="toc-real-world-example-predicting-next-morphemes-1" class="nav-link" data-scroll-target="#real-world-example-predicting-next-morphemes-1">Real-World Example: Predicting Next Morphemes</a></li>
  <li><a href="#detailed-example-parsing-unhappiness-2" id="toc-detailed-example-parsing-unhappiness-2" class="nav-link" data-scroll-target="#detailed-example-parsing-unhappiness-2">Detailed Example: Parsing “unhappiness”</a>
  <ul class="collapse">
  <li><a href="#step-by-step-chart-filling-2" id="toc-step-by-step-chart-filling-2" class="nav-link" data-scroll-target="#step-by-step-chart-filling-2">Step-by-Step Chart Filling</a></li>
  <li><a href="#visualizing-the-chart-state-2" id="toc-visualizing-the-chart-state-2" class="nav-link" data-scroll-target="#visualizing-the-chart-state-2">Visualizing the Chart State</a></li>
  <li><a href="#reconstructing-the-parse-tree-2" id="toc-reconstructing-the-parse-tree-2" class="nav-link" data-scroll-target="#reconstructing-the-parse-tree-2">Reconstructing the Parse Tree</a></li>
  </ul></li>
  <li><a href="#handling-ambiguity-the-unlockable-example-2" id="toc-handling-ambiguity-the-unlockable-example-2" class="nav-link" data-scroll-target="#handling-ambiguity-the-unlockable-example-2">Handling Ambiguity: The “unlockable” Example</a></li>
  <li><a href="#the-three-operations-of-earley-2" id="toc-the-three-operations-of-earley-2" class="nav-link" data-scroll-target="#the-three-operations-of-earley-2">The Three Operations of Earley</a></li>
  <li><a href="#advantages-of-earley-for-morphological-analysis-2" id="toc-advantages-of-earley-for-morphological-analysis-2" class="nav-link" data-scroll-target="#advantages-of-earley-for-morphological-analysis-2">Advantages of Earley for Morphological Analysis</a></li>
  <li><a href="#real-world-example-predicting-next-morphemes-2" id="toc-real-world-example-predicting-next-morphemes-2" class="nav-link" data-scroll-target="#real-world-example-predicting-next-morphemes-2">Real-World Example: Predicting Next Morphemes</a></li>
  <li><a href="#the-earley-algorithm" id="toc-the-earley-algorithm" class="nav-link" data-scroll-target="#the-earley-algorithm">The Earley Algorithm</a></li>
  <li><a href="#example-parsing-unhappiness" id="toc-example-parsing-unhappiness" class="nav-link" data-scroll-target="#example-parsing-unhappiness">Example: Parsing “unhappiness”</a></li>
  <li><a href="#advantages-of-the-earley-algorithm-for-morphological-parsing" id="toc-advantages-of-the-earley-algorithm-for-morphological-parsing" class="nav-link" data-scroll-target="#advantages-of-the-earley-algorithm-for-morphological-parsing">Advantages of the Earley Algorithm for Morphological Parsing</a></li>
  <li><a href="#example-word-prediction-with-earley" id="toc-example-word-prediction-with-earley" class="nav-link" data-scroll-target="#example-word-prediction-with-earley">Example: Word Prediction with Earley</a></li>
  <li><a href="#real-world-example-celex-data" id="toc-real-world-example-celex-data" class="nav-link" data-scroll-target="#real-world-example-celex-data">Real-World Example: CELEX Data</a></li>
  <li><a href="#comparison-with-cky" id="toc-comparison-with-cky" class="nav-link" data-scroll-target="#comparison-with-cky">Comparison with CKY</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Top-Down Parsing with Earley</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In the previous section, we explored the CKY algorithm, a bottom-up parsing approach for context-free grammars. Now, we’ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</p>
<p>Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</p>
<section id="top-down-vs.-bottom-up-parsing" class="level2">
<h2 class="anchored" data-anchor-id="top-down-vs.-bottom-up-parsing">Top-Down vs.&nbsp;Bottom-Up Parsing</h2>
<p>Before diving into the Earley algorithm, let’s briefly compare top-down and bottom-up parsing approaches:</p>
<p><strong>Bottom-Up Parsing (e.g., CKY):</strong> - Starts with the input and builds larger constituents - Works well with grammars in normal forms - Typically more efficient for highly ambiguous grammars - May do unnecessary work on strings not in the language</p>
<p><strong>Top-Down Parsing:</strong> - Starts with the start symbol and tries to derive the input - More intuitive for tracing the derivation process - Can incorporate contextual constraints more easily - May get stuck in loops with left-recursive grammars</p>
<p>The Earley algorithm combines the strengths of both approaches by using a top-down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used in CKY.</p>
</section>
<section id="dotted-rules" class="level2">
<h2 class="anchored" data-anchor-id="dotted-rules">Dotted Rules</h2>
<p>The key concept in the Earley algorithm is the “dotted rule” (also called an “Earley item”). A dotted rule is a context-free rule with a dot (•) inserted somewhere on the right-hand side to indicate how much of the rule has been recognized so far.</p>
<p>For example, if we have the rule <code>N -&gt; Adj Suffix</code>, we can have the following dotted rules: - <code>N -&gt; • Adj Suffix</code> (nothing recognized yet) - <code>N -&gt; Adj • Suffix</code> (Adj recognized, Suffix expected) - <code>N -&gt; Adj Suffix •</code> (everything recognized)</p>
<p>Dotted rules also track their span (the portion of the input they cover) and any backpointers needed for reconstructing the parse tree.</p>
<section id="earley-algorithm-pseudocode" class="level3">
<h3 class="anchored" data-anchor-id="earley-algorithm-pseudocode">Earley Algorithm Pseudocode</h3>
<p>Here’s a formal pseudocode for the Earley algorithm:</p>
<pre data-code-line-numbers=""><code>function Earley(grammar, input):
    n = length(input)
    
    # Initialize the chart (n+1 sets of dotted rules)
    chart = new Array[n+1]
    for i = 0 to n:
        chart[i] = new Set()
    
    # Initialize chart[0] with dotted rules for the start symbol
    for each rule S -&gt; γ in grammar (where S is the start symbol):
        add (S -&gt; • γ, 0) to chart[0]
    
    # Fill in the chart
    for i = 0 to n:
        for each state (A -&gt; α • β, j) in chart[i]:
            if β is not empty:
                if β starts with a terminal symbol a:
                    if i &lt; n and input[i] = a:  # Scan
                        add (A -&gt; α a • β', j) to chart[i+1]
                else if β starts with a non-terminal B:  # Predict
                    for each rule B -&gt; γ in grammar:
                        add (B -&gt; • γ, i) to chart[i]
            else:  # Complete
                for each state (C -&gt; δ • A ζ, k) in chart[j]:
                    add (C -&gt; δ A • ζ, k) to chart[i]
        
        # Continue processing chart[i] until no more items can be added
        repeat until chart[i] doesn't change:
            apply Predict and Complete operations to all items in chart[i]
    
    # Check if the start symbol can derive the entire input
    return any item (S -&gt; γ •, 0) in chart[n] where S is the start symbol</code></pre>
<p>For parsing (as opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.</p>
<p>Let’s define a <code>DottedRule</code> class that will be the core of our Earley parser:</p>
<div class="sourceCode" id="cb2" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete the next symbol in this rule</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">        DottedRule</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">            A new dotted rule with the dot advanced</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s define the chart and chart entry classes for the Earley algorithm:</p>
<div class="sourceCode" id="cb3" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart entry for a Earley chart</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    dotted_rule</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    backpointers</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete this entry with another entry</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry that completes this one</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChartEntry</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co">            A new entry with the dot advanced</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if this entry completes another entry</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">        other : EarleyChartEntry</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to check</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">            True if this entry completes the other entry</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart for an Earley parser</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="co">    input_size</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Construct the parses implied by the chart</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to construct the parse from</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="co">        Tree</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="co">            The parse tree</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s the implementation of the <code>EarleyParser</code> class:</p>
<div class="sourceCode" id="cb4" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An Earley parser</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    grammar : ContextFreeGrammar</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Fill the chart using the Earley algorithm</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">        string : list[str]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChart</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">            The filled chart</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to predict from</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="co">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to scan from</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="co">            The completed entry</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="co">        Parse a string to find all possible parse trees</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="co">        set[Tree]</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="co">            The set of all possible parse trees</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="co">        Recognize whether a string is in the language</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to recognize</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="co">            True if the string is in the language, False otherwise</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="detailed-example-parsing-unhappiness" class="level2">
<h2 class="anchored" data-anchor-id="detailed-example-parsing-unhappiness">Detailed Example: Parsing “unhappiness”</h2>
<p>Let’s walk through a detailed example of the Earley algorithm parsing the word “unhappiness” with the segmentation <code>["un", "happy", "ness"]</code> using our simplified grammar:</p>
<div class="sourceCode" id="cb5" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="step-by-step-chart-filling" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-chart-filling">Step-by-Step Chart Filling</h3>
<p>Let’s trace the Earley algorithm as it fills the chart for “unhappiness”:</p>
<section id="chart0-initial-state" class="level4">
<h4 class="anchored" data-anchor-id="chart0-initial-state">Chart[0]: Initial State</h4>
<p>First, we initialize chart[0] with a dotted rule for the start symbol <code>Word</code>:</p>
<ol type="1">
<li>Add <code>Word -&gt; • N [0,0]</code> (from start symbol rule)</li>
<li>Apply predict:
<ul>
<li>For <code>Word -&gt; • N</code>:
<ul>
<li>Add <code>N -&gt; • Adj Suffix [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>N -&gt; • Adj Suffix</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [0,0]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [0,0]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[0] now looks like:</p>
<pre data-code-line-numbers=""><code>Word -&gt; • N [0,0]
N -&gt; • Adj Suffix [0,0]
Adj -&gt; • happy [0,0]
Adj -&gt; • Prefix Adj [0,0]
Prefix -&gt; • un [0,0]</code></pre>
</section>
<section id="chart1-after-processing-un" class="level4">
<h4 class="anchored" data-anchor-id="chart1-after-processing-un">Chart[1]: After Processing “un”</h4>
<p>Now we process the first input symbol “un”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Prefix -&gt; • un [0,0]</code>:
<ul>
<li>Add <code>Prefix -&gt; un • [0,1]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Prefix -&gt; un • [0,1]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; • Prefix Adj [0,0]</code> waiting for Prefix</li>
<li>Add <code>Adj -&gt; Prefix • Adj [0,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>Adj -&gt; Prefix • Adj [0,1]</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [1,1]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [1,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj [1,1]</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [1,1]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[1] now looks like:</p>
<pre data-code-line-numbers=""><code>Prefix -&gt; un • [0,1]
Adj -&gt; Prefix • Adj [0,1]
Adj -&gt; • happy [1,1]
Adj -&gt; • Prefix Adj [1,1]
Prefix -&gt; • un [1,1]</code></pre>
</section>
<section id="chart2-after-processing-happy" class="level4">
<h4 class="anchored" data-anchor-id="chart2-after-processing-happy">Chart[2]: After Processing “happy”</h4>
<p>Now we process the second input symbol “happy”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Adj -&gt; • happy [1,1]</code>:
<ul>
<li>Add <code>Adj -&gt; happy • [1,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Adj -&gt; happy • [1,2]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; Prefix • Adj [0,1]</code> waiting for Adj</li>
<li>Add <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete):
<ul>
<li>Find <code>N -&gt; • Adj Suffix [0,0]</code> waiting for Adj</li>
<li>Add <code>N -&gt; Adj • Suffix [0,2]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>N -&gt; Adj • Suffix [0,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; • ness [2,2]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[2] now looks like:</p>
<pre data-code-line-numbers=""><code>Adj -&gt; happy • [1,2]
Adj -&gt; Prefix Adj • [0,2]
N -&gt; Adj • Suffix [0,2]
Suffix -&gt; • ness [2,2]</code></pre>
</section>
<section id="chart3-after-processing-ness" class="level4">
<h4 class="anchored" data-anchor-id="chart3-after-processing-ness">Chart[3]: After Processing “ness”</h4>
<p>Finally, we process the third input symbol “ness”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Suffix -&gt; • ness [2,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; ness • [2,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Suffix -&gt; ness • [2,3]</code> (complete):
<ul>
<li>Find <code>N -&gt; Adj • Suffix [0,2]</code> waiting for Suffix</li>
<li>Add <code>N -&gt; Adj Suffix • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>N -&gt; Adj Suffix • [0,3]</code> (complete):
<ul>
<li>Find <code>Word -&gt; • N [0,0]</code> waiting for N</li>
<li>Add <code>Word -&gt; N • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
</ol>
<p>Chart[3] now looks like:</p>
<pre data-code-line-numbers=""><code>Suffix -&gt; ness • [2,3]
N -&gt; Adj Suffix • [0,3]
Word -&gt; N • [0,3]</code></pre>
<p>Since there’s a completed dotted rule for the start symbol <code>Word</code> that spans the entire input (0 to 3), the word “unhappiness” is in the language defined by our grammar.</p>
</section>
</section>
<section id="visualizing-the-chart-state" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-chart-state">Visualizing the Chart State</h3>
<p>We can visualize the entire chart as follows:</p>
<pre data-code-line-numbers=""><code>|-----------------------|--------------------------|--------------------------|--------------------------|
|      Chart[0]         |        Chart[1]          |        Chart[2]          |        Chart[3]          |
|-----------------------|--------------------------|--------------------------|--------------------------|
| Word -&gt; • N [0,0]     | Prefix -&gt; un • [0,1]     | Adj -&gt; happy • [1,2]     | Suffix -&gt; ness • [2,3]   |
| N -&gt; • Adj Suffix [0,0]| Adj -&gt; Prefix • Adj [0,1]| Adj -&gt; Prefix Adj • [0,2]| N -&gt; Adj Suffix • [0,3]  |
| Adj -&gt; • happy [0,0]  | Adj -&gt; • happy [1,1]     | N -&gt; Adj • Suffix [0,2]  | Word -&gt; N • [0,3]        |
| Adj -&gt; • Prefix Adj [0,0]| Adj -&gt; • Prefix Adj [1,1]| Suffix -&gt; • ness [2,2]   |                        |
| Prefix -&gt; • un [0,0]  | Prefix -&gt; • un [1,1]     |                         |                        |
|-----------------------|--------------------------|--------------------------|--------------------------|</code></pre>
</section>
<section id="reconstructing-the-parse-tree" class="level3">
<h3 class="anchored" data-anchor-id="reconstructing-the-parse-tree">Reconstructing the Parse Tree</h3>
<p>From the completed dotted rule <code>Word -&gt; N • [0,3]</code> in Chart[3], we can reconstruct the parse tree by following the backpointers:</p>
<ol type="1">
<li>Start with <code>Word -&gt; N • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>N -&gt; Adj Suffix • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>Adj -&gt; Prefix Adj • [0,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Prefix -&gt; un • [0,1]</code> in Chart[1]</li>
<li>Follow the backpointer to <code>Adj -&gt; happy • [1,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Suffix -&gt; ness • [2,3]</code> in Chart[3]</li>
</ol>
<p>This gives us the parse tree:</p>
<pre data-code-line-numbers=""><code>       Word
        |
        N
       / \
     Adj  Suffix
    /  \    |
Prefix Adj  ness
   |    |
  un  happy</code></pre>
<p>This tree correctly captures the structure <code>((un+happy)+ness)</code>.</p>
</section>
</section>
<section id="handling-ambiguity-the-unlockable-example" class="level2">
<h2 class="anchored" data-anchor-id="handling-ambiguity-the-unlockable-example">Handling Ambiguity: The “unlockable” Example</h2>
<p>Let’s revisit the ambiguous word “unlockable”, which has two possible interpretations:</p>
<ol type="1">
<li><code>un + (lock + able)</code> = “not able to be locked”</li>
<li><code>(un + lock) + able</code> = “able to be unlocked”</li>
</ol>
<p>With the Earley algorithm, we can handle this ambiguity naturally. Let’s create a grammar that captures both interpretations:</p>
<div class="sourceCode" id="cb12" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we parse “unlockable” with Earley, we’ll end up with two completed dotted rules in the final chart:</p>
<ol type="1">
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; Prefix Adj • [0,3]</code> (un + lockable)</li>
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; V Suffix • [0,3]</code> (unlock + able)</li>
</ol>
<p>Both of these analyses derive <code>Word</code>, resulting in two different parse trees:</p>
<p>Parse Tree 1 (un + lockable):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
Prefix  Adj
  |    /  \
 un    V  Suffix
       |    |
     lock  able</code></pre>
<p>Parse Tree 2 (unlock + able):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
  V    Suffix
 / \     |
Prefix V able
  |   |
 un lock</code></pre>
<p>The Earley algorithm finds all possible parses, which is essential for accurately analyzing structurally ambiguous words.</p>
</section>
<section id="the-three-operations-of-earley" class="level2">
<h2 class="anchored" data-anchor-id="the-three-operations-of-earley">The Three Operations of Earley</h2>
<p>The Earley algorithm consists of three main operations:</p>
<ol type="1">
<li><p><strong>Predict</strong>: For each dotted rule where the dot precedes a non-terminal, add new dotted rules for all possible expansions of that non-terminal. This operation looks ahead to determine what might come next.</p></li>
<li><p><strong>Scan</strong>: For each dotted rule where the dot precedes a terminal that matches the current input symbol, advance the dot past that terminal. This operation represents recognizing an input symbol.</p></li>
<li><p><strong>Complete</strong>: For each dotted rule where the dot is at the end (indicating a completed constituent), go back to the chart position where the constituent began and advance the dot in all dotted rules that were waiting for this constituent.</p></li>
</ol>
<p>These operations work together to efficiently parse the input while avoiding redundant work.</p>
</section>
<section id="advantages-of-earley-for-morphological-analysis" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-earley-for-morphological-analysis">Advantages of Earley for Morphological Analysis</h2>
<p>The Earley algorithm offers several advantages for morphological analysis:</p>
<ol type="1">
<li><p><strong>Any CFG</strong>: Unlike CKY, Earley works with any context-free grammar, including those with ε-rules (empty productions), unary rules, and arbitrary rule lengths. This allows for more natural expression of morphological patterns.</p></li>
<li><p><strong>Incremental processing</strong>: Earley processes the input left-to-right, which can be useful for interactive applications or streaming inputs.</p></li>
<li><p><strong>Left recursion</strong>: Earley handles left-recursive rules without modification, which is important for certain morphological patterns.</p></li>
<li><p><strong>Explicit predictions</strong>: The predict operation explicitly lists all the possible continuations at each position, which can be useful for generating suggestions in applications like spelling correction or auto-completion.</p></li>
<li><p><strong>Efficiency</strong>: While the worst-case complexity is O(n³), for many practical grammars Earley performs better, especially for unambiguous or nearly unambiguous grammars.</p></li>
</ol>
</section>
<section id="real-world-example-predicting-next-morphemes" class="level2">
<h2 class="anchored" data-anchor-id="real-world-example-predicting-next-morphemes">Real-World Example: Predicting Next Morphemes</h2>
<p>One interesting application of the Earley algorithm is predicting what could come next in a partial word. Let’s extend our <code>EarleyParser</code> class to support prediction:</p>
<div class="sourceCode" id="cb15" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Predict possible next words given a prefix</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">    prefix : list[str]</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    dict[str, set[str]]</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol].add(rule.right_<span class="op">---</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co">### Earley Algorithm Pseudocode</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s a formal pseudocode for the Earley algorithm:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>function Earley(grammar, input): n = length(input)</p>
<pre data-code-line-numbers=""><code># Initialize the chart (n+1 sets of dotted rules)
chart = new Array[n+1]
for i = 0 to n:
    chart[i] = new Set()

# Initialize chart[0] with dotted rules for the start symbol
for each rule S -&gt; γ in grammar (where S is the start symbol):
    add (S -&gt; • γ, 0) to chart[0]

# Fill in the chart
for i = 0 to n:
    for each state (A -&gt; α • β, j) in chart[i]:
        if β is not empty:
            if β starts with a terminal symbol a:
                if i &lt; n and input[i] = a:  # Scan
                    add (A -&gt; α a • β', j) to chart[i+1]
            else if β starts with a non-terminal B:  # Predict
                for each rule B -&gt; γ in grammar:
                    add (B -&gt; • γ, i) to chart[i]
        else:  # Complete
            for each state (C -&gt; δ • A ζ, k) in chart[j]:
                add (C -&gt; δ A • ζ, k) to chart[i]
    
    # Continue processing chart[i] until no more items can be added
    repeat until chart[i] doesn't change:
        apply Predict and Complete operations to all items in chart[i]

# Check if the start symbol can derive the entire input
return any item (S -&gt; γ •, 0) in chart[n] where S is the start symbol</code></pre>
<pre data-code-line-numbers=""><code>
For parsing (as opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.

Let's define a `DottedRule` class that will be the core of our Earley parser:

```python
class DottedRule(Rule):
    
    def __init__(self, rule: Rule, span: SpanIndices, dot: int = 0):
        self._rule = rule
        self._left_side = rule.left_side
        self._right_side = rule.right_side
        
        self._span = span
        self._dot = dot
    
    def to_tuple(self) -&gt; tuple[Rule, SpanIndices, int]:
        return self._rule, self._span, self._dot
    
    def __hash__(self) -&gt; int:
        return hash(self.to_tuple())
    
    def __eq__(self, other) -&gt; bool:
        return self.to_tuple() == other.to_tuple()
    
    def __repr__(self) -&gt; str:
        return self._left_side + ' -&gt; ' +\
               ' '.join(self._right_side[:self._dot]) +\
               ' . ' +\
               ' '.join(self._right_side[self._dot:]) +\
               ' [' + str(self._span[0]) + ', ' + str(self._span[1]) + ']'
    
    def complete(self, new_left_edge: int) -&gt; 'DottedRule':
        """Complete the next symbol in this rule
        
        Parameters
        ----------
        new_left_edge : int
            The new left edge of the span
        
        Returns
        -------
        DottedRule
            A new dotted rule with the dot advanced
        """
        dot = self._dot + 1
        span = (self._span[0], new_left_edge)
        
        return DottedRule(self._rule, span, dot)

    @property
    def next_symbol(self) -&gt; str:
        if self.is_complete:
            raise AttributeError('dotted rule is already complete')
        else:
            return self._right_side[self._dot]
        
    @property
    def dot(self) -&gt; int:
        return self._dot
    
    @property
    def span(self) -&gt; SpanIndices:
        return self._span
    
    @property
    def is_complete(self) -&gt; bool:
        return self._dot == len(self._right_side)
    
    @property
    def left_side(self) -&gt; str:
        return self._rule.left_side</code></pre>
<p>Now, let’s define the chart and chart entry classes for the Earley algorithm:</p>
<div class="sourceCode" id="cb18" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart entry for a Earley chart</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    dotted_rule</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    backpointers</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete this entry with another entry</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry that completes this one</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChartEntry</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="co">            A new entry with the dot advanced</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if this entry completes another entry</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="co">        other : EarleyChartEntry</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to check</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="co">            True if this entry completes the other entry</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart for an Earley parser</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="co">    input_size</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Construct the parses implied by the chart</span></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to construct the parse from</span></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a><span class="co">        Tree</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="co">            The parse tree</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s the implementation of the <code>EarleyParser</code> class:</p>
<div class="sourceCode" id="cb19" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An Earley parser</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    grammar : ContextFreeGrammar</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Fill the chart using the Earley algorithm</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">        string : list[str]</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChart</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">            The filled chart</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to predict from</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="co">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to scan from</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a><span class="co">            The completed entry</span></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a><span class="co">        Parse a string to find all possible parse trees</span></span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a><span class="co">        set[Tree]</span></span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a><span class="co">            The set of all possible parse trees</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a><span class="co">        Recognize whether a string is in the language</span></span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to recognize</span></span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a><span class="co">            True if the string is in the language, False otherwise</span></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="detailed-example-parsing-unhappiness-1" class="level2">
<h2 class="anchored" data-anchor-id="detailed-example-parsing-unhappiness-1">Detailed Example: Parsing “unhappiness”</h2>
<p>Let’s walk through a detailed example of the Earley algorithm parsing the word “unhappiness” with the segmentation <code>["un", "happy", "ness"]</code> using our simplified grammar:</p>
<div class="sourceCode" id="cb20" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="step-by-step-chart-filling-1" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-chart-filling-1">Step-by-Step Chart Filling</h3>
<p>Let’s trace the Earley algorithm as it fills the chart for “unhappiness”:</p>
<section id="chart0-initial-state-1" class="level4">
<h4 class="anchored" data-anchor-id="chart0-initial-state-1">Chart[0]: Initial State</h4>
<p>First, we initialize chart[0] with a dotted rule for the start symbol <code>Word</code>:</p>
<ol type="1">
<li>Add <code>Word -&gt; • N [0,0]</code> (from start symbol rule)</li>
<li>Apply predict:
<ul>
<li>For <code>Word -&gt; • N</code>:
<ul>
<li>Add <code>N -&gt; • Adj Suffix [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>N -&gt; • Adj Suffix</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [0,0]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [0,0]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[0] now looks like:</p>
<pre data-code-line-numbers=""><code>Word -&gt; • N [0,0]
N -&gt; • Adj Suffix [0,0]
Adj -&gt; • happy [0,0]
Adj -&gt; • Prefix Adj [0,0]
Prefix -&gt; • un [0,0]</code></pre>
</section>
<section id="chart1-after-processing-un-1" class="level4">
<h4 class="anchored" data-anchor-id="chart1-after-processing-un-1">Chart[1]: After Processing “un”</h4>
<p>Now we process the first input symbol “un”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Prefix -&gt; • un [0,0]</code>:
<ul>
<li>Add <code>Prefix -&gt; un • [0,1]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Prefix -&gt; un • [0,1]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; • Prefix Adj [0,0]</code> waiting for Prefix</li>
<li>Add <code>Adj -&gt; Prefix • Adj [0,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>Adj -&gt; Prefix • Adj [0,1]</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [1,1]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [1,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj [1,1]</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [1,1]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[1] now looks like:</p>
<pre data-code-line-numbers=""><code>Prefix -&gt; un • [0,1]
Adj -&gt; Prefix • Adj [0,1]
Adj -&gt; • happy [1,1]
Adj -&gt; • Prefix Adj [1,1]
Prefix -&gt; • un [1,1]</code></pre>
</section>
<section id="chart2-after-processing-happy-1" class="level4">
<h4 class="anchored" data-anchor-id="chart2-after-processing-happy-1">Chart[2]: After Processing “happy”</h4>
<p>Now we process the second input symbol “happy”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Adj -&gt; • happy [1,1]</code>:
<ul>
<li>Add <code>Adj -&gt; happy • [1,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Adj -&gt; happy • [1,2]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; Prefix • Adj [0,1]</code> waiting for Adj</li>
<li>Add <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete):
<ul>
<li>Find <code>N -&gt; • Adj Suffix [0,0]</code> waiting for Adj</li>
<li>Add <code>N -&gt; Adj • Suffix [0,2]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>N -&gt; Adj • Suffix [0,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; • ness [2,2]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[2] now looks like:</p>
<pre data-code-line-numbers=""><code>Adj -&gt; happy • [1,2]
Adj -&gt; Prefix Adj • [0,2]
N -&gt; Adj • Suffix [0,2]
Suffix -&gt; • ness [2,2]</code></pre>
</section>
<section id="chart3-after-processing-ness-1" class="level4">
<h4 class="anchored" data-anchor-id="chart3-after-processing-ness-1">Chart[3]: After Processing “ness”</h4>
<p>Finally, we process the third input symbol “ness”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Suffix -&gt; • ness [2,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; ness • [2,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Suffix -&gt; ness • [2,3]</code> (complete):
<ul>
<li>Find <code>N -&gt; Adj • Suffix [0,2]</code> waiting for Suffix</li>
<li>Add <code>N -&gt; Adj Suffix • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>N -&gt; Adj Suffix • [0,3]</code> (complete):
<ul>
<li>Find <code>Word -&gt; • N [0,0]</code> waiting for N</li>
<li>Add <code>Word -&gt; N • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
</ol>
<p>Chart[3] now looks like:</p>
<pre data-code-line-numbers=""><code>Suffix -&gt; ness • [2,3]
N -&gt; Adj Suffix • [0,3]
Word -&gt; N • [0,3]</code></pre>
<p>Since there’s a completed dotted rule for the start symbol <code>Word</code> that spans the entire input (0 to 3), the word “unhappiness” is in the language defined by our grammar.</p>
</section>
</section>
<section id="visualizing-the-chart-state-1" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-chart-state-1">Visualizing the Chart State</h3>
<p>We can visualize the entire chart as follows:</p>
<pre data-code-line-numbers=""><code>|-----------------------|--------------------------|--------------------------|--------------------------|
|      Chart[0]         |        Chart[1]          |        Chart[2]          |        Chart[3]          |
|-----------------------|--------------------------|--------------------------|--------------------------|
| Word -&gt; • N [0,0]     | Prefix -&gt; un • [0,1]     | Adj -&gt; happy • [1,2]     | Suffix -&gt; ness • [2,3]   |
| N -&gt; • Adj Suffix [0,0]| Adj -&gt; Prefix • Adj [0,1]| Adj -&gt; Prefix Adj • [0,2]| N -&gt; Adj Suffix • [0,3]  |
| Adj -&gt; • happy [0,0]  | Adj -&gt; • happy [1,1]     | N -&gt; Adj • Suffix [0,2]  | Word -&gt; N • [0,3]        |
| Adj -&gt; • Prefix Adj [0,0]| Adj -&gt; • Prefix Adj [1,1]| Suffix -&gt; • ness [2,2]   |                        |
| Prefix -&gt; • un [0,0]  | Prefix -&gt; • un [1,1]     |                         |                        |
|-----------------------|--------------------------|--------------------------|--------------------------|</code></pre>
</section>
<section id="reconstructing-the-parse-tree-1" class="level3">
<h3 class="anchored" data-anchor-id="reconstructing-the-parse-tree-1">Reconstructing the Parse Tree</h3>
<p>From the completed dotted rule <code>Word -&gt; N • [0,3]</code> in Chart[3], we can reconstruct the parse tree by following the backpointers:</p>
<ol type="1">
<li>Start with <code>Word -&gt; N • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>N -&gt; Adj Suffix • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>Adj -&gt; Prefix Adj • [0,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Prefix -&gt; un • [0,1]</code> in Chart[1]</li>
<li>Follow the backpointer to <code>Adj -&gt; happy • [1,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Suffix -&gt; ness • [2,3]</code> in Chart[3]</li>
</ol>
<p>This gives us the parse tree:</p>
<pre data-code-line-numbers=""><code>       Word
        |
        N
       / \
     Adj  Suffix
    /  \    |
Prefix Adj  ness
   |    |
  un  happy</code></pre>
<p>This tree correctly captures the structure <code>((un+happy)+ness)</code>.</p>
</section>
</section>
<section id="handling-ambiguity-the-unlockable-example-1" class="level2">
<h2 class="anchored" data-anchor-id="handling-ambiguity-the-unlockable-example-1">Handling Ambiguity: The “unlockable” Example</h2>
<p>Let’s revisit the ambiguous word “unlockable”, which has two possible interpretations:</p>
<ol type="1">
<li><code>un + (lock + able)</code> = “not able to be locked”</li>
<li><code>(un + lock) + able</code> = “able to be unlocked”</li>
</ol>
<p>With the Earley algorithm, we can handle this ambiguity naturally. Let’s create a grammar that captures both interpretations:</p>
<div class="sourceCode" id="cb27" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we parse “unlockable” with Earley, we’ll end up with two completed dotted rules in the final chart:</p>
<ol type="1">
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; Prefix Adj • [0,3]</code> (un + lockable)</li>
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; V Suffix • [0,3]</code> (unlock + able)</li>
</ol>
<p>Both of these analyses derive <code>Word</code>, resulting in two different parse trees:</p>
<p>Parse Tree 1 (un + lockable):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
Prefix  Adj
  |    /  \
 un    V  Suffix
       |    |
     lock  able</code></pre>
<p>Parse Tree 2 (unlock + able):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
  V    Suffix
 / \     |
Prefix V able
  |   |
 un lock</code></pre>
<p>The Earley algorithm finds all possible parses, which is essential for accurately analyzing structurally ambiguous words.</p>
</section>
<section id="the-three-operations-of-earley-1" class="level2">
<h2 class="anchored" data-anchor-id="the-three-operations-of-earley-1">The Three Operations of Earley</h2>
<p>The Earley algorithm consists of three main operations:</p>
<ol type="1">
<li><p><strong>Predict</strong>: For each dotted rule where the dot precedes a non-terminal, add new dotted rules for all possible expansions of that non-terminal. This operation looks ahead to determine what might come next.</p></li>
<li><p><strong>Scan</strong>: For each dotted rule where the dot precedes a terminal that matches the current input symbol, advance the dot past that terminal. This operation represents recognizing an input symbol.</p></li>
<li><p><strong>Complete</strong>: For each dotted rule where the dot is at the end (indicating a completed constituent), go back to the chart position where the constituent began and advance the dot in all dotted rules that were waiting for this constituent.</p></li>
</ol>
<p>These operations work together to efficiently parse the input while avoiding redundant work.</p>
</section>
<section id="advantages-of-earley-for-morphological-analysis-1" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-earley-for-morphological-analysis-1">Advantages of Earley for Morphological Analysis</h2>
<p>The Earley algorithm offers several advantages for morphological analysis:</p>
<ol type="1">
<li><p><strong>Any CFG</strong>: Unlike CKY, Earley works with any context-free grammar, including those with ε-rules (empty productions), unary rules, and arbitrary rule lengths. This allows for more natural expression of morphological patterns.</p></li>
<li><p><strong>Incremental processing</strong>: Earley processes the input left-to-right, which can be useful for interactive applications or streaming inputs.</p></li>
<li><p><strong>Left recursion</strong>: Earley handles left-recursive rules without modification, which is important for certain morphological patterns.</p></li>
<li><p><strong>Explicit predictions</strong>: The predict operation explicitly lists all the possible continuations at each position, which can be useful for generating suggestions in applications like spelling correction or auto-completion.</p></li>
<li><p><strong>Efficiency</strong>: While the worst-case complexity is O(n³), for many practical grammars Earley performs better, especially for unambiguous or nearly unambiguous grammars.</p></li>
</ol>
</section>
<section id="real-world-example-predicting-next-morphemes-1" class="level2">
<h2 class="anchored" data-anchor-id="real-world-example-predicting-next-morphemes-1">Real-World Example: Predicting Next Morphemes</h2>
<p>One interesting application of the Earley algorithm is predicting what could come next in a partial word. Let’s extend our <code>EarleyParser</code> class to support prediction:</p>
<div class="sourceCode" id="cb30" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Predict possible next words given a prefix</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    prefix : list[str]</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">    dict[str, set[str]]</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>            next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol].add(rule.right_side[<span class="dv">0</span>])</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">---</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a><span class="co">### Earley Algorithm Pseudocode</span></span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s a formal pseudocode for the Earley algorithm:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>function Earley(grammar, input): n = length(input)</p>
<pre data-code-line-numbers=""><code># Initialize the chart (n+1 sets of dotted rules)
chart = new Array[n+1]
for i = 0 to n:
    chart[i] = new Set()

# Initialize chart[0] with dotted rules for the start symbol
for each rule S -&gt; γ in grammar (where S is the start symbol):
    add (S -&gt; • γ, 0) to chart[0]

# Fill in the chart
for i = 0 to n:
    for each state (A -&gt; α • β, j) in chart[i]:
        if β is not empty:
            if β starts with a terminal symbol a:
                if i &lt; n and input[i] = a:  # Scan
                    add (A -&gt; α a • β', j) to chart[i+1]
            else if β starts with a non-terminal B:  # Predict
                for each rule B -&gt; γ in grammar:
                    add (B -&gt; • γ, i) to chart[i]
        else:  # Complete
            for each state (C -&gt; δ • A ζ, k) in chart[j]:
                add (C -&gt; δ A • ζ, k) to chart[i]
    
    # Continue processing chart[i] until no more items can be added
    repeat until chart[i] doesn't change:
        apply Predict and Complete operations to all items in chart[i]

# Check if the start symbol can derive the entire input
return any item (S -&gt; γ •, 0) in chart[n] where S is the start symbol</code></pre>
<pre data-code-line-numbers=""><code>
For parsing (as opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.

Let's define a `DottedRule` class that will be the core of our Earley parser:

```python
class DottedRule(Rule):
    
    def __init__(self, rule: Rule, span: SpanIndices, dot: int = 0):
        self._rule = rule
        self._left_side = rule.left_side
        self._right_side = rule.right_side
        
        self._span = span
        self._dot = dot
    
    def to_tuple(self) -&gt; tuple[Rule, SpanIndices, int]:
        return self._rule, self._span, self._dot
    
    def __hash__(self) -&gt; int:
        return hash(self.to_tuple())
    
    def __eq__(self, other) -&gt; bool:
        return self.to_tuple() == other.to_tuple()
    
    def __repr__(self) -&gt; str:
        return self._left_side + ' -&gt; ' +\
               ' '.join(self._right_side[:self._dot]) +\
               ' . ' +\
               ' '.join(self._right_side[self._dot:]) +\
               ' [' + str(self._span[0]) + ', ' + str(self._span[1]) + ']'
    
    def complete(self, new_left_edge: int) -&gt; 'DottedRule':
        """Complete the next symbol in this rule
        
        Parameters
        ----------
        new_left_edge : int
            The new left edge of the span
        
        Returns
        -------
        DottedRule
            A new dotted rule with the dot advanced
        """
        dot = self._dot + 1
        span = (self._span[0], new_left_edge)
        
        return DottedRule(self._rule, span, dot)

    @property
    def next_symbol(self) -&gt; str:
        if self.is_complete:
            raise AttributeError('dotted rule is already complete')
        else:
            return self._right_side[self._dot]
        
    @property
    def dot(self) -&gt; int:
        return self._dot
    
    @property
    def span(self) -&gt; SpanIndices:
        return self._span
    
    @property
    def is_complete(self) -&gt; bool:
        return self._dot == len(self._right_side)
    
    @property
    def left_side(self) -&gt; str:
        return self._rule.left_side</code></pre>
<p>Now, let’s define the chart and chart entry classes for the Earley algorithm:</p>
<div class="sourceCode" id="cb33" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart entry for a Earley chart</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">    dotted_rule</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">    backpointers</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete this entry with another entry</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry that completes this one</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChartEntry</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="co">            A new entry with the dot advanced</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if this entry completes another entry</span></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a><span class="co">        other : EarleyChartEntry</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to check</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a><span class="co">            True if this entry completes the other entry</span></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart for an Earley parser</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a><span class="co">    input_size</span></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Construct the parses implied by the chart</span></span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to construct the parse from</span></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb33-135"><a href="#cb33-135" aria-hidden="true" tabindex="-1"></a><span class="co">        Tree</span></span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a><span class="co">            The parse tree</span></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb33-144"><a href="#cb33-144" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb33-145"><a href="#cb33-145" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s the implementation of the <code>EarleyParser</code> class:</p>
<div class="sourceCode" id="cb34" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An Earley parser</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">    grammar : ContextFreeGrammar</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Fill the chart using the Earley algorithm</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">        string : list[str]</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChart</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co">            The filled chart</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to predict from</span></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a><span class="co">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to scan from</span></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="co">            The completed entry</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a><span class="co">        Parse a string to find all possible parse trees</span></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a><span class="co">        set[Tree]</span></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a><span class="co">            The set of all possible parse trees</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a><span class="co">        Recognize whether a string is in the language</span></span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to recognize</span></span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a><span class="co">            True if the string is in the language, False otherwise</span></span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="detailed-example-parsing-unhappiness-2" class="level2">
<h2 class="anchored" data-anchor-id="detailed-example-parsing-unhappiness-2">Detailed Example: Parsing “unhappiness”</h2>
<p>Let’s walk through a detailed example of the Earley algorithm parsing the word “unhappiness” with the segmentation <code>["un", "happy", "ness"]</code> using our simplified grammar:</p>
<div class="sourceCode" id="cb35" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="step-by-step-chart-filling-2" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-chart-filling-2">Step-by-Step Chart Filling</h3>
<p>Let’s trace the Earley algorithm as it fills the chart for “unhappiness”:</p>
<section id="chart0-initial-state-2" class="level4">
<h4 class="anchored" data-anchor-id="chart0-initial-state-2">Chart[0]: Initial State</h4>
<p>First, we initialize chart[0] with a dotted rule for the start symbol <code>Word</code>:</p>
<ol type="1">
<li>Add <code>Word -&gt; • N [0,0]</code> (from start symbol rule)</li>
<li>Apply predict:
<ul>
<li>For <code>Word -&gt; • N</code>:
<ul>
<li>Add <code>N -&gt; • Adj Suffix [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>N -&gt; • Adj Suffix</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [0,0]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [0,0]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [0,0]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[0] now looks like:</p>
<pre data-code-line-numbers=""><code>Word -&gt; • N [0,0]
N -&gt; • Adj Suffix [0,0]
Adj -&gt; • happy [0,0]
Adj -&gt; • Prefix Adj [0,0]
Prefix -&gt; • un [0,0]</code></pre>
</section>
<section id="chart1-after-processing-un-2" class="level4">
<h4 class="anchored" data-anchor-id="chart1-after-processing-un-2">Chart[1]: After Processing “un”</h4>
<p>Now we process the first input symbol “un”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Prefix -&gt; • un [0,0]</code>:
<ul>
<li>Add <code>Prefix -&gt; un • [0,1]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Prefix -&gt; un • [0,1]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; • Prefix Adj [0,0]</code> waiting for Prefix</li>
<li>Add <code>Adj -&gt; Prefix • Adj [0,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>Adj -&gt; Prefix • Adj [0,1]</code>:
<ul>
<li>Add <code>Adj -&gt; • happy [1,1]</code></li>
<li>Add <code>Adj -&gt; • Prefix Adj [1,1]</code></li>
</ul></li>
</ul></li>
<li>Apply predict again:
<ul>
<li>For <code>Adj -&gt; • Prefix Adj [1,1]</code>:
<ul>
<li>Add <code>Prefix -&gt; • un [1,1]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[1] now looks like:</p>
<pre data-code-line-numbers=""><code>Prefix -&gt; un • [0,1]
Adj -&gt; Prefix • Adj [0,1]
Adj -&gt; • happy [1,1]
Adj -&gt; • Prefix Adj [1,1]
Prefix -&gt; • un [1,1]</code></pre>
</section>
<section id="chart2-after-processing-happy-2" class="level4">
<h4 class="anchored" data-anchor-id="chart2-after-processing-happy-2">Chart[2]: After Processing “happy”</h4>
<p>Now we process the second input symbol “happy”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Adj -&gt; • happy [1,1]</code>:
<ul>
<li>Add <code>Adj -&gt; happy • [1,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Adj -&gt; happy • [1,2]</code> (complete):
<ul>
<li>Find <code>Adj -&gt; Prefix • Adj [0,1]</code> waiting for Adj</li>
<li>Add <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete):
<ul>
<li>Find <code>N -&gt; • Adj Suffix [0,0]</code> waiting for Adj</li>
<li>Add <code>N -&gt; Adj • Suffix [0,2]</code></li>
</ul></li>
</ul></li>
<li>Apply predict:
<ul>
<li>For <code>N -&gt; Adj • Suffix [0,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; • ness [2,2]</code></li>
</ul></li>
</ul></li>
</ol>
<p>Chart[2] now looks like:</p>
<pre data-code-line-numbers=""><code>Adj -&gt; happy • [1,2]
Adj -&gt; Prefix Adj • [0,2]
N -&gt; Adj • Suffix [0,2]
Suffix -&gt; • ness [2,2]</code></pre>
</section>
<section id="chart3-after-processing-ness-2" class="level4">
<h4 class="anchored" data-anchor-id="chart3-after-processing-ness-2">Chart[3]: After Processing “ness”</h4>
<p>Finally, we process the third input symbol “ness”:</p>
<ol type="1">
<li>Apply scan:
<ul>
<li>For <code>Suffix -&gt; • ness [2,2]</code>:
<ul>
<li>Add <code>Suffix -&gt; ness • [2,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete:
<ul>
<li>For <code>Suffix -&gt; ness • [2,3]</code> (complete):
<ul>
<li>Find <code>N -&gt; Adj • Suffix [0,2]</code> waiting for Suffix</li>
<li>Add <code>N -&gt; Adj Suffix • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
<li>Apply complete again:
<ul>
<li>For <code>N -&gt; Adj Suffix • [0,3]</code> (complete):
<ul>
<li>Find <code>Word -&gt; • N [0,0]</code> waiting for N</li>
<li>Add <code>Word -&gt; N • [0,3]</code> (complete)</li>
</ul></li>
</ul></li>
</ol>
<p>Chart[3] now looks like:</p>
<pre data-code-line-numbers=""><code>Suffix -&gt; ness • [2,3]
N -&gt; Adj Suffix • [0,3]
Word -&gt; N • [0,3]</code></pre>
<p>Since there’s a completed dotted rule for the start symbol <code>Word</code> that spans the entire input (0 to 3), the word “unhappiness” is in the language defined by our grammar.</p>
</section>
</section>
<section id="visualizing-the-chart-state-2" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-chart-state-2">Visualizing the Chart State</h3>
<p>We can visualize the entire chart as follows:</p>
<pre data-code-line-numbers=""><code>|-----------------------|--------------------------|--------------------------|--------------------------|
|      Chart[0]         |        Chart[1]          |        Chart[2]          |        Chart[3]          |
|-----------------------|--------------------------|--------------------------|--------------------------|
| Word -&gt; • N [0,0]     | Prefix -&gt; un • [0,1]     | Adj -&gt; happy • [1,2]     | Suffix -&gt; ness • [2,3]   |
| N -&gt; • Adj Suffix [0,0]| Adj -&gt; Prefix • Adj [0,1]| Adj -&gt; Prefix Adj • [0,2]| N -&gt; Adj Suffix • [0,3]  |
| Adj -&gt; • happy [0,0]  | Adj -&gt; • happy [1,1]     | N -&gt; Adj • Suffix [0,2]  | Word -&gt; N • [0,3]        |
| Adj -&gt; • Prefix Adj [0,0]| Adj -&gt; • Prefix Adj [1,1]| Suffix -&gt; • ness [2,2]   |                        |
| Prefix -&gt; • un [0,0]  | Prefix -&gt; • un [1,1]     |                         |                        |
|-----------------------|--------------------------|--------------------------|--------------------------|</code></pre>
</section>
<section id="reconstructing-the-parse-tree-2" class="level3">
<h3 class="anchored" data-anchor-id="reconstructing-the-parse-tree-2">Reconstructing the Parse Tree</h3>
<p>From the completed dotted rule <code>Word -&gt; N • [0,3]</code> in Chart[3], we can reconstruct the parse tree by following the backpointers:</p>
<ol type="1">
<li>Start with <code>Word -&gt; N • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>N -&gt; Adj Suffix • [0,3]</code> in Chart[3]</li>
<li>Follow the backpointer to <code>Adj -&gt; Prefix Adj • [0,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Prefix -&gt; un • [0,1]</code> in Chart[1]</li>
<li>Follow the backpointer to <code>Adj -&gt; happy • [1,2]</code> in Chart[2]</li>
<li>Follow the backpointer to <code>Suffix -&gt; ness • [2,3]</code> in Chart[3]</li>
</ol>
<p>This gives us the parse tree:</p>
<pre data-code-line-numbers=""><code>       Word
        |
        N
       / \
     Adj  Suffix
    /  \    |
Prefix Adj  ness
   |    |
  un  happy</code></pre>
<p>This tree correctly captures the structure <code>((un+happy)+ness)</code>.</p>
</section>
</section>
<section id="handling-ambiguity-the-unlockable-example-2" class="level2">
<h2 class="anchored" data-anchor-id="handling-ambiguity-the-unlockable-example-2">Handling Ambiguity: The “unlockable” Example</h2>
<p>Let’s revisit the ambiguous word “unlockable”, which has two possible interpretations:</p>
<ol type="1">
<li><code>un + (lock + able)</code> = “not able to be locked”</li>
<li><code>(un + lock) + able</code> = “able to be unlocked”</li>
</ol>
<p>With the Earley algorithm, we can handle this ambiguity naturally. Let’s create a grammar that captures both interpretations:</p>
<div class="sourceCode" id="cb42" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we parse “unlockable” with Earley, we’ll end up with two completed dotted rules in the final chart:</p>
<ol type="1">
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; Prefix Adj • [0,3]</code> (un + lockable)</li>
<li><code>Word -&gt; Adj • [0,3]</code> where Adj comes from <code>Adj -&gt; V Suffix • [0,3]</code> (unlock + able)</li>
</ol>
<p>Both of these analyses derive <code>Word</code>, resulting in two different parse trees:</p>
<p>Parse Tree 1 (un + lockable):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
Prefix  Adj
  |    /  \
 un    V  Suffix
       |    |
     lock  able</code></pre>
<p>Parse Tree 2 (unlock + able):</p>
<pre data-code-line-numbers=""><code>    Word
     |
    Adj
   /   \
  V    Suffix
 / \     |
Prefix V able
  |   |
 un lock</code></pre>
<p>The Earley algorithm finds all possible parses, which is essential for accurately analyzing structurally ambiguous words.</p>
</section>
<section id="the-three-operations-of-earley-2" class="level2">
<h2 class="anchored" data-anchor-id="the-three-operations-of-earley-2">The Three Operations of Earley</h2>
<p>The Earley algorithm consists of three main operations:</p>
<ol type="1">
<li><p><strong>Predict</strong>: For each dotted rule where the dot precedes a non-terminal, add new dotted rules for all possible expansions of that non-terminal. This operation looks ahead to determine what might come next.</p></li>
<li><p><strong>Scan</strong>: For each dotted rule where the dot precedes a terminal that matches the current input symbol, advance the dot past that terminal. This operation represents recognizing an input symbol.</p></li>
<li><p><strong>Complete</strong>: For each dotted rule where the dot is at the end (indicating a completed constituent), go back to the chart position where the constituent began and advance the dot in all dotted rules that were waiting for this constituent.</p></li>
</ol>
<p>These operations work together to efficiently parse the input while avoiding redundant work.</p>
</section>
<section id="advantages-of-earley-for-morphological-analysis-2" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-earley-for-morphological-analysis-2">Advantages of Earley for Morphological Analysis</h2>
<p>The Earley algorithm offers several advantages for morphological analysis:</p>
<ol type="1">
<li><p><strong>Any CFG</strong>: Unlike CKY, Earley works with any context-free grammar, including those with ε-rules (empty productions), unary rules, and arbitrary rule lengths. This allows for more natural expression of morphological patterns.</p></li>
<li><p><strong>Incremental processing</strong>: Earley processes the input left-to-right, which can be useful for interactive applications or streaming inputs.</p></li>
<li><p><strong>Left recursion</strong>: Earley handles left-recursive rules without modification, which is important for certain morphological patterns.</p></li>
<li><p><strong>Explicit predictions</strong>: The predict operation explicitly lists all the possible continuations at each position, which can be useful for generating suggestions in applications like spelling correction or auto-completion.</p></li>
<li><p><strong>Efficiency</strong>: While the worst-case complexity is O(n³), for many practical grammars Earley performs better, especially for unambiguous or nearly unambiguous grammars.</p></li>
</ol>
</section>
<section id="real-world-example-predicting-next-morphemes-2" class="level2">
<h2 class="anchored" data-anchor-id="real-world-example-predicting-next-morphemes-2">Real-World Example: Predicting Next Morphemes</h2>
<p>One interesting application of the Earley algorithm is predicting what could come next in a partial word. Let’s look at how to use the algorithm to predict possible continuations for “un”:</p>
<ol type="1">
<li>Run the Earley algorithm on the prefix “un”</li>
<li>Look at the dotted rules in the chart at position 1 (after “un”)</li>
<li>Find all dotted rules where the dot precedes a terminal</li>
<li>These terminals are the possible next morphemes</li>
</ol>
<p>For example, with our grammar, after processing “un”, Chart[1] includes:</p>
<pre data-code-line-numbers=""><code>Adj -&gt; Prefix • Adj [0,1]
Adj -&gt; • happy [1,1]</code></pre>
<p>This tells us that the next morpheme could be “happy” or potentially other adjectives.</p>
<p>Let’s extend our <code>EarleyParser</code> class to support prediction:</p>
<div class="sourceCode" id="cb46" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Predict possible next words given a prefix</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">    prefix : list[str]</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">    dict[str, set[str]]</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>                next_symbols[<span class="bu">next</span><span class="op">---</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s define a `DottedRule` class that will be the core of our Earley parser:</span></span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete the next symbol in this rule</span></span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a><span class="st">        DottedRule</span></span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a><span class="st">            A new dotted rule with the dot advanced</span></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s define the chart and chart entry classes for the Earley algorithm:</p>
<div class="sourceCode" id="cb47" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart entry for a Earley chart</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">    dotted_rule</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">    backpointers</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete this entry with another entry</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry that completes this one</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChartEntry</span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a><span class="co">            A new entry with the dot advanced</span></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if this entry completes another entry</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a><span class="co">        other : EarleyChartEntry</span></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to check</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a><span class="co">            True if this entry completes the other entry</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart for an Earley parser</span></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="co">    input_size</span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Construct the parses implied by the chart</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to construct the parse from</span></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a><span class="co">        Tree</span></span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="co">            The parse tree</span></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s define the <code>EarleyParser</code> class:</p>
<div class="sourceCode" id="cb48" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An Earley parser</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">    grammar : ContextFreeGrammar</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Fill the chart using the Earley algorithm</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co">        string : list[str]</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChart</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="co">            The filled chart</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to predict from</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a><span class="co">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to scan from</span></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a><span class="co">            The completed entry</span></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a><span class="co">        Parse a string to find all possible parse trees</span></span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a><span class="co">        set[Tree]</span></span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a><span class="co">            The set of all possible parse trees</span></span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb48-158"><a href="#cb48-158" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb48-159"><a href="#cb48-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-160"><a href="#cb48-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb48-161"><a href="#cb48-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb48-162"><a href="#cb48-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-163"><a href="#cb48-163" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb48-164"><a href="#cb48-164" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb48-165"><a href="#cb48-165" aria-hidden="true" tabindex="-1"></a><span class="co">        Recognize whether a string is in the language</span></span>
<span id="cb48-166"><a href="#cb48-166" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb48-167"><a href="#cb48-167" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb48-168"><a href="#cb48-168" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb48-169"><a href="#cb48-169" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb48-170"><a href="#cb48-170" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to recognize</span></span>
<span id="cb48-171"><a href="#cb48-171" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb48-172"><a href="#cb48-172" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb48-173"><a href="#cb48-173" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb48-174"><a href="#cb48-174" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb48-175"><a href="#cb48-175" aria-hidden="true" tabindex="-1"></a><span class="co">            True if the string is in the language, False otherwise</span></span>
<span id="cb48-176"><a href="#cb48-176" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb48-177"><a href="#cb48-177" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb48-178"><a href="#cb48-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb48-179"><a href="#cb48-179" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb48-180"><a href="#cb48-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-181"><a href="#cb48-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb48-182"><a href="#cb48-182" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb48-183"><a href="#cb48-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-184"><a href="#cb48-184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb48-185"><a href="#cb48-185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb48-186"><a href="#cb48-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb48-187"><a href="#cb48-187" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb48-188"><a href="#cb48-188" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb48-189"><a href="#cb48-189" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb48-190"><a href="#cb48-190" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-191"><a href="#cb48-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb48-192"><a href="#cb48-192" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb48-193"><a href="#cb48-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-194"><a href="#cb48-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-earley-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="the-earley-algorithm">The Earley Algorithm</h2>
<p>The Earley algorithm consists of three main operations, which are applied to each position in the input string:</p>
<ol type="1">
<li><strong>Predict</strong>: For each incomplete dotted rule where the next symbol is a non-terminal, add new dotted rules for all possible expansions of that non-terminal.</li>
<li><strong>Scan</strong>: For each incomplete dotted rule where the next symbol is a terminal matching the current input symbol, advance the dot and add the new dotted rule to the next position.</li>
<li><strong>Complete</strong>: For each complete dotted rule, find all incomplete dotted rules that were waiting for this rule to complete, advance their dots, and add the new dotted rules to the current position.</li>
</ol>
<p>Let’s walk through the algorithm with a simple example.</p>
</section>
<section id="example-parsing-unhappiness" class="level2">
<h2 class="anchored" data-anchor-id="example-parsing-unhappiness">Example: Parsing “unhappiness”</h2>
<p>Consider the morphological grammar and the word “unhappiness” with segmentation <code>["un", "happy", "ness"]</code>:</p>
<div class="sourceCode" id="cb49" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s trace the execution of the Earley algorithm:</p>
<ol type="1">
<li><strong>Position 0 (Start):</strong>
<ul>
<li>Initialize with <code>Word -&gt; • N [0,0]</code></li>
<li>Predict: Add <code>N -&gt; • Adj Suffix [0,0]</code></li>
<li>Predict: Add <code>Adj -&gt; • happy [0,0]</code>, <code>Adj -&gt; • Prefix Adj [0,0]</code></li>
<li>Predict: Add <code>Prefix -&gt; • un [0,0]</code></li>
</ul></li>
<li><strong>Position 0 to 1 (After seeing “un”):</strong>
<ul>
<li>Scan: <code>Prefix -&gt; un • [0,1]</code> (complete)</li>
<li>Complete: Use the completed Prefix to advance <code>Adj -&gt; Prefix • Adj [0,1]</code></li>
<li>Predict: Add <code>Adj -&gt; • happy [1,1]</code>, <code>Adj -&gt; • Prefix Adj [1,1]</code></li>
<li>Predict: Add <code>Prefix -&gt; • un [1,1]</code></li>
</ul></li>
<li><strong>Position 1 to 2 (After seeing “happy”):</strong>
<ul>
<li>Scan: <code>Adj -&gt; happy • [1,2]</code> (complete)</li>
<li>Complete: Use the completed Adj to advance <code>Adj -&gt; Prefix Adj • [0,2]</code> (complete)</li>
<li>Complete: Use the completed Adj to advance <code>N -&gt; Adj • Suffix [0,2]</code></li>
<li>Predict: Add <code>Suffix -&gt; • ness [2,2]</code></li>
</ul></li>
<li><strong>Position 2 to 3 (After seeing “ness”):</strong>
<ul>
<li>Scan: <code>Suffix -&gt; ness • [2,3]</code> (complete)</li>
<li>Complete: Use the completed Suffix to advance <code>N -&gt; Adj Suffix • [0,3]</code> (complete)</li>
<li>Complete: Use the completed N to advance <code>Word -&gt; N • [0,3]</code> (complete)</li>
</ul></li>
</ol>
<p>Since we have a completed dotted rule for the start variable <code>Word</code> that spans the entire input, the string is in the language generated by the grammar.</p>
<p>The parse tree would be:</p>
<pre data-code-line-numbers=""><code>    Word
     |
     N
    / \
  Adj  Suffix
 /  \    |
Prefix Adj ness
  |    |
 un  happy</code></pre>
</section>
<section id="advantages-of-the-earley-algorithm-for-morphological-parsing" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-the-earley-algorithm-for-morphological-parsing">Advantages of the Earley Algorithm for Morphological Parsing</h2>
<p>The Earley algorithm offers several advantages for morphological parsing:</p>
<ol type="1">
<li><p><strong>Works with any CFG</strong>: Unlike CKY, Earley doesn’t require the grammar to be in Chomsky Normal Form, which allows for more natural expression of morphological rules.</p></li>
<li><p><strong>Handles ambiguity</strong>: Like CKY, Earley can find all possible parses for ambiguous inputs.</p></li>
<li><p><strong>Left recursion</strong>: Earley can handle left-recursive rules (e.g., <code>A -&gt; A B</code>) without modification, which is important for certain morphological patterns.</p></li>
<li><p><strong>Incremental processing</strong>: Earley processes the input left-to-right, which can be useful for interactive applications or streaming inputs.</p></li>
<li><p><strong>Prediction-driven</strong>: Earley only considers rules that are relevant to the current input, potentially saving work compared to bottom-up approaches like CKY.</p></li>
</ol>
</section>
<section id="example-word-prediction-with-earley" class="level2">
<h2 class="anchored" data-anchor-id="example-word-prediction-with-earley">Example: Word Prediction with Earley</h2>
<p>One interesting application of the Earley algorithm is predicting what parts of speech (and ultimately, what words) could come next in a partially formed word. Let’s extend our <code>EarleyParser</code> class to support this:</p>
<div class="sourceCode" id="cb51" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(EarleyParser):</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict possible next words given a prefix</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">        prefix : list[str]</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">            The prefix of a word, as a list of morphemes</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">        dict[str, set[str]]</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">            A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Group by next expected symbol</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>        next_symbols <span class="op">=</span> {}</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>            next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>                <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>                            next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol].add(rule.right_side[<span class="dv">0</span>])</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> next_symbols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method allows us to predict what could come next in a word, which is useful for applications like auto-completion or spelling correction.</p>
<p>For example:</p>
<div class="sourceCode" id="cb52" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> grammar.parser._predict_next_word([<span class="st">'un'</span>])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Adj': {'happy'}}</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un happy"</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> grammar.parser._predict_next_word([<span class="st">'un'</span>, <span class="st">'happy'</span>])</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Suffix': {'ness'}}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="real-world-example-celex-data" class="level2">
<h2 class="anchored" data-anchor-id="real-world-example-celex-data">Real-World Example: CELEX Data</h2>
<p>Let’s revisit our “unbelievably” example from CELEX:</p>
<pre data-code-line-numbers=""><code>((((un)[Prefix] (believe)[V])[V] (able)[Suffix])[Adj] (ly)[Suffix])[Adv]</code></pre>
<p>With the Earley algorithm, we can parse this complex structure without converting to CNF:</p>
<div class="sourceCode" id="cb54" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract grammar from CELEX</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>celex_grammar <span class="op">=</span> ContextFreeGrammar.from_treebank(celex_parses)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse a specific word</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> celex_grammar([<span class="st">'un'</span>, <span class="st">'believe'</span>, <span class="st">'able'</span>, <span class="st">'ly'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> parse <span class="kw">in</span> parses:</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(parse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can also predict what might follow partial words:</p>
<div class="sourceCode" id="cb55" data-code-line-numbers=""><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un believe"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> celex_grammar.parser._predict_next_word([<span class="st">'un'</span>, <span class="st">'believe'</span>])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Suffix': {'able', 'er', 'ing', ...}}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="comparison-with-cky" class="level2">
<h2 class="anchored" data-anchor-id="comparison-with-cky">Comparison with CKY</h2>
<p>Both CKY and Earley are powerful parsing algorithms with different strengths:</p>
<table class="table">
<colgroup>
<col style="width: 40%">
<col style="width: 22%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>CKY</th>
<th>Earley</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Grammar format</td>
<td>Requires CNF</td>
<td>Any CFG</td>
</tr>
<tr class="even">
<td>Parsing direction</td>
<td>Bottom-up</td>
<td>Top-down with bottom-up filtering</td>
</tr>
<tr class="odd">
<td>Left recursion</td>
<td>Handles it by design</td>
<td>Handles it by design</td>
</tr>
<tr class="even">
<td>Time complexity</td>
<td>O(n³ * |V|²)</td>
<td>O(n³) worst case, O(n²) for unambiguous</td>
</tr>
<tr class="odd">
<td>Space complexity</td>
<td>O(n² * |V|)</td>
<td>O(n²)</td>
</tr>
<tr class="even">
<td>Incremental</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Prediction</td>
<td>Limited</td>
<td>Strong</td>
</tr>
</tbody>
</table>
<p>For morphological parsing, both algorithms are effective, but Earley’s ability to work with any CFG and its incremental nature make it particularly well-suited for morphological applications.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The Earley algorithm is a powerful tool for morphological parsing, offering flexibility and efficiency. Its ability to work with any context-free grammar, handle ambiguity, and process input incrementally makes it well-suited for morphological analysis.</p>
<p>In this module, we’ve explored the formal definition of context-free grammars, operations on grammars, normal forms, and two powerful parsing algorithms: CKY and Earley. These tools provide a solid foundation for computational morphology, allowing us to model and analyze the complex structure of words in natural languages. dotted_rule.is_complete</p>
<pre data-code-line-numbers=""><code>def complete(self, entry: 'EarleyChartEntry', new_left_edge: int) -&gt; 'EarleyChartEntry':
    """Complete this entry with another entry
    
    Parameters
    ----------
    entry : EarleyChartEntry
        The entry that completes this one
    new_left_edge : int
        The new left edge of the span
        
    Returns
    -------
    EarleyChartEntry
        A new entry with the dot advanced
    """
    new_dotted_rule = self._dotted_rule.complete(new_left_edge)
    
    bp = (self._dotted_rule.next_symbol, self._dotted_rule.span[1])
    backpointers = self._backpointers + (bp,)
    
    return Earley</code></pre>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="aaronstevenwhite/intro-to-cl" data-repo-id="R_kgDOLDRKkw" data-category="General" data-category-id="DIC_kwDOLDRKk84CcfKw" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../morphological-patterns/cky-parsing.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Bottom-Up Parsing with CKY</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../morphological-patterns/probabilistic-context-free-grammars.html" class="pagination-link">
        <span class="nav-page-text">Probabilistic Context-Free Grammars for Morphological Analysis</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false" data-code-line-numbers=""><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Top-Down Parsing with Earley</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references.bib</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom-up parsing approach for context-free grammars. Now, we'll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let's briefly compare top-down and bottom-up parsing approaches:</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>**Bottom-Up Parsing (e.g., CKY):**</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Starts with the input and builds larger constituents</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Works well with grammars in normal forms</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Typically more efficient for highly ambiguous grammars</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>May do unnecessary work on strings not in the language</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>**Top-Down Parsing:**</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Starts with the start symbol and tries to derive the input</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>More intuitive for tracing the derivation process</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can incorporate contextual constraints more easily</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>May get stuck in loops with left-recursive grammars</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top-down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used in CKY.</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dotted Rules</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>The key concept in the Earley algorithm is the "dotted rule" (also called an "Earley item"). A dotted rule is a context-free rule with a dot (•) inserted somewhere on the right-hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>For example, if we have the rule <span class="in">`N -&gt; Adj Suffix`</span>, we can have the following dotted rules:</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`N -&gt; • Adj Suffix`</span> (nothing recognized yet)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`N -&gt; Adj • Suffix`</span> (Adj recognized, Suffix expected)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`N -&gt; Adj Suffix •`</span> (everything recognized)</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the input they cover) and any backpointers needed for reconstructing the parse tree.</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="fu">### Earley Algorithm Pseudocode</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>Here's a formal pseudocode for the Earley algorithm:</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a><span class="in">function Earley(grammar, input):</span></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="in">    n = length(input)</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="in">    # Initialize the chart (n+1 sets of dotted rules)</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a><span class="in">    chart = new Array[n+1]</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="in">    for i = 0 to n:</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a><span class="in">        chart[i] = new Set()</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a><span class="in">    # Initialize chart[0] with dotted rules for the start symbol</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a><span class="in">    for each rule S -&gt; γ in grammar (where S is the start symbol):</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a><span class="in">        add (S -&gt; • γ, 0) to chart[0]</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a><span class="in">    # Fill in the chart</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a><span class="in">    for i = 0 to n:</span></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a><span class="in">        for each state (A -&gt; α • β, j) in chart[i]:</span></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a><span class="in">            if β is not empty:</span></span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a><span class="in">                if β starts with a terminal symbol a:</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a><span class="in">                    if i &lt; n and input[i] = a:  # Scan</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a><span class="in">                        add (A -&gt; α a • β', j) to chart[i+1]</span></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="in">                else if β starts with a non-terminal B:  # Predict</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a><span class="in">                    for each rule B -&gt; γ in grammar:</span></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a><span class="in">                        add (B -&gt; • γ, i) to chart[i]</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a><span class="in">            else:  # Complete</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a><span class="in">                for each state (C -&gt; δ • A ζ, k) in chart[j]:</span></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a><span class="in">                    add (C -&gt; δ A • ζ, k) to chart[i]</span></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a><span class="in">        # Continue processing chart[i] until no more items can be added</span></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a><span class="in">        repeat until chart[i] doesn't change:</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a><span class="in">            apply Predict and Complete operations to all items in chart[i]</span></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a><span class="in">    # Check if the start symbol can derive the entire input</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a><span class="in">    return any item (S -&gt; γ •, 0) in chart[n] where S is the start symbol</span></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>For parsing (as opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>Let's define a <span class="in">`DottedRule`</span> class that will be the core of our Earley parser:</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete the next symbol in this rule</span></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a><span class="co">        DottedRule</span></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a><span class="co">            A new dotted rule with the dot advanced</span></span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a>Now, let's define the chart and chart entry classes for the Earley algorithm:</span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart entry for a Earley chart</span></span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a><span class="co">    dotted_rule</span></span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a><span class="co">    backpointers</span></span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb57-180"><a href="#cb57-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-194"><a href="#cb57-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb57-195"><a href="#cb57-195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Complete this entry with another entry</span></span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry that completes this one</span></span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a><span class="co">        new_left_edge : int</span></span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a><span class="co">            The new left edge of the span</span></span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChartEntry</span></span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a><span class="co">            A new entry with the dot advanced</span></span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if this entry completes another entry</span></span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a><span class="co">        other : EarleyChartEntry</span></span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to check</span></span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a><span class="co">            True if this entry completes the other entry</span></span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb57-240"><a href="#cb57-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chart for an Earley parser</span></span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a><span class="co">    input_size</span></span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Construct the parses implied by the chart</span></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to construct the parse from</span></span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a><span class="co">        Tree</span></span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a><span class="co">            The parse tree</span></span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a>Here's the implementation of the <span class="in">`EarleyParser`</span> class:</span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-318"><a href="#cb57-318" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb57-319"><a href="#cb57-319" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a><span class="co">    An Earley parser</span></span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a><span class="co">    grammar : ContextFreeGrammar</span></span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a><span class="co">        Fill the chart using the Earley algorithm</span></span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a><span class="co">        string : list[str]</span></span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a><span class="co">        EarleyChart</span></span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a><span class="co">            The filled chart</span></span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-352"><a href="#cb57-352" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb57-372"><a href="#cb57-372" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb57-373"><a href="#cb57-373" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to predict from</span></span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb57-396"><a href="#cb57-396" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb57-397"><a href="#cb57-397" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-406"><a href="#cb57-406" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a><span class="co">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a><span class="co">            The entry to scan from</span></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb57-428"><a href="#cb57-428" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb57-438"><a href="#cb57-438" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a><span class="co">        chart : EarleyChart</span></span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a><span class="co">            The chart to update</span></span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a><span class="co">        entry : EarleyChartEntry</span></span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a><span class="co">            The completed entry</span></span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a><span class="co">        position : int</span></span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="co">            The current position in the input</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb57-451"><a href="#cb57-451" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a><span class="co">        Parse a string to find all possible parse trees</span></span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-462"><a href="#cb57-462" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to parse</span></span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a><span class="co">        set[Tree]</span></span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a><span class="co">            The set of all possible parse trees</span></span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a><span class="co">        Recognize whether a string is in the language</span></span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a><span class="co">        string : str | list[str]</span></span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a><span class="co">            The string to recognize</span></span>
<span id="cb57-488"><a href="#cb57-488" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb57-489"><a href="#cb57-489" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb57-490"><a href="#cb57-490" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a><span class="co">            True if the string is in the language, False otherwise</span></span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb57-505"><a href="#cb57-505" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb57-506"><a href="#cb57-506" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a><span class="fu">## Detailed Example: Parsing "unhappiness"</span></span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a>Let's walk through a detailed example of the Earley algorithm parsing the word "unhappiness" with the segmentation <span class="in">`["un", "happy", "ness"]`</span> using our simplified grammar:</span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-530"><a href="#cb57-530" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-531"><a href="#cb57-531" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step-by-Step Chart Filling</span></span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a>Let's trace the Earley algorithm as it fills the chart for "unhappiness":</span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Chart[0]: Initial State</span></span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a>First, we initialize chart<span class="co">[</span><span class="ot">0</span><span class="co">]</span> with a dotted rule for the start symbol <span class="in">`Word`</span>:</span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Add <span class="in">`Word -&gt; • N [0,0]`</span> (from start symbol rule)</span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Apply predict:</span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Word -&gt; • N`</span>:</span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`N -&gt; • Adj Suffix [0,0]`</span></span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Apply predict again:</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`N -&gt; • Adj Suffix`</span>:</span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; • happy [0,0]`</span></span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; • Prefix Adj [0,0]`</span></span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Apply predict again:</span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; • Prefix Adj`</span>:</span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Prefix -&gt; • un [0,0]`</span></span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-560"><a href="#cb57-560" aria-hidden="true" tabindex="-1"></a>Chart<span class="co">[</span><span class="ot">0</span><span class="co">]</span> now looks like:</span>
<span id="cb57-561"><a href="#cb57-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a><span class="in">Word -&gt; • N [0,0]</span></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a><span class="in">N -&gt; • Adj Suffix [0,0]</span></span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; • happy [0,0]</span></span>
<span id="cb57-565"><a href="#cb57-565" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; • Prefix Adj [0,0]</span></span>
<span id="cb57-566"><a href="#cb57-566" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix -&gt; • un [0,0]</span></span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-568"><a href="#cb57-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-569"><a href="#cb57-569" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Chart[1]: After Processing "un"</span></span>
<span id="cb57-570"><a href="#cb57-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-571"><a href="#cb57-571" aria-hidden="true" tabindex="-1"></a>Now we process the first input symbol "un":</span>
<span id="cb57-572"><a href="#cb57-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-573"><a href="#cb57-573" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Apply scan:</span>
<span id="cb57-574"><a href="#cb57-574" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Prefix -&gt; • un [0,0]`</span>:</span>
<span id="cb57-575"><a href="#cb57-575" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Prefix -&gt; un • [0,1]`</span> (complete)</span>
<span id="cb57-576"><a href="#cb57-576" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Apply complete:</span>
<span id="cb57-577"><a href="#cb57-577" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Prefix -&gt; un • [0,1]`</span> (complete):</span>
<span id="cb57-578"><a href="#cb57-578" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Find <span class="in">`Adj -&gt; • Prefix Adj [0,0]`</span> waiting for Prefix</span>
<span id="cb57-579"><a href="#cb57-579" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; Prefix • Adj [0,1]`</span></span>
<span id="cb57-580"><a href="#cb57-580" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Apply predict:</span>
<span id="cb57-581"><a href="#cb57-581" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; Prefix • Adj [0,1]`</span>:</span>
<span id="cb57-582"><a href="#cb57-582" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; • happy [1,1]`</span></span>
<span id="cb57-583"><a href="#cb57-583" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; • Prefix Adj [1,1]`</span></span>
<span id="cb57-584"><a href="#cb57-584" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Apply predict again:</span>
<span id="cb57-585"><a href="#cb57-585" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; • Prefix Adj [1,1]`</span>:</span>
<span id="cb57-586"><a href="#cb57-586" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Prefix -&gt; • un [1,1]`</span></span>
<span id="cb57-587"><a href="#cb57-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-588"><a href="#cb57-588" aria-hidden="true" tabindex="-1"></a>Chart<span class="co">[</span><span class="ot">1</span><span class="co">]</span> now looks like:</span>
<span id="cb57-589"><a href="#cb57-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-590"><a href="#cb57-590" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix -&gt; un • [0,1]</span></span>
<span id="cb57-591"><a href="#cb57-591" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; Prefix • Adj [0,1]</span></span>
<span id="cb57-592"><a href="#cb57-592" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; • happy [1,1]</span></span>
<span id="cb57-593"><a href="#cb57-593" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; • Prefix Adj [1,1]</span></span>
<span id="cb57-594"><a href="#cb57-594" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix -&gt; • un [1,1]</span></span>
<span id="cb57-595"><a href="#cb57-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-596"><a href="#cb57-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-597"><a href="#cb57-597" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Chart[2]: After Processing "happy"</span></span>
<span id="cb57-598"><a href="#cb57-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-599"><a href="#cb57-599" aria-hidden="true" tabindex="-1"></a>Now we process the second input symbol "happy":</span>
<span id="cb57-600"><a href="#cb57-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-601"><a href="#cb57-601" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Apply scan:</span>
<span id="cb57-602"><a href="#cb57-602" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; • happy [1,1]`</span>:</span>
<span id="cb57-603"><a href="#cb57-603" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; happy • [1,2]`</span> (complete)</span>
<span id="cb57-604"><a href="#cb57-604" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Apply complete:</span>
<span id="cb57-605"><a href="#cb57-605" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; happy • [1,2]`</span> (complete):</span>
<span id="cb57-606"><a href="#cb57-606" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Find <span class="in">`Adj -&gt; Prefix • Adj [0,1]`</span> waiting for Adj</span>
<span id="cb57-607"><a href="#cb57-607" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Adj -&gt; Prefix Adj • [0,2]`</span> (complete)</span>
<span id="cb57-608"><a href="#cb57-608" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Apply complete again:</span>
<span id="cb57-609"><a href="#cb57-609" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Adj -&gt; Prefix Adj • [0,2]`</span> (complete):</span>
<span id="cb57-610"><a href="#cb57-610" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Find <span class="in">`N -&gt; • Adj Suffix [0,0]`</span> waiting for Adj</span>
<span id="cb57-611"><a href="#cb57-611" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`N -&gt; Adj • Suffix [0,2]`</span></span>
<span id="cb57-612"><a href="#cb57-612" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Apply predict:</span>
<span id="cb57-613"><a href="#cb57-613" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`N -&gt; Adj • Suffix [0,2]`</span>:</span>
<span id="cb57-614"><a href="#cb57-614" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Suffix -&gt; • ness [2,2]`</span></span>
<span id="cb57-615"><a href="#cb57-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-616"><a href="#cb57-616" aria-hidden="true" tabindex="-1"></a>Chart<span class="co">[</span><span class="ot">2</span><span class="co">]</span> now looks like:</span>
<span id="cb57-617"><a href="#cb57-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-618"><a href="#cb57-618" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; happy • [1,2]</span></span>
<span id="cb57-619"><a href="#cb57-619" aria-hidden="true" tabindex="-1"></a><span class="in">Adj -&gt; Prefix Adj • [0,2]</span></span>
<span id="cb57-620"><a href="#cb57-620" aria-hidden="true" tabindex="-1"></a><span class="in">N -&gt; Adj • Suffix [0,2]</span></span>
<span id="cb57-621"><a href="#cb57-621" aria-hidden="true" tabindex="-1"></a><span class="in">Suffix -&gt; • ness [2,2]</span></span>
<span id="cb57-622"><a href="#cb57-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-623"><a href="#cb57-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-624"><a href="#cb57-624" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Chart[3]: After Processing "ness"</span></span>
<span id="cb57-625"><a href="#cb57-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-626"><a href="#cb57-626" aria-hidden="true" tabindex="-1"></a>Finally, we process the third input symbol "ness":</span>
<span id="cb57-627"><a href="#cb57-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-628"><a href="#cb57-628" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Apply scan:</span>
<span id="cb57-629"><a href="#cb57-629" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Suffix -&gt; • ness [2,2]`</span>:</span>
<span id="cb57-630"><a href="#cb57-630" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Suffix -&gt; ness • [2,3]`</span> (complete)</span>
<span id="cb57-631"><a href="#cb57-631" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Apply complete:</span>
<span id="cb57-632"><a href="#cb57-632" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`Suffix -&gt; ness • [2,3]`</span> (complete):</span>
<span id="cb57-633"><a href="#cb57-633" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Find <span class="in">`N -&gt; Adj • Suffix [0,2]`</span> waiting for Suffix</span>
<span id="cb57-634"><a href="#cb57-634" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`N -&gt; Adj Suffix • [0,3]`</span> (complete)</span>
<span id="cb57-635"><a href="#cb57-635" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Apply complete again:</span>
<span id="cb57-636"><a href="#cb57-636" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For <span class="in">`N -&gt; Adj Suffix • [0,3]`</span> (complete):</span>
<span id="cb57-637"><a href="#cb57-637" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Find <span class="in">`Word -&gt; • N [0,0]`</span> waiting for N</span>
<span id="cb57-638"><a href="#cb57-638" aria-hidden="true" tabindex="-1"></a><span class="ss">     - </span>Add <span class="in">`Word -&gt; N • [0,3]`</span> (complete)</span>
<span id="cb57-639"><a href="#cb57-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-640"><a href="#cb57-640" aria-hidden="true" tabindex="-1"></a>Chart<span class="co">[</span><span class="ot">3</span><span class="co">]</span> now looks like:</span>
<span id="cb57-641"><a href="#cb57-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-642"><a href="#cb57-642" aria-hidden="true" tabindex="-1"></a><span class="in">Suffix -&gt; ness • [2,3]</span></span>
<span id="cb57-643"><a href="#cb57-643" aria-hidden="true" tabindex="-1"></a><span class="in">N -&gt; Adj Suffix • [0,3]</span></span>
<span id="cb57-644"><a href="#cb57-644" aria-hidden="true" tabindex="-1"></a><span class="in">Word -&gt; N • [0,3]</span></span>
<span id="cb57-645"><a href="#cb57-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-646"><a href="#cb57-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-647"><a href="#cb57-647" aria-hidden="true" tabindex="-1"></a>Since there's a completed dotted rule for the start symbol <span class="in">`Word`</span> that spans the entire input (0 to 3), the word "unhappiness" is in the language defined by our grammar.</span>
<span id="cb57-648"><a href="#cb57-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-649"><a href="#cb57-649" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing the Chart State</span></span>
<span id="cb57-650"><a href="#cb57-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-651"><a href="#cb57-651" aria-hidden="true" tabindex="-1"></a>We can visualize the entire chart as follows:</span>
<span id="cb57-652"><a href="#cb57-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-653"><a href="#cb57-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-654"><a href="#cb57-654" aria-hidden="true" tabindex="-1"></a><span class="in">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-655"><a href="#cb57-655" aria-hidden="true" tabindex="-1"></a><span class="in">|      Chart[0]         |        Chart[1]          |        Chart[2]          |        Chart[3]          |</span></span>
<span id="cb57-656"><a href="#cb57-656" aria-hidden="true" tabindex="-1"></a><span class="in">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-657"><a href="#cb57-657" aria-hidden="true" tabindex="-1"></a><span class="in">| Word -&gt; • N [0,0]     | Prefix -&gt; un • [0,1]     | Adj -&gt; happy • [1,2]     | Suffix -&gt; ness • [2,3]   |</span></span>
<span id="cb57-658"><a href="#cb57-658" aria-hidden="true" tabindex="-1"></a><span class="in">| N -&gt; • Adj Suffix [0,0]| Adj -&gt; Prefix • Adj [0,1]| Adj -&gt; Prefix Adj • [0,2]| N -&gt; Adj Suffix • [0,3]  |</span></span>
<span id="cb57-659"><a href="#cb57-659" aria-hidden="true" tabindex="-1"></a><span class="in">| Adj -&gt; • happy [0,0]  | Adj -&gt; • happy [1,1]     | N -&gt; Adj • Suffix [0,2]  | Word -&gt; N • [0,3]        |</span></span>
<span id="cb57-660"><a href="#cb57-660" aria-hidden="true" tabindex="-1"></a><span class="in">| Adj -&gt; • Prefix Adj [0,0]| Adj -&gt; • Prefix Adj [1,1]| Suffix -&gt; • ness [2,2]   |                        |</span></span>
<span id="cb57-661"><a href="#cb57-661" aria-hidden="true" tabindex="-1"></a><span class="in">| Prefix -&gt; • un [0,0]  | Prefix -&gt; • un [1,1]     |                         |                        |</span></span>
<span id="cb57-662"><a href="#cb57-662" aria-hidden="true" tabindex="-1"></a><span class="in">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-663"><a href="#cb57-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-664"><a href="#cb57-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-665"><a href="#cb57-665" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reconstructing the Parse Tree</span></span>
<span id="cb57-666"><a href="#cb57-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-667"><a href="#cb57-667" aria-hidden="true" tabindex="-1"></a>From the completed dotted rule <span class="in">`Word -&gt; N • [0,3]`</span> in Chart<span class="co">[</span><span class="ot">3</span><span class="co">]</span>, we can reconstruct the parse tree by following the backpointers:</span>
<span id="cb57-668"><a href="#cb57-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-669"><a href="#cb57-669" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Start with <span class="in">`Word -&gt; N • [0,3]`</span> in Chart<span class="co">[</span><span class="ot">3</span><span class="co">]</span></span>
<span id="cb57-670"><a href="#cb57-670" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Follow the backpointer to <span class="in">`N -&gt; Adj Suffix • [0,3]`</span> in Chart<span class="co">[</span><span class="ot">3</span><span class="co">]</span></span>
<span id="cb57-671"><a href="#cb57-671" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Follow the backpointer to <span class="in">`Adj -&gt; Prefix Adj • [0,2]`</span> in Chart<span class="co">[</span><span class="ot">2</span><span class="co">]</span></span>
<span id="cb57-672"><a href="#cb57-672" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Follow the backpointer to <span class="in">`Prefix -&gt; un • [0,1]`</span> in Chart<span class="co">[</span><span class="ot">1</span><span class="co">]</span></span>
<span id="cb57-673"><a href="#cb57-673" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Follow the backpointer to <span class="in">`Adj -&gt; happy • [1,2]`</span> in Chart<span class="co">[</span><span class="ot">2</span><span class="co">]</span></span>
<span id="cb57-674"><a href="#cb57-674" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Follow the backpointer to <span class="in">`Suffix -&gt; ness • [2,3]`</span> in Chart<span class="co">[</span><span class="ot">3</span><span class="co">]</span></span>
<span id="cb57-675"><a href="#cb57-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-676"><a href="#cb57-676" aria-hidden="true" tabindex="-1"></a>This gives us the parse tree:</span>
<span id="cb57-677"><a href="#cb57-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-678"><a href="#cb57-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-679"><a href="#cb57-679" aria-hidden="true" tabindex="-1"></a><span class="in">       Word</span></span>
<span id="cb57-680"><a href="#cb57-680" aria-hidden="true" tabindex="-1"></a><span class="in">        |</span></span>
<span id="cb57-681"><a href="#cb57-681" aria-hidden="true" tabindex="-1"></a><span class="in">        N</span></span>
<span id="cb57-682"><a href="#cb57-682" aria-hidden="true" tabindex="-1"></a><span class="in">       / \</span></span>
<span id="cb57-683"><a href="#cb57-683" aria-hidden="true" tabindex="-1"></a><span class="in">     Adj  Suffix</span></span>
<span id="cb57-684"><a href="#cb57-684" aria-hidden="true" tabindex="-1"></a><span class="in">    /  \    |</span></span>
<span id="cb57-685"><a href="#cb57-685" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix Adj  ness</span></span>
<span id="cb57-686"><a href="#cb57-686" aria-hidden="true" tabindex="-1"></a><span class="in">   |    |</span></span>
<span id="cb57-687"><a href="#cb57-687" aria-hidden="true" tabindex="-1"></a><span class="in">  un  happy</span></span>
<span id="cb57-688"><a href="#cb57-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-689"><a href="#cb57-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-690"><a href="#cb57-690" aria-hidden="true" tabindex="-1"></a>This tree correctly captures the structure <span class="in">`((un+happy)+ness)`</span>.</span>
<span id="cb57-691"><a href="#cb57-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-692"><a href="#cb57-692" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Ambiguity: The "unlockable" Example</span></span>
<span id="cb57-693"><a href="#cb57-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-694"><a href="#cb57-694" aria-hidden="true" tabindex="-1"></a>Let's revisit the ambiguous word "unlockable", which has two possible interpretations:</span>
<span id="cb57-695"><a href="#cb57-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-696"><a href="#cb57-696" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`un + (lock + able)`</span> = "not able to be locked"</span>
<span id="cb57-697"><a href="#cb57-697" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`(un + lock) + able`</span> = "able to be unlocked"</span>
<span id="cb57-698"><a href="#cb57-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-699"><a href="#cb57-699" aria-hidden="true" tabindex="-1"></a>With the Earley algorithm, we can handle this ambiguity naturally. Let's create a grammar that captures both interpretations:</span>
<span id="cb57-700"><a href="#cb57-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-701"><a href="#cb57-701" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-702"><a href="#cb57-702" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-703"><a href="#cb57-703" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb57-704"><a href="#cb57-704" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-705"><a href="#cb57-705" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-706"><a href="#cb57-706" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb57-707"><a href="#cb57-707" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-708"><a href="#cb57-708" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb57-709"><a href="#cb57-709" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb57-710"><a href="#cb57-710" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb57-711"><a href="#cb57-711" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb57-712"><a href="#cb57-712" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb57-713"><a href="#cb57-713" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-714"><a href="#cb57-714" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-715"><a href="#cb57-715" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-716"><a href="#cb57-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-717"><a href="#cb57-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-718"><a href="#cb57-718" aria-hidden="true" tabindex="-1"></a>When we parse "unlockable" with Earley, we'll end up with two completed dotted rules in the final chart:</span>
<span id="cb57-719"><a href="#cb57-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-720"><a href="#cb57-720" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`Word -&gt; Adj • [0,3]`</span> where Adj comes from <span class="in">`Adj -&gt; Prefix Adj • [0,3]`</span> (un + lockable)</span>
<span id="cb57-721"><a href="#cb57-721" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`Word -&gt; Adj • [0,3]`</span> where Adj comes from <span class="in">`Adj -&gt; V Suffix • [0,3]`</span> (unlock + able)</span>
<span id="cb57-722"><a href="#cb57-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-723"><a href="#cb57-723" aria-hidden="true" tabindex="-1"></a>Both of these analyses derive <span class="in">`Word`</span>, resulting in two different parse trees:</span>
<span id="cb57-724"><a href="#cb57-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-725"><a href="#cb57-725" aria-hidden="true" tabindex="-1"></a>Parse Tree 1 (un + lockable):</span>
<span id="cb57-726"><a href="#cb57-726" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-727"><a href="#cb57-727" aria-hidden="true" tabindex="-1"></a><span class="in">    Word</span></span>
<span id="cb57-728"><a href="#cb57-728" aria-hidden="true" tabindex="-1"></a><span class="in">     |</span></span>
<span id="cb57-729"><a href="#cb57-729" aria-hidden="true" tabindex="-1"></a><span class="in">    Adj</span></span>
<span id="cb57-730"><a href="#cb57-730" aria-hidden="true" tabindex="-1"></a><span class="in">   /   \</span></span>
<span id="cb57-731"><a href="#cb57-731" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix  Adj</span></span>
<span id="cb57-732"><a href="#cb57-732" aria-hidden="true" tabindex="-1"></a><span class="in">  |    /  \</span></span>
<span id="cb57-733"><a href="#cb57-733" aria-hidden="true" tabindex="-1"></a><span class="in"> un    V  Suffix</span></span>
<span id="cb57-734"><a href="#cb57-734" aria-hidden="true" tabindex="-1"></a><span class="in">       |    |</span></span>
<span id="cb57-735"><a href="#cb57-735" aria-hidden="true" tabindex="-1"></a><span class="in">     lock  able</span></span>
<span id="cb57-736"><a href="#cb57-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-737"><a href="#cb57-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-738"><a href="#cb57-738" aria-hidden="true" tabindex="-1"></a>Parse Tree 2 (unlock + able):</span>
<span id="cb57-739"><a href="#cb57-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-740"><a href="#cb57-740" aria-hidden="true" tabindex="-1"></a><span class="in">    Word</span></span>
<span id="cb57-741"><a href="#cb57-741" aria-hidden="true" tabindex="-1"></a><span class="in">     |</span></span>
<span id="cb57-742"><a href="#cb57-742" aria-hidden="true" tabindex="-1"></a><span class="in">    Adj</span></span>
<span id="cb57-743"><a href="#cb57-743" aria-hidden="true" tabindex="-1"></a><span class="in">   /   \</span></span>
<span id="cb57-744"><a href="#cb57-744" aria-hidden="true" tabindex="-1"></a><span class="in">  V    Suffix</span></span>
<span id="cb57-745"><a href="#cb57-745" aria-hidden="true" tabindex="-1"></a><span class="in"> / \     |</span></span>
<span id="cb57-746"><a href="#cb57-746" aria-hidden="true" tabindex="-1"></a><span class="in">Prefix V able</span></span>
<span id="cb57-747"><a href="#cb57-747" aria-hidden="true" tabindex="-1"></a><span class="in">  |   |</span></span>
<span id="cb57-748"><a href="#cb57-748" aria-hidden="true" tabindex="-1"></a><span class="in"> un lock</span></span>
<span id="cb57-749"><a href="#cb57-749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-750"><a href="#cb57-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-751"><a href="#cb57-751" aria-hidden="true" tabindex="-1"></a>The Earley algorithm finds all possible parses, which is essential for accurately analyzing structurally ambiguous words.</span>
<span id="cb57-752"><a href="#cb57-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-753"><a href="#cb57-753" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Three Operations of Earley</span></span>
<span id="cb57-754"><a href="#cb57-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-755"><a href="#cb57-755" aria-hidden="true" tabindex="-1"></a>The Earley algorithm consists of three main operations:</span>
<span id="cb57-756"><a href="#cb57-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-757"><a href="#cb57-757" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Predict**: For each dotted rule where the dot precedes a non-terminal, add new dotted rules for all possible expansions of that non-terminal. This operation looks ahead to determine what might come next.</span>
<span id="cb57-758"><a href="#cb57-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-759"><a href="#cb57-759" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scan**: For each dotted rule where the dot precedes a terminal that matches the current input symbol, advance the dot past that terminal. This operation represents recognizing an input symbol.</span>
<span id="cb57-760"><a href="#cb57-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-761"><a href="#cb57-761" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Complete**: For each dotted rule where the dot is at the end (indicating a completed constituent), go back to the chart position where the constituent began and advance the dot in all dotted rules that were waiting for this constituent.</span>
<span id="cb57-762"><a href="#cb57-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-763"><a href="#cb57-763" aria-hidden="true" tabindex="-1"></a>These operations work together to efficiently parse the input while avoiding redundant work.</span>
<span id="cb57-764"><a href="#cb57-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-765"><a href="#cb57-765" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advantages of Earley for Morphological Analysis</span></span>
<span id="cb57-766"><a href="#cb57-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-767"><a href="#cb57-767" aria-hidden="true" tabindex="-1"></a>The Earley algorithm offers several advantages for morphological analysis:</span>
<span id="cb57-768"><a href="#cb57-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-769"><a href="#cb57-769" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Any CFG**: Unlike CKY, Earley works with any context-free grammar, including those with ε-rules (empty productions), unary rules, and arbitrary rule lengths. This allows for more natural expression of morphological patterns.</span>
<span id="cb57-770"><a href="#cb57-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-771"><a href="#cb57-771" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Incremental processing**: Earley processes the input left-to-right, which can be useful for interactive applications or streaming inputs.</span>
<span id="cb57-772"><a href="#cb57-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-773"><a href="#cb57-773" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Left recursion**: Earley handles left-recursive rules without modification, which is important for certain morphological patterns.</span>
<span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-775"><a href="#cb57-775" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Explicit predictions**: The predict operation explicitly lists all the possible continuations at each position, which can be useful for generating suggestions in applications like spelling correction or auto-completion.</span>
<span id="cb57-776"><a href="#cb57-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-777"><a href="#cb57-777" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Efficiency**: While the worst-case complexity is O(n³), for many practical grammars Earley performs better, especially for unambiguous or nearly unambiguous grammars.</span>
<span id="cb57-778"><a href="#cb57-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-779"><a href="#cb57-779" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real-World Example: Predicting Next Morphemes</span></span>
<span id="cb57-780"><a href="#cb57-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-781"><a href="#cb57-781" aria-hidden="true" tabindex="-1"></a>One interesting application of the Earley algorithm is predicting what could come next in a partial word. Let's extend our <span class="in">`EarleyParser`</span> class to support prediction:</span>
<span id="cb57-782"><a href="#cb57-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-783"><a href="#cb57-783" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb57-784"><a href="#cb57-784" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb57-785"><a href="#cb57-785" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb57-786"><a href="#cb57-786" aria-hidden="true" tabindex="-1"></a><span class="co">    Predict possible next words given a prefix</span></span>
<span id="cb57-787"><a href="#cb57-787" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb57-788"><a href="#cb57-788" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb57-789"><a href="#cb57-789" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb57-790"><a href="#cb57-790" aria-hidden="true" tabindex="-1"></a><span class="co">    prefix : list[str]</span></span>
<span id="cb57-791"><a href="#cb57-791" aria-hidden="true" tabindex="-1"></a><span class="co">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb57-792"><a href="#cb57-792" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb57-793"><a href="#cb57-793" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb57-794"><a href="#cb57-794" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb57-795"><a href="#cb57-795" aria-hidden="true" tabindex="-1"></a><span class="co">    dict[str, set[str]]</span></span>
<span id="cb57-796"><a href="#cb57-796" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb57-797"><a href="#cb57-797" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb57-798"><a href="#cb57-798" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb57-799"><a href="#cb57-799" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb57-800"><a href="#cb57-800" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-801"><a href="#cb57-801" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb57-802"><a href="#cb57-802" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb57-803"><a href="#cb57-803" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-804"><a href="#cb57-804" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb57-805"><a href="#cb57-805" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb57-806"><a href="#cb57-806" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb57-807"><a href="#cb57-807" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-808"><a href="#cb57-808" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-809"><a href="#cb57-809" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb57-810"><a href="#cb57-810" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-811"><a href="#cb57-811" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-812"><a href="#cb57-812" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-813"><a href="#cb57-813" aria-hidden="true" tabindex="-1"></a>            next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb57-814"><a href="#cb57-814" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-815"><a href="#cb57-815" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb57-816"><a href="#cb57-816" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-817"><a href="#cb57-817" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb57-818"><a href="#cb57-818" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb57-819"><a href="#cb57-819" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-820"><a href="#cb57-820" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-821"><a href="#cb57-821" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-822"><a href="#cb57-822" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol].add(rule.right_<span class="op">---</span></span>
<span id="cb57-823"><a href="#cb57-823" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb57-824"><a href="#cb57-824" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb57-825"><a href="#cb57-825" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb57-826"><a href="#cb57-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-827"><a href="#cb57-827" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb57-828"><a href="#cb57-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-829"><a href="#cb57-829" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb57-830"><a href="#cb57-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-831"><a href="#cb57-831" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb57-832"><a href="#cb57-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-833"><a href="#cb57-833" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb57-834"><a href="#cb57-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-835"><a href="#cb57-835" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb57-836"><a href="#cb57-836" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb57-837"><a href="#cb57-837" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb57-838"><a href="#cb57-838" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb57-839"><a href="#cb57-839" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb57-840"><a href="#cb57-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-841"><a href="#cb57-841" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb57-842"><a href="#cb57-842" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb57-843"><a href="#cb57-843" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb57-844"><a href="#cb57-844" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb57-845"><a href="#cb57-845" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb57-846"><a href="#cb57-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-847"><a href="#cb57-847" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb57-848"><a href="#cb57-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-849"><a href="#cb57-849" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb57-850"><a href="#cb57-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-851"><a href="#cb57-851" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb57-852"><a href="#cb57-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-853"><a href="#cb57-853" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb57-854"><a href="#cb57-854" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb57-855"><a href="#cb57-855" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb57-856"><a href="#cb57-856" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb57-857"><a href="#cb57-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-858"><a href="#cb57-858" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb57-859"><a href="#cb57-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-860"><a href="#cb57-860" aria-hidden="true" tabindex="-1"></a><span class="co">### Earley Algorithm Pseudocode</span></span>
<span id="cb57-861"><a href="#cb57-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-862"><a href="#cb57-862" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s a formal pseudocode for the Earley algorithm:</span></span>
<span id="cb57-863"><a href="#cb57-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-864"><a href="#cb57-864" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb57-865"><a href="#cb57-865" aria-hidden="true" tabindex="-1"></a><span class="er">function Earley</span>(grammar, <span class="bu">input</span>):</span>
<span id="cb57-866"><a href="#cb57-866" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> length(<span class="bu">input</span>)</span>
<span id="cb57-867"><a href="#cb57-867" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-868"><a href="#cb57-868" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the chart (n+1 sets of dotted rules)</span></span>
<span id="cb57-869"><a href="#cb57-869" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> new Array[n<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb57-870"><a href="#cb57-870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="dv">0</span> to n:</span>
<span id="cb57-871"><a href="#cb57-871" aria-hidden="true" tabindex="-1"></a>        chart[i] <span class="op">=</span> new Set()</span>
<span id="cb57-872"><a href="#cb57-872" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-873"><a href="#cb57-873" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize chart[0] with dotted rules for the start symbol</span></span>
<span id="cb57-874"><a href="#cb57-874" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> each rule S <span class="op">-&gt;</span> γ <span class="kw">in</span> grammar (where S <span class="kw">is</span> the start symbol):</span>
<span id="cb57-875"><a href="#cb57-875" aria-hidden="true" tabindex="-1"></a>        add (S <span class="op">-&gt;</span> • γ, <span class="dv">0</span>) to chart[<span class="dv">0</span>]</span>
<span id="cb57-876"><a href="#cb57-876" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-877"><a href="#cb57-877" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill in the chart</span></span>
<span id="cb57-878"><a href="#cb57-878" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="dv">0</span> to n:</span>
<span id="cb57-879"><a href="#cb57-879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> each state (A <span class="op">-&gt;</span> α • β, j) <span class="kw">in</span> chart[i]:</span>
<span id="cb57-880"><a href="#cb57-880" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> β <span class="kw">is</span> <span class="kw">not</span> empty:</span>
<span id="cb57-881"><a href="#cb57-881" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> β starts <span class="cf">with</span> a terminal symbol a:</span>
<span id="cb57-882"><a href="#cb57-882" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="op">&lt;</span> n <span class="kw">and</span> <span class="bu">input</span>[i] <span class="op">=</span> a:  <span class="co"># Scan</span></span>
<span id="cb57-883"><a href="#cb57-883" aria-hidden="true" tabindex="-1"></a>                        add (A <span class="op">-&gt;</span> α a • β<span class="st">', j) to chart[i+1]</span></span>
<span id="cb57-884"><a href="#cb57-884" aria-hidden="true" tabindex="-1"></a><span class="er">                else if β starts with a non-terminal B:  # Predict</span></span>
<span id="cb57-885"><a href="#cb57-885" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> each rule B <span class="op">-&gt;</span> γ <span class="kw">in</span> grammar:</span>
<span id="cb57-886"><a href="#cb57-886" aria-hidden="true" tabindex="-1"></a>                        add (B <span class="op">-&gt;</span> • γ, i) to chart[i]</span>
<span id="cb57-887"><a href="#cb57-887" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:  <span class="co"># Complete</span></span>
<span id="cb57-888"><a href="#cb57-888" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> each state (C <span class="op">-&gt;</span> δ • A ζ, k) <span class="kw">in</span> chart[j]:</span>
<span id="cb57-889"><a href="#cb57-889" aria-hidden="true" tabindex="-1"></a>                    add (C <span class="op">-&gt;</span> δ A • ζ, k) to chart[i]</span>
<span id="cb57-890"><a href="#cb57-890" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-891"><a href="#cb57-891" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continue processing chart[i] until no more items can be added</span></span>
<span id="cb57-892"><a href="#cb57-892" aria-hidden="true" tabindex="-1"></a>        repeat until chart[i] doesn<span class="st">'t change:</span></span>
<span id="cb57-893"><a href="#cb57-893" aria-hidden="true" tabindex="-1"></a><span class="er">            apply Predict and Complete operations to all items in chart</span>[i]</span>
<span id="cb57-894"><a href="#cb57-894" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-895"><a href="#cb57-895" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the start symbol can derive the entire input</span></span>
<span id="cb57-896"><a href="#cb57-896" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">any</span> item (S <span class="op">-&gt;</span> γ •, <span class="dv">0</span>) <span class="kw">in</span> chart[n] where S <span class="kw">is</span> the start symbol</span>
<span id="cb57-897"><a href="#cb57-897" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-898"><a href="#cb57-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-899"><a href="#cb57-899" aria-hidden="true" tabindex="-1"></a>For parsing (<span class="im">as</span> opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.</span>
<span id="cb57-900"><a href="#cb57-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-901"><a href="#cb57-901" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s define a `DottedRule` class that will be the core of our Earley parser:</span></span>
<span id="cb57-902"><a href="#cb57-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-903"><a href="#cb57-903" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-904"><a href="#cb57-904" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb57-905"><a href="#cb57-905" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-906"><a href="#cb57-906" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb57-907"><a href="#cb57-907" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb57-908"><a href="#cb57-908" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb57-909"><a href="#cb57-909" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb57-910"><a href="#cb57-910" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-911"><a href="#cb57-911" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb57-912"><a href="#cb57-912" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb57-913"><a href="#cb57-913" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-914"><a href="#cb57-914" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb57-915"><a href="#cb57-915" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb57-916"><a href="#cb57-916" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-917"><a href="#cb57-917" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-918"><a href="#cb57-918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-919"><a href="#cb57-919" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-920"><a href="#cb57-920" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-921"><a href="#cb57-921" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-922"><a href="#cb57-922" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-923"><a href="#cb57-923" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-924"><a href="#cb57-924" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb57-925"><a href="#cb57-925" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb57-926"><a href="#cb57-926" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb57-927"><a href="#cb57-927" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb57-928"><a href="#cb57-928" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb57-929"><a href="#cb57-929" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-930"><a href="#cb57-930" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb57-931"><a href="#cb57-931" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete the next symbol in this rule</span></span>
<span id="cb57-932"><a href="#cb57-932" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-933"><a href="#cb57-933" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-934"><a href="#cb57-934" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-935"><a href="#cb57-935" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-936"><a href="#cb57-936" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-937"><a href="#cb57-937" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-938"><a href="#cb57-938" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-939"><a href="#cb57-939" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-940"><a href="#cb57-940" aria-hidden="true" tabindex="-1"></a><span class="st">        DottedRule</span></span>
<span id="cb57-941"><a href="#cb57-941" aria-hidden="true" tabindex="-1"></a><span class="st">            A new dotted rule with the dot advanced</span></span>
<span id="cb57-942"><a href="#cb57-942" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-943"><a href="#cb57-943" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb57-944"><a href="#cb57-944" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb57-945"><a href="#cb57-945" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-946"><a href="#cb57-946" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb57-947"><a href="#cb57-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-948"><a href="#cb57-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-949"><a href="#cb57-949" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-950"><a href="#cb57-950" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb57-951"><a href="#cb57-951" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb57-952"><a href="#cb57-952" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-953"><a href="#cb57-953" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb57-954"><a href="#cb57-954" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-955"><a href="#cb57-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-956"><a href="#cb57-956" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-957"><a href="#cb57-957" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb57-958"><a href="#cb57-958" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-959"><a href="#cb57-959" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-960"><a href="#cb57-960" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-961"><a href="#cb57-961" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb57-962"><a href="#cb57-962" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-963"><a href="#cb57-963" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-964"><a href="#cb57-964" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-965"><a href="#cb57-965" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb57-966"><a href="#cb57-966" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-967"><a href="#cb57-967" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-968"><a href="#cb57-968" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-969"><a href="#cb57-969" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span>
<span id="cb57-970"><a href="#cb57-970" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-971"><a href="#cb57-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-972"><a href="#cb57-972" aria-hidden="true" tabindex="-1"></a>Now, let<span class="st">'s define the chart and chart entry classes for the Earley algorithm:</span></span>
<span id="cb57-973"><a href="#cb57-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-974"><a href="#cb57-974" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-975"><a href="#cb57-975" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb57-976"><a href="#cb57-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-977"><a href="#cb57-977" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb57-978"><a href="#cb57-978" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart entry for a Earley chart</span></span>
<span id="cb57-979"><a href="#cb57-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-980"><a href="#cb57-980" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-981"><a href="#cb57-981" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-982"><a href="#cb57-982" aria-hidden="true" tabindex="-1"></a><span class="st">    dotted_rule</span></span>
<span id="cb57-983"><a href="#cb57-983" aria-hidden="true" tabindex="-1"></a><span class="st">    backpointers</span></span>
<span id="cb57-984"><a href="#cb57-984" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-985"><a href="#cb57-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-986"><a href="#cb57-986" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb57-987"><a href="#cb57-987" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb57-988"><a href="#cb57-988" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb57-989"><a href="#cb57-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-990"><a href="#cb57-990" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb57-991"><a href="#cb57-991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb57-992"><a href="#cb57-992" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-993"><a href="#cb57-993" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-994"><a href="#cb57-994" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-995"><a href="#cb57-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-996"><a href="#cb57-996" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-997"><a href="#cb57-997" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-998"><a href="#cb57-998" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-999"><a href="#cb57-999" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1000"><a href="#cb57-1000" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb57-1001"><a href="#cb57-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1002"><a href="#cb57-1002" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1003"><a href="#cb57-1003" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb57-1004"><a href="#cb57-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1005"><a href="#cb57-1005" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1006"><a href="#cb57-1006" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb57-1007"><a href="#cb57-1007" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb57-1008"><a href="#cb57-1008" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1009"><a href="#cb57-1009" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1010"><a href="#cb57-1010" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb57-1011"><a href="#cb57-1011" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb57-1012"><a href="#cb57-1012" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1013"><a href="#cb57-1013" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1014"><a href="#cb57-1014" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1015"><a href="#cb57-1015" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb57-1016"><a href="#cb57-1016" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1017"><a href="#cb57-1017" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1018"><a href="#cb57-1018" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-1019"><a href="#cb57-1019" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb57-1020"><a href="#cb57-1020" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1021"><a href="#cb57-1021" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1022"><a href="#cb57-1022" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1023"><a href="#cb57-1023" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb57-1024"><a href="#cb57-1024" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1025"><a href="#cb57-1025" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb57-1026"><a href="#cb57-1026" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete this entry with another entry</span></span>
<span id="cb57-1027"><a href="#cb57-1027" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1028"><a href="#cb57-1028" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1029"><a href="#cb57-1029" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1030"><a href="#cb57-1030" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1031"><a href="#cb57-1031" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry that completes this one</span></span>
<span id="cb57-1032"><a href="#cb57-1032" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-1033"><a href="#cb57-1033" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-1034"><a href="#cb57-1034" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1035"><a href="#cb57-1035" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1036"><a href="#cb57-1036" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1037"><a href="#cb57-1037" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChartEntry</span></span>
<span id="cb57-1038"><a href="#cb57-1038" aria-hidden="true" tabindex="-1"></a><span class="st">            A new entry with the dot advanced</span></span>
<span id="cb57-1039"><a href="#cb57-1039" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1040"><a href="#cb57-1040" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb57-1041"><a href="#cb57-1041" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1042"><a href="#cb57-1042" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb57-1043"><a href="#cb57-1043" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb57-1044"><a href="#cb57-1044" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1045"><a href="#cb57-1045" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb57-1046"><a href="#cb57-1046" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1047"><a href="#cb57-1047" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1048"><a href="#cb57-1048" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Check if this entry completes another entry</span></span>
<span id="cb57-1049"><a href="#cb57-1049" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1050"><a href="#cb57-1050" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1051"><a href="#cb57-1051" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1052"><a href="#cb57-1052" aria-hidden="true" tabindex="-1"></a><span class="st">        other : EarleyChartEntry</span></span>
<span id="cb57-1053"><a href="#cb57-1053" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to check</span></span>
<span id="cb57-1054"><a href="#cb57-1054" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1055"><a href="#cb57-1055" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1056"><a href="#cb57-1056" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1057"><a href="#cb57-1057" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-1058"><a href="#cb57-1058" aria-hidden="true" tabindex="-1"></a><span class="st">            True if this entry completes the other entry</span></span>
<span id="cb57-1059"><a href="#cb57-1059" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1060"><a href="#cb57-1060" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb57-1061"><a href="#cb57-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1062"><a href="#cb57-1062" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb57-1063"><a href="#cb57-1063" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart for an Earley parser</span></span>
<span id="cb57-1064"><a href="#cb57-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1065"><a href="#cb57-1065" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1066"><a href="#cb57-1066" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1067"><a href="#cb57-1067" aria-hidden="true" tabindex="-1"></a><span class="st">    input_size</span></span>
<span id="cb57-1068"><a href="#cb57-1068" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1069"><a href="#cb57-1069" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb57-1070"><a href="#cb57-1070" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb57-1071"><a href="#cb57-1071" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1072"><a href="#cb57-1072" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb57-1073"><a href="#cb57-1073" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-1074"><a href="#cb57-1074" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb57-1075"><a href="#cb57-1075" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1076"><a href="#cb57-1076" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb57-1077"><a href="#cb57-1077" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb57-1078"><a href="#cb57-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1079"><a href="#cb57-1079" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-1080"><a href="#cb57-1080" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb57-1081"><a href="#cb57-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1082"><a href="#cb57-1082" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1083"><a href="#cb57-1083" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb57-1084"><a href="#cb57-1084" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb57-1085"><a href="#cb57-1085" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-1086"><a href="#cb57-1086" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb57-1087"><a href="#cb57-1087" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-1088"><a href="#cb57-1088" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1089"><a href="#cb57-1089" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-1090"><a href="#cb57-1090" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb57-1091"><a href="#cb57-1091" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb57-1092"><a href="#cb57-1092" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-1093"><a href="#cb57-1093" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1094"><a href="#cb57-1094" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-1095"><a href="#cb57-1095" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb57-1096"><a href="#cb57-1096" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1097"><a href="#cb57-1097" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-1098"><a href="#cb57-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1099"><a href="#cb57-1099" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb57-1100"><a href="#cb57-1100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Construct the parses implied by the chart</span></span>
<span id="cb57-1101"><a href="#cb57-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1102"><a href="#cb57-1102" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1103"><a href="#cb57-1103" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1104"><a href="#cb57-1104" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1105"><a href="#cb57-1105" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to construct the parse from</span></span>
<span id="cb57-1106"><a href="#cb57-1106" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1107"><a href="#cb57-1107" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1108"><a href="#cb57-1108" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1109"><a href="#cb57-1109" aria-hidden="true" tabindex="-1"></a><span class="st">        Tree</span></span>
<span id="cb57-1110"><a href="#cb57-1110" aria-hidden="true" tabindex="-1"></a><span class="st">            The parse tree</span></span>
<span id="cb57-1111"><a href="#cb57-1111" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1112"><a href="#cb57-1112" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb57-1113"><a href="#cb57-1113" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb57-1114"><a href="#cb57-1114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1115"><a href="#cb57-1115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb57-1116"><a href="#cb57-1116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb57-1117"><a href="#cb57-1117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb57-1118"><a href="#cb57-1118" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb57-1119"><a href="#cb57-1119" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1120"><a href="#cb57-1120" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb57-1121"><a href="#cb57-1121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb57-1122"><a href="#cb57-1122" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb57-1123"><a href="#cb57-1123" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb57-1124"><a href="#cb57-1124" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb57-1125"><a href="#cb57-1125" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb57-1126"><a href="#cb57-1126" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb57-1127"><a href="#cb57-1127" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb57-1128"><a href="#cb57-1128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1129"><a href="#cb57-1129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb57-1130"><a href="#cb57-1130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1131"><a href="#cb57-1131" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1132"><a href="#cb57-1132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-1133"><a href="#cb57-1133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb57-1134"><a href="#cb57-1134" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1135"><a href="#cb57-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1136"><a href="#cb57-1136" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s the implementation of the `EarleyParser` class:</span></span>
<span id="cb57-1137"><a href="#cb57-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1138"><a href="#cb57-1138" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1139"><a href="#cb57-1139" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb57-1140"><a href="#cb57-1140" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb57-1141"><a href="#cb57-1141" aria-hidden="true" tabindex="-1"></a><span class="st">    An Earley parser</span></span>
<span id="cb57-1142"><a href="#cb57-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1143"><a href="#cb57-1143" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1144"><a href="#cb57-1144" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1145"><a href="#cb57-1145" aria-hidden="true" tabindex="-1"></a><span class="st">    grammar : ContextFreeGrammar</span></span>
<span id="cb57-1146"><a href="#cb57-1146" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1147"><a href="#cb57-1147" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-1148"><a href="#cb57-1148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1149"><a href="#cb57-1149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb57-1150"><a href="#cb57-1150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1151"><a href="#cb57-1151" aria-hidden="true" tabindex="-1"></a><span class="st">        Fill the chart using the Earley algorithm</span></span>
<span id="cb57-1152"><a href="#cb57-1152" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1153"><a href="#cb57-1153" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1154"><a href="#cb57-1154" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1155"><a href="#cb57-1155" aria-hidden="true" tabindex="-1"></a><span class="st">        string : list[str]</span></span>
<span id="cb57-1156"><a href="#cb57-1156" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-1157"><a href="#cb57-1157" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1158"><a href="#cb57-1158" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1159"><a href="#cb57-1159" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1160"><a href="#cb57-1160" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChart</span></span>
<span id="cb57-1161"><a href="#cb57-1161" aria-hidden="true" tabindex="-1"></a><span class="st">            The filled chart</span></span>
<span id="cb57-1162"><a href="#cb57-1162" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1163"><a href="#cb57-1163" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb57-1164"><a href="#cb57-1164" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb57-1165"><a href="#cb57-1165" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1166"><a href="#cb57-1166" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb57-1167"><a href="#cb57-1167" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb57-1168"><a href="#cb57-1168" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1169"><a href="#cb57-1169" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb57-1170"><a href="#cb57-1170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb57-1171"><a href="#cb57-1171" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb57-1172"><a href="#cb57-1172" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-1173"><a href="#cb57-1173" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb57-1174"><a href="#cb57-1174" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1175"><a href="#cb57-1175" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb57-1176"><a href="#cb57-1176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb57-1177"><a href="#cb57-1177" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb57-1178"><a href="#cb57-1178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb57-1179"><a href="#cb57-1179" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb57-1180"><a href="#cb57-1180" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb57-1181"><a href="#cb57-1181" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1182"><a href="#cb57-1182" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb57-1183"><a href="#cb57-1183" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb57-1184"><a href="#cb57-1184" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb57-1185"><a href="#cb57-1185" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb57-1186"><a href="#cb57-1186" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-1187"><a href="#cb57-1187" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-1188"><a href="#cb57-1188" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb57-1189"><a href="#cb57-1189" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-1190"><a href="#cb57-1190" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb57-1191"><a href="#cb57-1191" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-1192"><a href="#cb57-1192" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb57-1193"><a href="#cb57-1193" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb57-1194"><a href="#cb57-1194" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb57-1195"><a href="#cb57-1195" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-1196"><a href="#cb57-1196" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb57-1197"><a href="#cb57-1197" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb57-1198"><a href="#cb57-1198" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb57-1199"><a href="#cb57-1199" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1200"><a href="#cb57-1200" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb57-1201"><a href="#cb57-1201" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb57-1202"><a href="#cb57-1202" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb57-1203"><a href="#cb57-1203" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1204"><a href="#cb57-1204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb57-1205"><a href="#cb57-1205" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-1206"><a href="#cb57-1206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-1207"><a href="#cb57-1207" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1208"><a href="#cb57-1208" aria-hidden="true" tabindex="-1"></a><span class="st">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb57-1209"><a href="#cb57-1209" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1210"><a href="#cb57-1210" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1211"><a href="#cb57-1211" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1212"><a href="#cb57-1212" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-1213"><a href="#cb57-1213" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-1214"><a href="#cb57-1214" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1215"><a href="#cb57-1215" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to predict from</span></span>
<span id="cb57-1216"><a href="#cb57-1216" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-1217"><a href="#cb57-1217" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-1218"><a href="#cb57-1218" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1219"><a href="#cb57-1219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb57-1220"><a href="#cb57-1220" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb57-1221"><a href="#cb57-1221" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb57-1222"><a href="#cb57-1222" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-1223"><a href="#cb57-1223" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1224"><a href="#cb57-1224" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb57-1225"><a href="#cb57-1225" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb57-1226"><a href="#cb57-1226" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-1227"><a href="#cb57-1227" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1228"><a href="#cb57-1228" aria-hidden="true" tabindex="-1"></a><span class="st">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb57-1229"><a href="#cb57-1229" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1230"><a href="#cb57-1230" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1231"><a href="#cb57-1231" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1232"><a href="#cb57-1232" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-1233"><a href="#cb57-1233" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-1234"><a href="#cb57-1234" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1235"><a href="#cb57-1235" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to scan from</span></span>
<span id="cb57-1236"><a href="#cb57-1236" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-1237"><a href="#cb57-1237" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-1238"><a href="#cb57-1238" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1239"><a href="#cb57-1239" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb57-1240"><a href="#cb57-1240" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-1241"><a href="#cb57-1241" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1242"><a href="#cb57-1242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb57-1243"><a href="#cb57-1243" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb57-1244"><a href="#cb57-1244" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb57-1245"><a href="#cb57-1245" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-1246"><a href="#cb57-1246" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-1247"><a href="#cb57-1247" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1248"><a href="#cb57-1248" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb57-1249"><a href="#cb57-1249" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-1250"><a href="#cb57-1250" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb57-1251"><a href="#cb57-1251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1252"><a href="#cb57-1252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb57-1253"><a href="#cb57-1253" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-1254"><a href="#cb57-1254" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb57-1255"><a href="#cb57-1255" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1256"><a href="#cb57-1256" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-1257"><a href="#cb57-1257" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1258"><a href="#cb57-1258" aria-hidden="true" tabindex="-1"></a><span class="st">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb57-1259"><a href="#cb57-1259" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1260"><a href="#cb57-1260" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1261"><a href="#cb57-1261" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1262"><a href="#cb57-1262" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-1263"><a href="#cb57-1263" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-1264"><a href="#cb57-1264" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1265"><a href="#cb57-1265" aria-hidden="true" tabindex="-1"></a><span class="st">            The completed entry</span></span>
<span id="cb57-1266"><a href="#cb57-1266" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-1267"><a href="#cb57-1267" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-1268"><a href="#cb57-1268" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1269"><a href="#cb57-1269" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb57-1270"><a href="#cb57-1270" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1271"><a href="#cb57-1271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb57-1272"><a href="#cb57-1272" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb57-1273"><a href="#cb57-1273" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb57-1274"><a href="#cb57-1274" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1275"><a href="#cb57-1275" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb57-1276"><a href="#cb57-1276" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1277"><a href="#cb57-1277" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-1278"><a href="#cb57-1278" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1279"><a href="#cb57-1279" aria-hidden="true" tabindex="-1"></a><span class="st">        Parse a string to find all possible parse trees</span></span>
<span id="cb57-1280"><a href="#cb57-1280" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1281"><a href="#cb57-1281" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1282"><a href="#cb57-1282" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1283"><a href="#cb57-1283" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-1284"><a href="#cb57-1284" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-1285"><a href="#cb57-1285" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1286"><a href="#cb57-1286" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1287"><a href="#cb57-1287" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1288"><a href="#cb57-1288" aria-hidden="true" tabindex="-1"></a><span class="st">        set[Tree]</span></span>
<span id="cb57-1289"><a href="#cb57-1289" aria-hidden="true" tabindex="-1"></a><span class="st">            The set of all possible parse trees</span></span>
<span id="cb57-1290"><a href="#cb57-1290" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1291"><a href="#cb57-1291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-1292"><a href="#cb57-1292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-1293"><a href="#cb57-1293" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-1294"><a href="#cb57-1294" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1295"><a href="#cb57-1295" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-1296"><a href="#cb57-1296" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-1297"><a href="#cb57-1297" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1298"><a href="#cb57-1298" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb57-1299"><a href="#cb57-1299" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb57-1300"><a href="#cb57-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1301"><a href="#cb57-1301" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-1302"><a href="#cb57-1302" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1303"><a href="#cb57-1303" aria-hidden="true" tabindex="-1"></a><span class="st">        Recognize whether a string is in the language</span></span>
<span id="cb57-1304"><a href="#cb57-1304" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1305"><a href="#cb57-1305" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1306"><a href="#cb57-1306" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1307"><a href="#cb57-1307" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-1308"><a href="#cb57-1308" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to recognize</span></span>
<span id="cb57-1309"><a href="#cb57-1309" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1310"><a href="#cb57-1310" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1311"><a href="#cb57-1311" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1312"><a href="#cb57-1312" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-1313"><a href="#cb57-1313" aria-hidden="true" tabindex="-1"></a><span class="st">            True if the string is in the language, False otherwise</span></span>
<span id="cb57-1314"><a href="#cb57-1314" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1315"><a href="#cb57-1315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-1316"><a href="#cb57-1316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-1317"><a href="#cb57-1317" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-1318"><a href="#cb57-1318" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1319"><a href="#cb57-1319" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-1320"><a href="#cb57-1320" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-1321"><a href="#cb57-1321" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1322"><a href="#cb57-1322" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb57-1323"><a href="#cb57-1323" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb57-1324"><a href="#cb57-1324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-1325"><a href="#cb57-1325" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb57-1326"><a href="#cb57-1326" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb57-1327"><a href="#cb57-1327" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-1328"><a href="#cb57-1328" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1329"><a href="#cb57-1329" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-1330"><a href="#cb57-1330" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb57-1331"><a href="#cb57-1331" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1332"><a href="#cb57-1332" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb57-1333"><a href="#cb57-1333" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1334"><a href="#cb57-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1335"><a href="#cb57-1335" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed Example: Parsing "unhappiness"</span></span>
<span id="cb57-1336"><a href="#cb57-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1337"><a href="#cb57-1337" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s walk through a detailed example of the Earley algorithm parsing the word "unhappiness" with the segmentation `["un", "happy", "ness"]` using our simplified grammar:</span></span>
<span id="cb57-1338"><a href="#cb57-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1339"><a href="#cb57-1339" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1340"><a href="#cb57-1340" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-1341"><a href="#cb57-1341" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb57-1342"><a href="#cb57-1342" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-1343"><a href="#cb57-1343" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-1344"><a href="#cb57-1344" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb57-1345"><a href="#cb57-1345" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-1346"><a href="#cb57-1346" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb57-1347"><a href="#cb57-1347" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb57-1348"><a href="#cb57-1348" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb57-1349"><a href="#cb57-1349" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb57-1350"><a href="#cb57-1350" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-1351"><a href="#cb57-1351" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-1352"><a href="#cb57-1352" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-1353"><a href="#cb57-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1354"><a href="#cb57-1354" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb57-1355"><a href="#cb57-1355" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb57-1356"><a href="#cb57-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1357"><a href="#cb57-1357" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb57-1358"><a href="#cb57-1358" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb57-1359"><a href="#cb57-1359" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1360"><a href="#cb57-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1361"><a href="#cb57-1361" aria-hidden="true" tabindex="-1"></a><span class="co">### Step-by-Step Chart Filling</span></span>
<span id="cb57-1362"><a href="#cb57-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1363"><a href="#cb57-1363" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s trace the Earley algorithm as it fills the chart for "unhappiness":</span></span>
<span id="cb57-1364"><a href="#cb57-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1365"><a href="#cb57-1365" aria-hidden="true" tabindex="-1"></a><span class="er">#### Chart</span>[<span class="dv">0</span>]: Initial State</span>
<span id="cb57-1366"><a href="#cb57-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1367"><a href="#cb57-1367" aria-hidden="true" tabindex="-1"></a>First, we initialize chart[<span class="dv">0</span>] <span class="cf">with</span> a dotted rule <span class="cf">for</span> the start symbol `Word`:</span>
<span id="cb57-1368"><a href="#cb57-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1369"><a href="#cb57-1369" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Add `Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]` (<span class="im">from</span> start symbol rule)</span>
<span id="cb57-1370"><a href="#cb57-1370" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply predict:</span>
<span id="cb57-1371"><a href="#cb57-1371" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Word <span class="op">-&gt;</span> • N`:</span>
<span id="cb57-1372"><a href="#cb57-1372" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-1373"><a href="#cb57-1373" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply predict again:</span>
<span id="cb57-1374"><a href="#cb57-1374" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> • Adj Suffix`:</span>
<span id="cb57-1375"><a href="#cb57-1375" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-1376"><a href="#cb57-1376" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-1377"><a href="#cb57-1377" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict again:</span>
<span id="cb57-1378"><a href="#cb57-1378" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • Prefix Adj`:</span>
<span id="cb57-1379"><a href="#cb57-1379" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-1380"><a href="#cb57-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1381"><a href="#cb57-1381" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">0</span>] now looks like:</span>
<span id="cb57-1382"><a href="#cb57-1382" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1383"><a href="#cb57-1383" aria-hidden="true" tabindex="-1"></a>Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-1384"><a href="#cb57-1384" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-1385"><a href="#cb57-1385" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-1386"><a href="#cb57-1386" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-1387"><a href="#cb57-1387" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-1388"><a href="#cb57-1388" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1389"><a href="#cb57-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1390"><a href="#cb57-1390" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[1]: After Processing "un"</span></span>
<span id="cb57-1391"><a href="#cb57-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1392"><a href="#cb57-1392" aria-hidden="true" tabindex="-1"></a>Now we process the first <span class="bu">input</span> symbol <span class="st">"un"</span>:</span>
<span id="cb57-1393"><a href="#cb57-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1394"><a href="#cb57-1394" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-1395"><a href="#cb57-1395" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]`:</span>
<span id="cb57-1396"><a href="#cb57-1396" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` (complete)</span>
<span id="cb57-1397"><a href="#cb57-1397" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-1398"><a href="#cb57-1398" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` (complete):</span>
<span id="cb57-1399"><a href="#cb57-1399" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> Prefix</span>
<span id="cb57-1400"><a href="#cb57-1400" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]`</span>
<span id="cb57-1401"><a href="#cb57-1401" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply predict:</span>
<span id="cb57-1402"><a href="#cb57-1402" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-1403"><a href="#cb57-1403" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-1404"><a href="#cb57-1404" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-1405"><a href="#cb57-1405" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict again:</span>
<span id="cb57-1406"><a href="#cb57-1406" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-1407"><a href="#cb57-1407" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-1408"><a href="#cb57-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1409"><a href="#cb57-1409" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">1</span>] now looks like:</span>
<span id="cb57-1410"><a href="#cb57-1410" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1411"><a href="#cb57-1411" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb57-1412"><a href="#cb57-1412" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb57-1413"><a href="#cb57-1413" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-1414"><a href="#cb57-1414" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-1415"><a href="#cb57-1415" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-1416"><a href="#cb57-1416" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1417"><a href="#cb57-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1418"><a href="#cb57-1418" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[2]: After Processing "happy"</span></span>
<span id="cb57-1419"><a href="#cb57-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1420"><a href="#cb57-1420" aria-hidden="true" tabindex="-1"></a>Now we process the second <span class="bu">input</span> symbol <span class="st">"happy"</span>:</span>
<span id="cb57-1421"><a href="#cb57-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1422"><a href="#cb57-1422" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-1423"><a href="#cb57-1423" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-1424"><a href="#cb57-1424" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-1425"><a href="#cb57-1425" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-1426"><a href="#cb57-1426" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` (complete):</span>
<span id="cb57-1427"><a href="#cb57-1427" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]` waiting <span class="cf">for</span> Adj</span>
<span id="cb57-1428"><a href="#cb57-1428" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-1429"><a href="#cb57-1429" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply complete again:</span>
<span id="cb57-1430"><a href="#cb57-1430" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` (complete):</span>
<span id="cb57-1431"><a href="#cb57-1431" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> Adj</span>
<span id="cb57-1432"><a href="#cb57-1432" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]`</span>
<span id="cb57-1433"><a href="#cb57-1433" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict:</span>
<span id="cb57-1434"><a href="#cb57-1434" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]`:</span>
<span id="cb57-1435"><a href="#cb57-1435" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]`</span>
<span id="cb57-1436"><a href="#cb57-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1437"><a href="#cb57-1437" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">2</span>] now looks like:</span>
<span id="cb57-1438"><a href="#cb57-1438" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1439"><a href="#cb57-1439" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb57-1440"><a href="#cb57-1440" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb57-1441"><a href="#cb57-1441" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb57-1442"><a href="#cb57-1442" aria-hidden="true" tabindex="-1"></a>Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb57-1443"><a href="#cb57-1443" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1444"><a href="#cb57-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1445"><a href="#cb57-1445" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[3]: After Processing "ness"</span></span>
<span id="cb57-1446"><a href="#cb57-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1447"><a href="#cb57-1447" aria-hidden="true" tabindex="-1"></a>Finally, we process the third <span class="bu">input</span> symbol <span class="st">"ness"</span>:</span>
<span id="cb57-1448"><a href="#cb57-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1449"><a href="#cb57-1449" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-1450"><a href="#cb57-1450" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]`:</span>
<span id="cb57-1451"><a href="#cb57-1451" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-1452"><a href="#cb57-1452" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-1453"><a href="#cb57-1453" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` (complete):</span>
<span id="cb57-1454"><a href="#cb57-1454" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]` waiting <span class="cf">for</span> Suffix</span>
<span id="cb57-1455"><a href="#cb57-1455" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-1456"><a href="#cb57-1456" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply complete again:</span>
<span id="cb57-1457"><a href="#cb57-1457" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete):</span>
<span id="cb57-1458"><a href="#cb57-1458" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> N</span>
<span id="cb57-1459"><a href="#cb57-1459" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-1460"><a href="#cb57-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1461"><a href="#cb57-1461" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">3</span>] now looks like:</span>
<span id="cb57-1462"><a href="#cb57-1462" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1463"><a href="#cb57-1463" aria-hidden="true" tabindex="-1"></a>Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb57-1464"><a href="#cb57-1464" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]</span>
<span id="cb57-1465"><a href="#cb57-1465" aria-hidden="true" tabindex="-1"></a>Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]</span>
<span id="cb57-1466"><a href="#cb57-1466" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1467"><a href="#cb57-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1468"><a href="#cb57-1468" aria-hidden="true" tabindex="-1"></a>Since there<span class="st">'s a completed dotted rule for the start symbol `Word` that spans the entire input (0 to 3), the word "unhappiness" is in the language defined by our grammar.</span></span>
<span id="cb57-1469"><a href="#cb57-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1470"><a href="#cb57-1470" aria-hidden="true" tabindex="-1"></a><span class="er">### Visualizing the Chart State</span></span>
<span id="cb57-1471"><a href="#cb57-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1472"><a href="#cb57-1472" aria-hidden="true" tabindex="-1"></a>We can visualize the entire chart <span class="im">as</span> follows:</span>
<span id="cb57-1473"><a href="#cb57-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1474"><a href="#cb57-1474" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1475"><a href="#cb57-1475" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-1476"><a href="#cb57-1476" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>      Chart[<span class="dv">0</span>]         <span class="op">|</span>        Chart[<span class="dv">1</span>]          <span class="op">|</span>        Chart[<span class="dv">2</span>]          <span class="op">|</span>        Chart[<span class="dv">3</span>]          <span class="op">|</span></span>
<span id="cb57-1477"><a href="#cb57-1477" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-1478"><a href="#cb57-1478" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]     <span class="op">|</span> Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]     <span class="op">|</span> Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]     <span class="op">|</span> Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]   <span class="op">|</span></span>
<span id="cb57-1479"><a href="#cb57-1479" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]<span class="op">|</span> N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]  <span class="op">|</span></span>
<span id="cb57-1480"><a href="#cb57-1480" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]  <span class="op">|</span> Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]     <span class="op">|</span> N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]  <span class="op">|</span> Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]        <span class="op">|</span></span>
<span id="cb57-1481"><a href="#cb57-1481" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">|</span> Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]   <span class="op">|</span>                        <span class="op">|</span></span>
<span id="cb57-1482"><a href="#cb57-1482" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]  <span class="op">|</span> Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]     <span class="op">|</span>                         <span class="op">|</span>                        <span class="op">|</span></span>
<span id="cb57-1483"><a href="#cb57-1483" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-1484"><a href="#cb57-1484" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1485"><a href="#cb57-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1486"><a href="#cb57-1486" aria-hidden="true" tabindex="-1"></a><span class="co">### Reconstructing the Parse Tree</span></span>
<span id="cb57-1487"><a href="#cb57-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1488"><a href="#cb57-1488" aria-hidden="true" tabindex="-1"></a>From the completed dotted rule `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>], we can reconstruct the parse tree by following the backpointers:</span>
<span id="cb57-1489"><a href="#cb57-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1490"><a href="#cb57-1490" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Start <span class="cf">with</span> `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-1491"><a href="#cb57-1491" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Follow the backpointer to `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-1492"><a href="#cb57-1492" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Follow the backpointer to `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` <span class="kw">in</span> Chart[<span class="dv">2</span>]</span>
<span id="cb57-1493"><a href="#cb57-1493" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Follow the backpointer to `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` <span class="kw">in</span> Chart[<span class="dv">1</span>]</span>
<span id="cb57-1494"><a href="#cb57-1494" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> Follow the backpointer to `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` <span class="kw">in</span> Chart[<span class="dv">2</span>]</span>
<span id="cb57-1495"><a href="#cb57-1495" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span> Follow the backpointer to `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-1496"><a href="#cb57-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1497"><a href="#cb57-1497" aria-hidden="true" tabindex="-1"></a>This gives us the parse tree:</span>
<span id="cb57-1498"><a href="#cb57-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1499"><a href="#cb57-1499" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1500"><a href="#cb57-1500" aria-hidden="true" tabindex="-1"></a>       Word</span>
<span id="cb57-1501"><a href="#cb57-1501" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span></span>
<span id="cb57-1502"><a href="#cb57-1502" aria-hidden="true" tabindex="-1"></a>        N</span>
<span id="cb57-1503"><a href="#cb57-1503" aria-hidden="true" tabindex="-1"></a>       <span class="op">/</span> <span class="op">\</span></span>
<span id="cb57-1504"><a href="#cb57-1504" aria-hidden="true" tabindex="-1"></a>     Adj  Suffix</span>
<span id="cb57-1505"><a href="#cb57-1505" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span>  \    <span class="op">|</span></span>
<span id="cb57-1506"><a href="#cb57-1506" aria-hidden="true" tabindex="-1"></a>Prefix Adj  ness</span>
<span id="cb57-1507"><a href="#cb57-1507" aria-hidden="true" tabindex="-1"></a>   <span class="op">|</span>    <span class="op">|</span></span>
<span id="cb57-1508"><a href="#cb57-1508" aria-hidden="true" tabindex="-1"></a>  un  happy</span>
<span id="cb57-1509"><a href="#cb57-1509" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1510"><a href="#cb57-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1511"><a href="#cb57-1511" aria-hidden="true" tabindex="-1"></a>This tree correctly captures the structure `((un<span class="op">+</span>happy)<span class="op">+</span>ness)`.</span>
<span id="cb57-1512"><a href="#cb57-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1513"><a href="#cb57-1513" aria-hidden="true" tabindex="-1"></a><span class="co">## Handling Ambiguity: The "unlockable" Example</span></span>
<span id="cb57-1514"><a href="#cb57-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1515"><a href="#cb57-1515" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s revisit the ambiguous word "unlockable", which has two possible interpretations:</span></span>
<span id="cb57-1516"><a href="#cb57-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1517"><a href="#cb57-1517" aria-hidden="true" tabindex="-1"></a><span class="er">1. `un + </span>(lock <span class="op">+</span> able)` <span class="op">=</span> <span class="st">"not able to be locked"</span></span>
<span id="cb57-1518"><a href="#cb57-1518" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> `(un <span class="op">+</span> lock) <span class="op">+</span> able` <span class="op">=</span> <span class="st">"able to be unlocked"</span></span>
<span id="cb57-1519"><a href="#cb57-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1520"><a href="#cb57-1520" aria-hidden="true" tabindex="-1"></a>With the Earley algorithm, we can handle this ambiguity naturally. Let<span class="st">'s create a grammar that captures both interpretations:</span></span>
<span id="cb57-1521"><a href="#cb57-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1522"><a href="#cb57-1522" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1523"><a href="#cb57-1523" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-1524"><a href="#cb57-1524" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb57-1525"><a href="#cb57-1525" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-1526"><a href="#cb57-1526" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-1527"><a href="#cb57-1527" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb57-1528"><a href="#cb57-1528" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-1529"><a href="#cb57-1529" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb57-1530"><a href="#cb57-1530" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb57-1531"><a href="#cb57-1531" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb57-1532"><a href="#cb57-1532" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb57-1533"><a href="#cb57-1533" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb57-1534"><a href="#cb57-1534" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-1535"><a href="#cb57-1535" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-1536"><a href="#cb57-1536" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-1537"><a href="#cb57-1537" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1538"><a href="#cb57-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1539"><a href="#cb57-1539" aria-hidden="true" tabindex="-1"></a>When we parse <span class="st">"unlockable"</span> <span class="cf">with</span> Earley, we<span class="st">'ll end up with two completed dotted rules in the final chart:</span></span>
<span id="cb57-1540"><a href="#cb57-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1541"><a href="#cb57-1541" aria-hidden="true" tabindex="-1"></a><span class="er">1. `Word -&gt; Adj • </span>[<span class="dv">0</span>,<span class="dv">3</span>]` where Adj comes <span class="im">from</span> `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">3</span>]` (un <span class="op">+</span> lockable)</span>
<span id="cb57-1542"><a href="#cb57-1542" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> `Word <span class="op">-&gt;</span> Adj • [<span class="dv">0</span>,<span class="dv">3</span>]` where Adj comes <span class="im">from</span> `Adj <span class="op">-&gt;</span> V Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (unlock <span class="op">+</span> able)</span>
<span id="cb57-1543"><a href="#cb57-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1544"><a href="#cb57-1544" aria-hidden="true" tabindex="-1"></a>Both of these analyses derive `Word`, resulting <span class="kw">in</span> two different parse trees:</span>
<span id="cb57-1545"><a href="#cb57-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1546"><a href="#cb57-1546" aria-hidden="true" tabindex="-1"></a>Parse Tree <span class="dv">1</span> (un <span class="op">+</span> lockable):</span>
<span id="cb57-1547"><a href="#cb57-1547" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1548"><a href="#cb57-1548" aria-hidden="true" tabindex="-1"></a>    Word</span>
<span id="cb57-1549"><a href="#cb57-1549" aria-hidden="true" tabindex="-1"></a>     <span class="op">|</span></span>
<span id="cb57-1550"><a href="#cb57-1550" aria-hidden="true" tabindex="-1"></a>    Adj</span>
<span id="cb57-1551"><a href="#cb57-1551" aria-hidden="true" tabindex="-1"></a>   <span class="op">/</span>   <span class="op">\</span></span>
<span id="cb57-1552"><a href="#cb57-1552" aria-hidden="true" tabindex="-1"></a>Prefix  Adj</span>
<span id="cb57-1553"><a href="#cb57-1553" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span>    <span class="op">/</span>  <span class="op">\</span></span>
<span id="cb57-1554"><a href="#cb57-1554" aria-hidden="true" tabindex="-1"></a> un    V  Suffix</span>
<span id="cb57-1555"><a href="#cb57-1555" aria-hidden="true" tabindex="-1"></a>       <span class="op">|</span>    <span class="op">|</span></span>
<span id="cb57-1556"><a href="#cb57-1556" aria-hidden="true" tabindex="-1"></a>     lock  able</span>
<span id="cb57-1557"><a href="#cb57-1557" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1558"><a href="#cb57-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1559"><a href="#cb57-1559" aria-hidden="true" tabindex="-1"></a>Parse Tree <span class="dv">2</span> (unlock <span class="op">+</span> able):</span>
<span id="cb57-1560"><a href="#cb57-1560" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1561"><a href="#cb57-1561" aria-hidden="true" tabindex="-1"></a>    Word</span>
<span id="cb57-1562"><a href="#cb57-1562" aria-hidden="true" tabindex="-1"></a>     <span class="op">|</span></span>
<span id="cb57-1563"><a href="#cb57-1563" aria-hidden="true" tabindex="-1"></a>    Adj</span>
<span id="cb57-1564"><a href="#cb57-1564" aria-hidden="true" tabindex="-1"></a>   <span class="op">/</span>   <span class="op">\</span></span>
<span id="cb57-1565"><a href="#cb57-1565" aria-hidden="true" tabindex="-1"></a>  V    Suffix</span>
<span id="cb57-1566"><a href="#cb57-1566" aria-hidden="true" tabindex="-1"></a> <span class="op">/</span> \     <span class="op">|</span></span>
<span id="cb57-1567"><a href="#cb57-1567" aria-hidden="true" tabindex="-1"></a>Prefix V able</span>
<span id="cb57-1568"><a href="#cb57-1568" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span>   <span class="op">|</span></span>
<span id="cb57-1569"><a href="#cb57-1569" aria-hidden="true" tabindex="-1"></a> un lock</span>
<span id="cb57-1570"><a href="#cb57-1570" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1571"><a href="#cb57-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1572"><a href="#cb57-1572" aria-hidden="true" tabindex="-1"></a>The Earley algorithm finds <span class="bu">all</span> possible parses, which <span class="kw">is</span> essential <span class="cf">for</span> accurately analyzing structurally ambiguous words.</span>
<span id="cb57-1573"><a href="#cb57-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1574"><a href="#cb57-1574" aria-hidden="true" tabindex="-1"></a><span class="co">## The Three Operations of Earley</span></span>
<span id="cb57-1575"><a href="#cb57-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1576"><a href="#cb57-1576" aria-hidden="true" tabindex="-1"></a>The Earley algorithm consists of three main operations:</span>
<span id="cb57-1577"><a href="#cb57-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1578"><a href="#cb57-1578" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Predict<span class="op">**</span>: For each dotted rule where the dot precedes a non<span class="op">-</span>terminal, add new dotted rules <span class="cf">for</span> <span class="bu">all</span> possible expansions of that non<span class="op">-</span>terminal. This operation looks ahead to determine what might come <span class="bu">next</span>.</span>
<span id="cb57-1579"><a href="#cb57-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1580"><a href="#cb57-1580" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Scan<span class="op">**</span>: For each dotted rule where the dot precedes a terminal that matches the current <span class="bu">input</span> symbol, advance the dot past that terminal. This operation represents recognizing an <span class="bu">input</span> symbol.</span>
<span id="cb57-1581"><a href="#cb57-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1582"><a href="#cb57-1582" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Complete<span class="op">**</span>: For each dotted rule where the dot <span class="kw">is</span> at the end (indicating a completed constituent), go back to the chart position where the constituent began <span class="kw">and</span> advance the dot <span class="kw">in</span> <span class="bu">all</span> dotted rules that were waiting <span class="cf">for</span> this constituent.</span>
<span id="cb57-1583"><a href="#cb57-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1584"><a href="#cb57-1584" aria-hidden="true" tabindex="-1"></a>These operations work together to efficiently parse the <span class="bu">input</span> <span class="cf">while</span> avoiding redundant work.</span>
<span id="cb57-1585"><a href="#cb57-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1586"><a href="#cb57-1586" aria-hidden="true" tabindex="-1"></a><span class="co">## Advantages of Earley for Morphological Analysis</span></span>
<span id="cb57-1587"><a href="#cb57-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1588"><a href="#cb57-1588" aria-hidden="true" tabindex="-1"></a>The Earley algorithm offers several advantages <span class="cf">for</span> morphological analysis:</span>
<span id="cb57-1589"><a href="#cb57-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1590"><a href="#cb57-1590" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Any CFG<span class="op">**</span>: Unlike CKY, Earley works <span class="cf">with</span> <span class="bu">any</span> context<span class="op">-</span>free grammar, including those <span class="cf">with</span> ε<span class="op">-</span>rules (empty productions), unary rules, <span class="kw">and</span> arbitrary rule lengths. This allows <span class="cf">for</span> more natural expression of morphological patterns.</span>
<span id="cb57-1591"><a href="#cb57-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1592"><a href="#cb57-1592" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Incremental processing<span class="op">**</span>: Earley processes the <span class="bu">input</span> left<span class="op">-</span>to<span class="op">-</span>right, which can be useful <span class="cf">for</span> interactive applications <span class="kw">or</span> streaming inputs.</span>
<span id="cb57-1593"><a href="#cb57-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1594"><a href="#cb57-1594" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Left recursion<span class="op">**</span>: Earley handles left<span class="op">-</span>recursive rules without modification, which <span class="kw">is</span> important <span class="cf">for</span> certain morphological patterns.</span>
<span id="cb57-1595"><a href="#cb57-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1596"><a href="#cb57-1596" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>Explicit predictions<span class="op">**</span>: The predict operation explicitly lists <span class="bu">all</span> the possible continuations at each position, which can be useful <span class="cf">for</span> generating suggestions <span class="kw">in</span> applications like spelling correction <span class="kw">or</span> auto<span class="op">-</span>completion.</span>
<span id="cb57-1597"><a href="#cb57-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1598"><a href="#cb57-1598" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">**</span>Efficiency<span class="op">**</span>: While the worst<span class="op">-</span>case complexity <span class="kw">is</span> O(n³), <span class="cf">for</span> many practical grammars Earley performs better, especially <span class="cf">for</span> unambiguous <span class="kw">or</span> nearly unambiguous grammars.</span>
<span id="cb57-1599"><a href="#cb57-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1600"><a href="#cb57-1600" aria-hidden="true" tabindex="-1"></a><span class="co">## Real-World Example: Predicting Next Morphemes</span></span>
<span id="cb57-1601"><a href="#cb57-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1602"><a href="#cb57-1602" aria-hidden="true" tabindex="-1"></a>One interesting application of the Earley algorithm <span class="kw">is</span> predicting what could come <span class="bu">next</span> <span class="kw">in</span> a partial word. Let<span class="st">'s extend our `EarleyParser` class to support prediction:</span></span>
<span id="cb57-1603"><a href="#cb57-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1604"><a href="#cb57-1604" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1605"><a href="#cb57-1605" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb57-1606"><a href="#cb57-1606" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb57-1607"><a href="#cb57-1607" aria-hidden="true" tabindex="-1"></a><span class="st">    Predict possible next words given a prefix</span></span>
<span id="cb57-1608"><a href="#cb57-1608" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb57-1609"><a href="#cb57-1609" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1610"><a href="#cb57-1610" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1611"><a href="#cb57-1611" aria-hidden="true" tabindex="-1"></a><span class="st">    prefix : list[str]</span></span>
<span id="cb57-1612"><a href="#cb57-1612" aria-hidden="true" tabindex="-1"></a><span class="st">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb57-1613"><a href="#cb57-1613" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1614"><a href="#cb57-1614" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb57-1615"><a href="#cb57-1615" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb57-1616"><a href="#cb57-1616" aria-hidden="true" tabindex="-1"></a><span class="st">    dict[str, set[str]]</span></span>
<span id="cb57-1617"><a href="#cb57-1617" aria-hidden="true" tabindex="-1"></a><span class="st">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb57-1618"><a href="#cb57-1618" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1619"><a href="#cb57-1619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb57-1620"><a href="#cb57-1620" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb57-1621"><a href="#cb57-1621" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1622"><a href="#cb57-1622" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb57-1623"><a href="#cb57-1623" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb57-1624"><a href="#cb57-1624" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1625"><a href="#cb57-1625" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb57-1626"><a href="#cb57-1626" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb57-1627"><a href="#cb57-1627" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb57-1628"><a href="#cb57-1628" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-1629"><a href="#cb57-1629" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1630"><a href="#cb57-1630" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb57-1631"><a href="#cb57-1631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-1632"><a href="#cb57-1632" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-1633"><a href="#cb57-1633" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-1634"><a href="#cb57-1634" aria-hidden="true" tabindex="-1"></a>            next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb57-1635"><a href="#cb57-1635" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1636"><a href="#cb57-1636" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb57-1637"><a href="#cb57-1637" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-1638"><a href="#cb57-1638" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb57-1639"><a href="#cb57-1639" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb57-1640"><a href="#cb57-1640" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-1641"><a href="#cb57-1641" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-1642"><a href="#cb57-1642" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-1643"><a href="#cb57-1643" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol].add(rule.right_side[<span class="dv">0</span>])</span>
<span id="cb57-1644"><a href="#cb57-1644" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1645"><a href="#cb57-1645" aria-hidden="true" tabindex="-1"></a>    <span class="op">---</span></span>
<span id="cb57-1646"><a href="#cb57-1646" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb57-1647"><a href="#cb57-1647" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb57-1648"><a href="#cb57-1648" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb57-1649"><a href="#cb57-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1650"><a href="#cb57-1650" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb57-1651"><a href="#cb57-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1652"><a href="#cb57-1652" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb57-1653"><a href="#cb57-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1654"><a href="#cb57-1654" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb57-1655"><a href="#cb57-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1656"><a href="#cb57-1656" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb57-1657"><a href="#cb57-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1658"><a href="#cb57-1658" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb57-1659"><a href="#cb57-1659" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb57-1660"><a href="#cb57-1660" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb57-1661"><a href="#cb57-1661" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb57-1662"><a href="#cb57-1662" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb57-1663"><a href="#cb57-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1664"><a href="#cb57-1664" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb57-1665"><a href="#cb57-1665" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb57-1666"><a href="#cb57-1666" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb57-1667"><a href="#cb57-1667" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb57-1668"><a href="#cb57-1668" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb57-1669"><a href="#cb57-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1670"><a href="#cb57-1670" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb57-1671"><a href="#cb57-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1672"><a href="#cb57-1672" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb57-1673"><a href="#cb57-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1674"><a href="#cb57-1674" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb57-1675"><a href="#cb57-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1676"><a href="#cb57-1676" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb57-1677"><a href="#cb57-1677" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb57-1678"><a href="#cb57-1678" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb57-1679"><a href="#cb57-1679" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb57-1680"><a href="#cb57-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1681"><a href="#cb57-1681" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb57-1682"><a href="#cb57-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1683"><a href="#cb57-1683" aria-hidden="true" tabindex="-1"></a><span class="co">### Earley Algorithm Pseudocode</span></span>
<span id="cb57-1684"><a href="#cb57-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1685"><a href="#cb57-1685" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s a formal pseudocode for the Earley algorithm:</span></span>
<span id="cb57-1686"><a href="#cb57-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1687"><a href="#cb57-1687" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb57-1688"><a href="#cb57-1688" aria-hidden="true" tabindex="-1"></a><span class="er">function Earley</span>(grammar, <span class="bu">input</span>):</span>
<span id="cb57-1689"><a href="#cb57-1689" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> length(<span class="bu">input</span>)</span>
<span id="cb57-1690"><a href="#cb57-1690" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1691"><a href="#cb57-1691" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the chart (n+1 sets of dotted rules)</span></span>
<span id="cb57-1692"><a href="#cb57-1692" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> new Array[n<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb57-1693"><a href="#cb57-1693" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="dv">0</span> to n:</span>
<span id="cb57-1694"><a href="#cb57-1694" aria-hidden="true" tabindex="-1"></a>        chart[i] <span class="op">=</span> new Set()</span>
<span id="cb57-1695"><a href="#cb57-1695" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1696"><a href="#cb57-1696" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize chart[0] with dotted rules for the start symbol</span></span>
<span id="cb57-1697"><a href="#cb57-1697" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> each rule S <span class="op">-&gt;</span> γ <span class="kw">in</span> grammar (where S <span class="kw">is</span> the start symbol):</span>
<span id="cb57-1698"><a href="#cb57-1698" aria-hidden="true" tabindex="-1"></a>        add (S <span class="op">-&gt;</span> • γ, <span class="dv">0</span>) to chart[<span class="dv">0</span>]</span>
<span id="cb57-1699"><a href="#cb57-1699" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1700"><a href="#cb57-1700" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill in the chart</span></span>
<span id="cb57-1701"><a href="#cb57-1701" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="dv">0</span> to n:</span>
<span id="cb57-1702"><a href="#cb57-1702" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> each state (A <span class="op">-&gt;</span> α • β, j) <span class="kw">in</span> chart[i]:</span>
<span id="cb57-1703"><a href="#cb57-1703" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> β <span class="kw">is</span> <span class="kw">not</span> empty:</span>
<span id="cb57-1704"><a href="#cb57-1704" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> β starts <span class="cf">with</span> a terminal symbol a:</span>
<span id="cb57-1705"><a href="#cb57-1705" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> i <span class="op">&lt;</span> n <span class="kw">and</span> <span class="bu">input</span>[i] <span class="op">=</span> a:  <span class="co"># Scan</span></span>
<span id="cb57-1706"><a href="#cb57-1706" aria-hidden="true" tabindex="-1"></a>                        add (A <span class="op">-&gt;</span> α a • β<span class="st">', j) to chart[i+1]</span></span>
<span id="cb57-1707"><a href="#cb57-1707" aria-hidden="true" tabindex="-1"></a><span class="er">                else if β starts with a non-terminal B:  # Predict</span></span>
<span id="cb57-1708"><a href="#cb57-1708" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> each rule B <span class="op">-&gt;</span> γ <span class="kw">in</span> grammar:</span>
<span id="cb57-1709"><a href="#cb57-1709" aria-hidden="true" tabindex="-1"></a>                        add (B <span class="op">-&gt;</span> • γ, i) to chart[i]</span>
<span id="cb57-1710"><a href="#cb57-1710" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:  <span class="co"># Complete</span></span>
<span id="cb57-1711"><a href="#cb57-1711" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> each state (C <span class="op">-&gt;</span> δ • A ζ, k) <span class="kw">in</span> chart[j]:</span>
<span id="cb57-1712"><a href="#cb57-1712" aria-hidden="true" tabindex="-1"></a>                    add (C <span class="op">-&gt;</span> δ A • ζ, k) to chart[i]</span>
<span id="cb57-1713"><a href="#cb57-1713" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1714"><a href="#cb57-1714" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continue processing chart[i] until no more items can be added</span></span>
<span id="cb57-1715"><a href="#cb57-1715" aria-hidden="true" tabindex="-1"></a>        repeat until chart[i] doesn<span class="st">'t change:</span></span>
<span id="cb57-1716"><a href="#cb57-1716" aria-hidden="true" tabindex="-1"></a><span class="er">            apply Predict and Complete operations to all items in chart</span>[i]</span>
<span id="cb57-1717"><a href="#cb57-1717" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1718"><a href="#cb57-1718" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the start symbol can derive the entire input</span></span>
<span id="cb57-1719"><a href="#cb57-1719" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">any</span> item (S <span class="op">-&gt;</span> γ •, <span class="dv">0</span>) <span class="kw">in</span> chart[n] where S <span class="kw">is</span> the start symbol</span>
<span id="cb57-1720"><a href="#cb57-1720" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1721"><a href="#cb57-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1722"><a href="#cb57-1722" aria-hidden="true" tabindex="-1"></a>For parsing (<span class="im">as</span> opposed to just recognition), we also need to keep track of backpointers to reconstruct the parse tree.</span>
<span id="cb57-1723"><a href="#cb57-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1724"><a href="#cb57-1724" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s define a `DottedRule` class that will be the core of our Earley parser:</span></span>
<span id="cb57-1725"><a href="#cb57-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1726"><a href="#cb57-1726" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1727"><a href="#cb57-1727" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb57-1728"><a href="#cb57-1728" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1729"><a href="#cb57-1729" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb57-1730"><a href="#cb57-1730" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb57-1731"><a href="#cb57-1731" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb57-1732"><a href="#cb57-1732" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb57-1733"><a href="#cb57-1733" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1734"><a href="#cb57-1734" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb57-1735"><a href="#cb57-1735" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb57-1736"><a href="#cb57-1736" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1737"><a href="#cb57-1737" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb57-1738"><a href="#cb57-1738" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb57-1739"><a href="#cb57-1739" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1740"><a href="#cb57-1740" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-1741"><a href="#cb57-1741" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-1742"><a href="#cb57-1742" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1743"><a href="#cb57-1743" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1744"><a href="#cb57-1744" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-1745"><a href="#cb57-1745" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1746"><a href="#cb57-1746" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1747"><a href="#cb57-1747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb57-1748"><a href="#cb57-1748" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb57-1749"><a href="#cb57-1749" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb57-1750"><a href="#cb57-1750" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb57-1751"><a href="#cb57-1751" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb57-1752"><a href="#cb57-1752" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1753"><a href="#cb57-1753" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb57-1754"><a href="#cb57-1754" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete the next symbol in this rule</span></span>
<span id="cb57-1755"><a href="#cb57-1755" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1756"><a href="#cb57-1756" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1757"><a href="#cb57-1757" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1758"><a href="#cb57-1758" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-1759"><a href="#cb57-1759" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-1760"><a href="#cb57-1760" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1761"><a href="#cb57-1761" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1762"><a href="#cb57-1762" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1763"><a href="#cb57-1763" aria-hidden="true" tabindex="-1"></a><span class="st">        DottedRule</span></span>
<span id="cb57-1764"><a href="#cb57-1764" aria-hidden="true" tabindex="-1"></a><span class="st">            A new dotted rule with the dot advanced</span></span>
<span id="cb57-1765"><a href="#cb57-1765" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1766"><a href="#cb57-1766" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb57-1767"><a href="#cb57-1767" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb57-1768"><a href="#cb57-1768" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1769"><a href="#cb57-1769" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb57-1770"><a href="#cb57-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1771"><a href="#cb57-1771" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1772"><a href="#cb57-1772" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1773"><a href="#cb57-1773" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb57-1774"><a href="#cb57-1774" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb57-1775"><a href="#cb57-1775" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-1776"><a href="#cb57-1776" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb57-1777"><a href="#cb57-1777" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1778"><a href="#cb57-1778" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1779"><a href="#cb57-1779" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-1780"><a href="#cb57-1780" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb57-1781"><a href="#cb57-1781" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1782"><a href="#cb57-1782" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1783"><a href="#cb57-1783" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-1784"><a href="#cb57-1784" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb57-1785"><a href="#cb57-1785" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1786"><a href="#cb57-1786" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1787"><a href="#cb57-1787" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1788"><a href="#cb57-1788" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb57-1789"><a href="#cb57-1789" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1790"><a href="#cb57-1790" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1791"><a href="#cb57-1791" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1792"><a href="#cb57-1792" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span>
<span id="cb57-1793"><a href="#cb57-1793" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1794"><a href="#cb57-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1795"><a href="#cb57-1795" aria-hidden="true" tabindex="-1"></a>Now, let<span class="st">'s define the chart and chart entry classes for the Earley algorithm:</span></span>
<span id="cb57-1796"><a href="#cb57-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1797"><a href="#cb57-1797" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1798"><a href="#cb57-1798" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb57-1799"><a href="#cb57-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1800"><a href="#cb57-1800" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb57-1801"><a href="#cb57-1801" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart entry for a Earley chart</span></span>
<span id="cb57-1802"><a href="#cb57-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1803"><a href="#cb57-1803" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1804"><a href="#cb57-1804" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1805"><a href="#cb57-1805" aria-hidden="true" tabindex="-1"></a><span class="st">    dotted_rule</span></span>
<span id="cb57-1806"><a href="#cb57-1806" aria-hidden="true" tabindex="-1"></a><span class="st">    backpointers</span></span>
<span id="cb57-1807"><a href="#cb57-1807" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1808"><a href="#cb57-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1809"><a href="#cb57-1809" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb57-1810"><a href="#cb57-1810" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb57-1811"><a href="#cb57-1811" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb57-1812"><a href="#cb57-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1813"><a href="#cb57-1813" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb57-1814"><a href="#cb57-1814" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb57-1815"><a href="#cb57-1815" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1816"><a href="#cb57-1816" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-1817"><a href="#cb57-1817" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-1818"><a href="#cb57-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1819"><a href="#cb57-1819" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1820"><a href="#cb57-1820" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-1821"><a href="#cb57-1821" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1822"><a href="#cb57-1822" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1823"><a href="#cb57-1823" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb57-1824"><a href="#cb57-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1825"><a href="#cb57-1825" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1826"><a href="#cb57-1826" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb57-1827"><a href="#cb57-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1828"><a href="#cb57-1828" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1829"><a href="#cb57-1829" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb57-1830"><a href="#cb57-1830" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb57-1831"><a href="#cb57-1831" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1832"><a href="#cb57-1832" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1833"><a href="#cb57-1833" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb57-1834"><a href="#cb57-1834" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb57-1835"><a href="#cb57-1835" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1836"><a href="#cb57-1836" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1837"><a href="#cb57-1837" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-1838"><a href="#cb57-1838" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb57-1839"><a href="#cb57-1839" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1840"><a href="#cb57-1840" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1841"><a href="#cb57-1841" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-1842"><a href="#cb57-1842" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb57-1843"><a href="#cb57-1843" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1844"><a href="#cb57-1844" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1845"><a href="#cb57-1845" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1846"><a href="#cb57-1846" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb57-1847"><a href="#cb57-1847" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1848"><a href="#cb57-1848" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb57-1849"><a href="#cb57-1849" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete this entry with another entry</span></span>
<span id="cb57-1850"><a href="#cb57-1850" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1851"><a href="#cb57-1851" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1852"><a href="#cb57-1852" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1853"><a href="#cb57-1853" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1854"><a href="#cb57-1854" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry that completes this one</span></span>
<span id="cb57-1855"><a href="#cb57-1855" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-1856"><a href="#cb57-1856" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-1857"><a href="#cb57-1857" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1858"><a href="#cb57-1858" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1859"><a href="#cb57-1859" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1860"><a href="#cb57-1860" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChartEntry</span></span>
<span id="cb57-1861"><a href="#cb57-1861" aria-hidden="true" tabindex="-1"></a><span class="st">            A new entry with the dot advanced</span></span>
<span id="cb57-1862"><a href="#cb57-1862" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1863"><a href="#cb57-1863" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb57-1864"><a href="#cb57-1864" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1865"><a href="#cb57-1865" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb57-1866"><a href="#cb57-1866" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb57-1867"><a href="#cb57-1867" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1868"><a href="#cb57-1868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb57-1869"><a href="#cb57-1869" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1870"><a href="#cb57-1870" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-1871"><a href="#cb57-1871" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Check if this entry completes another entry</span></span>
<span id="cb57-1872"><a href="#cb57-1872" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1873"><a href="#cb57-1873" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1874"><a href="#cb57-1874" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1875"><a href="#cb57-1875" aria-hidden="true" tabindex="-1"></a><span class="st">        other : EarleyChartEntry</span></span>
<span id="cb57-1876"><a href="#cb57-1876" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to check</span></span>
<span id="cb57-1877"><a href="#cb57-1877" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1878"><a href="#cb57-1878" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1879"><a href="#cb57-1879" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1880"><a href="#cb57-1880" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-1881"><a href="#cb57-1881" aria-hidden="true" tabindex="-1"></a><span class="st">            True if this entry completes the other entry</span></span>
<span id="cb57-1882"><a href="#cb57-1882" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1883"><a href="#cb57-1883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb57-1884"><a href="#cb57-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1885"><a href="#cb57-1885" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb57-1886"><a href="#cb57-1886" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart for an Earley parser</span></span>
<span id="cb57-1887"><a href="#cb57-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1888"><a href="#cb57-1888" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1889"><a href="#cb57-1889" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1890"><a href="#cb57-1890" aria-hidden="true" tabindex="-1"></a><span class="st">    input_size</span></span>
<span id="cb57-1891"><a href="#cb57-1891" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1892"><a href="#cb57-1892" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb57-1893"><a href="#cb57-1893" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb57-1894"><a href="#cb57-1894" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1895"><a href="#cb57-1895" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb57-1896"><a href="#cb57-1896" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-1897"><a href="#cb57-1897" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb57-1898"><a href="#cb57-1898" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1899"><a href="#cb57-1899" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb57-1900"><a href="#cb57-1900" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb57-1901"><a href="#cb57-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1902"><a href="#cb57-1902" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-1903"><a href="#cb57-1903" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb57-1904"><a href="#cb57-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1905"><a href="#cb57-1905" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1906"><a href="#cb57-1906" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb57-1907"><a href="#cb57-1907" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb57-1908"><a href="#cb57-1908" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-1909"><a href="#cb57-1909" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb57-1910"><a href="#cb57-1910" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-1911"><a href="#cb57-1911" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1912"><a href="#cb57-1912" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-1913"><a href="#cb57-1913" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb57-1914"><a href="#cb57-1914" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb57-1915"><a href="#cb57-1915" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-1916"><a href="#cb57-1916" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1917"><a href="#cb57-1917" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-1918"><a href="#cb57-1918" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb57-1919"><a href="#cb57-1919" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-1920"><a href="#cb57-1920" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-1921"><a href="#cb57-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1922"><a href="#cb57-1922" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb57-1923"><a href="#cb57-1923" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Construct the parses implied by the chart</span></span>
<span id="cb57-1924"><a href="#cb57-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1925"><a href="#cb57-1925" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1926"><a href="#cb57-1926" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1927"><a href="#cb57-1927" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-1928"><a href="#cb57-1928" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to construct the parse from</span></span>
<span id="cb57-1929"><a href="#cb57-1929" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1930"><a href="#cb57-1930" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1931"><a href="#cb57-1931" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1932"><a href="#cb57-1932" aria-hidden="true" tabindex="-1"></a><span class="st">        Tree</span></span>
<span id="cb57-1933"><a href="#cb57-1933" aria-hidden="true" tabindex="-1"></a><span class="st">            The parse tree</span></span>
<span id="cb57-1934"><a href="#cb57-1934" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1935"><a href="#cb57-1935" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb57-1936"><a href="#cb57-1936" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb57-1937"><a href="#cb57-1937" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1938"><a href="#cb57-1938" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb57-1939"><a href="#cb57-1939" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb57-1940"><a href="#cb57-1940" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb57-1941"><a href="#cb57-1941" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb57-1942"><a href="#cb57-1942" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-1943"><a href="#cb57-1943" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb57-1944"><a href="#cb57-1944" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb57-1945"><a href="#cb57-1945" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb57-1946"><a href="#cb57-1946" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb57-1947"><a href="#cb57-1947" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb57-1948"><a href="#cb57-1948" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb57-1949"><a href="#cb57-1949" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb57-1950"><a href="#cb57-1950" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb57-1951"><a href="#cb57-1951" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1952"><a href="#cb57-1952" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb57-1953"><a href="#cb57-1953" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1954"><a href="#cb57-1954" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-1955"><a href="#cb57-1955" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-1956"><a href="#cb57-1956" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb57-1957"><a href="#cb57-1957" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-1958"><a href="#cb57-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1959"><a href="#cb57-1959" aria-hidden="true" tabindex="-1"></a>Here<span class="st">'s the implementation of the `EarleyParser` class:</span></span>
<span id="cb57-1960"><a href="#cb57-1960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1961"><a href="#cb57-1961" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-1962"><a href="#cb57-1962" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb57-1963"><a href="#cb57-1963" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb57-1964"><a href="#cb57-1964" aria-hidden="true" tabindex="-1"></a><span class="st">    An Earley parser</span></span>
<span id="cb57-1965"><a href="#cb57-1965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1966"><a href="#cb57-1966" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-1967"><a href="#cb57-1967" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-1968"><a href="#cb57-1968" aria-hidden="true" tabindex="-1"></a><span class="st">    grammar : ContextFreeGrammar</span></span>
<span id="cb57-1969"><a href="#cb57-1969" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-1970"><a href="#cb57-1970" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-1971"><a href="#cb57-1971" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-1972"><a href="#cb57-1972" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb57-1973"><a href="#cb57-1973" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-1974"><a href="#cb57-1974" aria-hidden="true" tabindex="-1"></a><span class="st">        Fill the chart using the Earley algorithm</span></span>
<span id="cb57-1975"><a href="#cb57-1975" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-1976"><a href="#cb57-1976" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-1977"><a href="#cb57-1977" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-1978"><a href="#cb57-1978" aria-hidden="true" tabindex="-1"></a><span class="st">        string : list[str]</span></span>
<span id="cb57-1979"><a href="#cb57-1979" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-1980"><a href="#cb57-1980" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-1981"><a href="#cb57-1981" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-1982"><a href="#cb57-1982" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-1983"><a href="#cb57-1983" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChart</span></span>
<span id="cb57-1984"><a href="#cb57-1984" aria-hidden="true" tabindex="-1"></a><span class="st">            The filled chart</span></span>
<span id="cb57-1985"><a href="#cb57-1985" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-1986"><a href="#cb57-1986" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb57-1987"><a href="#cb57-1987" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb57-1988"><a href="#cb57-1988" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1989"><a href="#cb57-1989" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb57-1990"><a href="#cb57-1990" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb57-1991"><a href="#cb57-1991" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1992"><a href="#cb57-1992" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb57-1993"><a href="#cb57-1993" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb57-1994"><a href="#cb57-1994" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb57-1995"><a href="#cb57-1995" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-1996"><a href="#cb57-1996" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb57-1997"><a href="#cb57-1997" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-1998"><a href="#cb57-1998" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb57-1999"><a href="#cb57-1999" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb57-2000"><a href="#cb57-2000" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb57-2001"><a href="#cb57-2001" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb57-2002"><a href="#cb57-2002" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb57-2003"><a href="#cb57-2003" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb57-2004"><a href="#cb57-2004" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2005"><a href="#cb57-2005" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb57-2006"><a href="#cb57-2006" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb57-2007"><a href="#cb57-2007" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb57-2008"><a href="#cb57-2008" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb57-2009"><a href="#cb57-2009" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-2010"><a href="#cb57-2010" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-2011"><a href="#cb57-2011" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb57-2012"><a href="#cb57-2012" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-2013"><a href="#cb57-2013" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb57-2014"><a href="#cb57-2014" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-2015"><a href="#cb57-2015" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb57-2016"><a href="#cb57-2016" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb57-2017"><a href="#cb57-2017" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb57-2018"><a href="#cb57-2018" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-2019"><a href="#cb57-2019" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb57-2020"><a href="#cb57-2020" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb57-2021"><a href="#cb57-2021" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb57-2022"><a href="#cb57-2022" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2023"><a href="#cb57-2023" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb57-2024"><a href="#cb57-2024" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb57-2025"><a href="#cb57-2025" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb57-2026"><a href="#cb57-2026" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2027"><a href="#cb57-2027" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb57-2028"><a href="#cb57-2028" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-2029"><a href="#cb57-2029" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2030"><a href="#cb57-2030" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2031"><a href="#cb57-2031" aria-hidden="true" tabindex="-1"></a><span class="st">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb57-2032"><a href="#cb57-2032" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2033"><a href="#cb57-2033" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2034"><a href="#cb57-2034" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2035"><a href="#cb57-2035" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2036"><a href="#cb57-2036" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2037"><a href="#cb57-2037" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2038"><a href="#cb57-2038" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to predict from</span></span>
<span id="cb57-2039"><a href="#cb57-2039" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2040"><a href="#cb57-2040" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2041"><a href="#cb57-2041" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2042"><a href="#cb57-2042" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb57-2043"><a href="#cb57-2043" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb57-2044"><a href="#cb57-2044" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb57-2045"><a href="#cb57-2045" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-2046"><a href="#cb57-2046" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2047"><a href="#cb57-2047" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb57-2048"><a href="#cb57-2048" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb57-2049"><a href="#cb57-2049" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2050"><a href="#cb57-2050" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2051"><a href="#cb57-2051" aria-hidden="true" tabindex="-1"></a><span class="st">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb57-2052"><a href="#cb57-2052" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2053"><a href="#cb57-2053" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2054"><a href="#cb57-2054" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2055"><a href="#cb57-2055" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2056"><a href="#cb57-2056" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2057"><a href="#cb57-2057" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2058"><a href="#cb57-2058" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to scan from</span></span>
<span id="cb57-2059"><a href="#cb57-2059" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2060"><a href="#cb57-2060" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2061"><a href="#cb57-2061" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2062"><a href="#cb57-2062" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb57-2063"><a href="#cb57-2063" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-2064"><a href="#cb57-2064" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2065"><a href="#cb57-2065" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb57-2066"><a href="#cb57-2066" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb57-2067"><a href="#cb57-2067" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb57-2068"><a href="#cb57-2068" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-2069"><a href="#cb57-2069" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-2070"><a href="#cb57-2070" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2071"><a href="#cb57-2071" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb57-2072"><a href="#cb57-2072" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-2073"><a href="#cb57-2073" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb57-2074"><a href="#cb57-2074" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2075"><a href="#cb57-2075" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb57-2076"><a href="#cb57-2076" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-2077"><a href="#cb57-2077" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb57-2078"><a href="#cb57-2078" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2079"><a href="#cb57-2079" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2080"><a href="#cb57-2080" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2081"><a href="#cb57-2081" aria-hidden="true" tabindex="-1"></a><span class="st">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb57-2082"><a href="#cb57-2082" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2083"><a href="#cb57-2083" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2084"><a href="#cb57-2084" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2085"><a href="#cb57-2085" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2086"><a href="#cb57-2086" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2087"><a href="#cb57-2087" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2088"><a href="#cb57-2088" aria-hidden="true" tabindex="-1"></a><span class="st">            The completed entry</span></span>
<span id="cb57-2089"><a href="#cb57-2089" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2090"><a href="#cb57-2090" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2091"><a href="#cb57-2091" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2092"><a href="#cb57-2092" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb57-2093"><a href="#cb57-2093" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2094"><a href="#cb57-2094" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb57-2095"><a href="#cb57-2095" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb57-2096"><a href="#cb57-2096" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb57-2097"><a href="#cb57-2097" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2098"><a href="#cb57-2098" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb57-2099"><a href="#cb57-2099" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2100"><a href="#cb57-2100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-2101"><a href="#cb57-2101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2102"><a href="#cb57-2102" aria-hidden="true" tabindex="-1"></a><span class="st">        Parse a string to find all possible parse trees</span></span>
<span id="cb57-2103"><a href="#cb57-2103" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2104"><a href="#cb57-2104" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2105"><a href="#cb57-2105" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2106"><a href="#cb57-2106" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-2107"><a href="#cb57-2107" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-2108"><a href="#cb57-2108" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2109"><a href="#cb57-2109" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2110"><a href="#cb57-2110" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2111"><a href="#cb57-2111" aria-hidden="true" tabindex="-1"></a><span class="st">        set[Tree]</span></span>
<span id="cb57-2112"><a href="#cb57-2112" aria-hidden="true" tabindex="-1"></a><span class="st">            The set of all possible parse trees</span></span>
<span id="cb57-2113"><a href="#cb57-2113" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2114"><a href="#cb57-2114" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-2115"><a href="#cb57-2115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-2116"><a href="#cb57-2116" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-2117"><a href="#cb57-2117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2118"><a href="#cb57-2118" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-2119"><a href="#cb57-2119" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-2120"><a href="#cb57-2120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2121"><a href="#cb57-2121" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb57-2122"><a href="#cb57-2122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb57-2123"><a href="#cb57-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2124"><a href="#cb57-2124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-2125"><a href="#cb57-2125" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2126"><a href="#cb57-2126" aria-hidden="true" tabindex="-1"></a><span class="st">        Recognize whether a string is in the language</span></span>
<span id="cb57-2127"><a href="#cb57-2127" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2128"><a href="#cb57-2128" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2129"><a href="#cb57-2129" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2130"><a href="#cb57-2130" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-2131"><a href="#cb57-2131" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to recognize</span></span>
<span id="cb57-2132"><a href="#cb57-2132" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2133"><a href="#cb57-2133" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2134"><a href="#cb57-2134" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2135"><a href="#cb57-2135" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-2136"><a href="#cb57-2136" aria-hidden="true" tabindex="-1"></a><span class="st">            True if the string is in the language, False otherwise</span></span>
<span id="cb57-2137"><a href="#cb57-2137" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2138"><a href="#cb57-2138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-2139"><a href="#cb57-2139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-2140"><a href="#cb57-2140" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-2141"><a href="#cb57-2141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2142"><a href="#cb57-2142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-2143"><a href="#cb57-2143" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-2144"><a href="#cb57-2144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2145"><a href="#cb57-2145" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb57-2146"><a href="#cb57-2146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb57-2147"><a href="#cb57-2147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-2148"><a href="#cb57-2148" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb57-2149"><a href="#cb57-2149" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb57-2150"><a href="#cb57-2150" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-2151"><a href="#cb57-2151" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2152"><a href="#cb57-2152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-2153"><a href="#cb57-2153" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb57-2154"><a href="#cb57-2154" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2155"><a href="#cb57-2155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb57-2156"><a href="#cb57-2156" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2157"><a href="#cb57-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2158"><a href="#cb57-2158" aria-hidden="true" tabindex="-1"></a><span class="co">## Detailed Example: Parsing "unhappiness"</span></span>
<span id="cb57-2159"><a href="#cb57-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2160"><a href="#cb57-2160" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s walk through a detailed example of the Earley algorithm parsing the word "unhappiness" with the segmentation `["un", "happy", "ness"]` using our simplified grammar:</span></span>
<span id="cb57-2161"><a href="#cb57-2161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2162"><a href="#cb57-2162" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2163"><a href="#cb57-2163" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-2164"><a href="#cb57-2164" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb57-2165"><a href="#cb57-2165" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-2166"><a href="#cb57-2166" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-2167"><a href="#cb57-2167" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb57-2168"><a href="#cb57-2168" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-2169"><a href="#cb57-2169" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb57-2170"><a href="#cb57-2170" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb57-2171"><a href="#cb57-2171" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb57-2172"><a href="#cb57-2172" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb57-2173"><a href="#cb57-2173" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-2174"><a href="#cb57-2174" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-2175"><a href="#cb57-2175" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-2176"><a href="#cb57-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2177"><a href="#cb57-2177" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb57-2178"><a href="#cb57-2178" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb57-2179"><a href="#cb57-2179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2180"><a href="#cb57-2180" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb57-2181"><a href="#cb57-2181" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb57-2182"><a href="#cb57-2182" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2183"><a href="#cb57-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2184"><a href="#cb57-2184" aria-hidden="true" tabindex="-1"></a><span class="co">### Step-by-Step Chart Filling</span></span>
<span id="cb57-2185"><a href="#cb57-2185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2186"><a href="#cb57-2186" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s trace the Earley algorithm as it fills the chart for "unhappiness":</span></span>
<span id="cb57-2187"><a href="#cb57-2187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2188"><a href="#cb57-2188" aria-hidden="true" tabindex="-1"></a><span class="er">#### Chart</span>[<span class="dv">0</span>]: Initial State</span>
<span id="cb57-2189"><a href="#cb57-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2190"><a href="#cb57-2190" aria-hidden="true" tabindex="-1"></a>First, we initialize chart[<span class="dv">0</span>] <span class="cf">with</span> a dotted rule <span class="cf">for</span> the start symbol `Word`:</span>
<span id="cb57-2191"><a href="#cb57-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2192"><a href="#cb57-2192" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Add `Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]` (<span class="im">from</span> start symbol rule)</span>
<span id="cb57-2193"><a href="#cb57-2193" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply predict:</span>
<span id="cb57-2194"><a href="#cb57-2194" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Word <span class="op">-&gt;</span> • N`:</span>
<span id="cb57-2195"><a href="#cb57-2195" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2196"><a href="#cb57-2196" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply predict again:</span>
<span id="cb57-2197"><a href="#cb57-2197" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> • Adj Suffix`:</span>
<span id="cb57-2198"><a href="#cb57-2198" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2199"><a href="#cb57-2199" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2200"><a href="#cb57-2200" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict again:</span>
<span id="cb57-2201"><a href="#cb57-2201" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • Prefix Adj`:</span>
<span id="cb57-2202"><a href="#cb57-2202" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2203"><a href="#cb57-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2204"><a href="#cb57-2204" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">0</span>] now looks like:</span>
<span id="cb57-2205"><a href="#cb57-2205" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2206"><a href="#cb57-2206" aria-hidden="true" tabindex="-1"></a>Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-2207"><a href="#cb57-2207" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-2208"><a href="#cb57-2208" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-2209"><a href="#cb57-2209" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-2210"><a href="#cb57-2210" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb57-2211"><a href="#cb57-2211" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2212"><a href="#cb57-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2213"><a href="#cb57-2213" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[1]: After Processing "un"</span></span>
<span id="cb57-2214"><a href="#cb57-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2215"><a href="#cb57-2215" aria-hidden="true" tabindex="-1"></a>Now we process the first <span class="bu">input</span> symbol <span class="st">"un"</span>:</span>
<span id="cb57-2216"><a href="#cb57-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2217"><a href="#cb57-2217" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-2218"><a href="#cb57-2218" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]`:</span>
<span id="cb57-2219"><a href="#cb57-2219" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` (complete)</span>
<span id="cb57-2220"><a href="#cb57-2220" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-2221"><a href="#cb57-2221" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` (complete):</span>
<span id="cb57-2222"><a href="#cb57-2222" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> Prefix</span>
<span id="cb57-2223"><a href="#cb57-2223" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2224"><a href="#cb57-2224" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply predict:</span>
<span id="cb57-2225"><a href="#cb57-2225" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-2226"><a href="#cb57-2226" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2227"><a href="#cb57-2227" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2228"><a href="#cb57-2228" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict again:</span>
<span id="cb57-2229"><a href="#cb57-2229" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-2230"><a href="#cb57-2230" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2231"><a href="#cb57-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2232"><a href="#cb57-2232" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">1</span>] now looks like:</span>
<span id="cb57-2233"><a href="#cb57-2233" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2234"><a href="#cb57-2234" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb57-2235"><a href="#cb57-2235" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb57-2236"><a href="#cb57-2236" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-2237"><a href="#cb57-2237" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-2238"><a href="#cb57-2238" aria-hidden="true" tabindex="-1"></a>Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-2239"><a href="#cb57-2239" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2240"><a href="#cb57-2240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2241"><a href="#cb57-2241" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[2]: After Processing "happy"</span></span>
<span id="cb57-2242"><a href="#cb57-2242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2243"><a href="#cb57-2243" aria-hidden="true" tabindex="-1"></a>Now we process the second <span class="bu">input</span> symbol <span class="st">"happy"</span>:</span>
<span id="cb57-2244"><a href="#cb57-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2245"><a href="#cb57-2245" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-2246"><a href="#cb57-2246" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]`:</span>
<span id="cb57-2247"><a href="#cb57-2247" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-2248"><a href="#cb57-2248" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-2249"><a href="#cb57-2249" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` (complete):</span>
<span id="cb57-2250"><a href="#cb57-2250" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]` waiting <span class="cf">for</span> Adj</span>
<span id="cb57-2251"><a href="#cb57-2251" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-2252"><a href="#cb57-2252" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply complete again:</span>
<span id="cb57-2253"><a href="#cb57-2253" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` (complete):</span>
<span id="cb57-2254"><a href="#cb57-2254" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> Adj</span>
<span id="cb57-2255"><a href="#cb57-2255" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]`</span>
<span id="cb57-2256"><a href="#cb57-2256" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Apply predict:</span>
<span id="cb57-2257"><a href="#cb57-2257" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]`:</span>
<span id="cb57-2258"><a href="#cb57-2258" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]`</span>
<span id="cb57-2259"><a href="#cb57-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2260"><a href="#cb57-2260" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">2</span>] now looks like:</span>
<span id="cb57-2261"><a href="#cb57-2261" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2262"><a href="#cb57-2262" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb57-2263"><a href="#cb57-2263" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb57-2264"><a href="#cb57-2264" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb57-2265"><a href="#cb57-2265" aria-hidden="true" tabindex="-1"></a>Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb57-2266"><a href="#cb57-2266" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2267"><a href="#cb57-2267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2268"><a href="#cb57-2268" aria-hidden="true" tabindex="-1"></a><span class="co">#### Chart[3]: After Processing "ness"</span></span>
<span id="cb57-2269"><a href="#cb57-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2270"><a href="#cb57-2270" aria-hidden="true" tabindex="-1"></a>Finally, we process the third <span class="bu">input</span> symbol <span class="st">"ness"</span>:</span>
<span id="cb57-2271"><a href="#cb57-2271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2272"><a href="#cb57-2272" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Apply scan:</span>
<span id="cb57-2273"><a href="#cb57-2273" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]`:</span>
<span id="cb57-2274"><a href="#cb57-2274" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-2275"><a href="#cb57-2275" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Apply complete:</span>
<span id="cb57-2276"><a href="#cb57-2276" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` (complete):</span>
<span id="cb57-2277"><a href="#cb57-2277" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]` waiting <span class="cf">for</span> Suffix</span>
<span id="cb57-2278"><a href="#cb57-2278" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-2279"><a href="#cb57-2279" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Apply complete again:</span>
<span id="cb57-2280"><a href="#cb57-2280" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> For `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete):</span>
<span id="cb57-2281"><a href="#cb57-2281" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Find `Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]` waiting <span class="cf">for</span> N</span>
<span id="cb57-2282"><a href="#cb57-2282" aria-hidden="true" tabindex="-1"></a>     <span class="op">-</span> Add `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-2283"><a href="#cb57-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2284"><a href="#cb57-2284" aria-hidden="true" tabindex="-1"></a>Chart[<span class="dv">3</span>] now looks like:</span>
<span id="cb57-2285"><a href="#cb57-2285" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2286"><a href="#cb57-2286" aria-hidden="true" tabindex="-1"></a>Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb57-2287"><a href="#cb57-2287" aria-hidden="true" tabindex="-1"></a>N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]</span>
<span id="cb57-2288"><a href="#cb57-2288" aria-hidden="true" tabindex="-1"></a>Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]</span>
<span id="cb57-2289"><a href="#cb57-2289" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2290"><a href="#cb57-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2291"><a href="#cb57-2291" aria-hidden="true" tabindex="-1"></a>Since there<span class="st">'s a completed dotted rule for the start symbol `Word` that spans the entire input (0 to 3), the word "unhappiness" is in the language defined by our grammar.</span></span>
<span id="cb57-2292"><a href="#cb57-2292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2293"><a href="#cb57-2293" aria-hidden="true" tabindex="-1"></a><span class="er">### Visualizing the Chart State</span></span>
<span id="cb57-2294"><a href="#cb57-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2295"><a href="#cb57-2295" aria-hidden="true" tabindex="-1"></a>We can visualize the entire chart <span class="im">as</span> follows:</span>
<span id="cb57-2296"><a href="#cb57-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2297"><a href="#cb57-2297" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2298"><a href="#cb57-2298" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-2299"><a href="#cb57-2299" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>      Chart[<span class="dv">0</span>]         <span class="op">|</span>        Chart[<span class="dv">1</span>]          <span class="op">|</span>        Chart[<span class="dv">2</span>]          <span class="op">|</span>        Chart[<span class="dv">3</span>]          <span class="op">|</span></span>
<span id="cb57-2300"><a href="#cb57-2300" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-2301"><a href="#cb57-2301" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]     <span class="op">|</span> Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]     <span class="op">|</span> Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]     <span class="op">|</span> Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]   <span class="op">|</span></span>
<span id="cb57-2302"><a href="#cb57-2302" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]<span class="op">|</span> N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]  <span class="op">|</span></span>
<span id="cb57-2303"><a href="#cb57-2303" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]  <span class="op">|</span> Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]     <span class="op">|</span> N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]  <span class="op">|</span> Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]        <span class="op">|</span></span>
<span id="cb57-2304"><a href="#cb57-2304" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">|</span> Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">|</span> Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]   <span class="op">|</span>                        <span class="op">|</span></span>
<span id="cb57-2305"><a href="#cb57-2305" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]  <span class="op">|</span> Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]     <span class="op">|</span>                         <span class="op">|</span>                        <span class="op">|</span></span>
<span id="cb57-2306"><a href="#cb57-2306" aria-hidden="true" tabindex="-1"></a><span class="op">|-----------------------|--------------------------|--------------------------|--------------------------|</span></span>
<span id="cb57-2307"><a href="#cb57-2307" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2308"><a href="#cb57-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2309"><a href="#cb57-2309" aria-hidden="true" tabindex="-1"></a><span class="co">### Reconstructing the Parse Tree</span></span>
<span id="cb57-2310"><a href="#cb57-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2311"><a href="#cb57-2311" aria-hidden="true" tabindex="-1"></a>From the completed dotted rule `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>], we can reconstruct the parse tree by following the backpointers:</span>
<span id="cb57-2312"><a href="#cb57-2312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2313"><a href="#cb57-2313" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Start <span class="cf">with</span> `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-2314"><a href="#cb57-2314" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Follow the backpointer to `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-2315"><a href="#cb57-2315" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Follow the backpointer to `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` <span class="kw">in</span> Chart[<span class="dv">2</span>]</span>
<span id="cb57-2316"><a href="#cb57-2316" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> Follow the backpointer to `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` <span class="kw">in</span> Chart[<span class="dv">1</span>]</span>
<span id="cb57-2317"><a href="#cb57-2317" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> Follow the backpointer to `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` <span class="kw">in</span> Chart[<span class="dv">2</span>]</span>
<span id="cb57-2318"><a href="#cb57-2318" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span> Follow the backpointer to `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` <span class="kw">in</span> Chart[<span class="dv">3</span>]</span>
<span id="cb57-2319"><a href="#cb57-2319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2320"><a href="#cb57-2320" aria-hidden="true" tabindex="-1"></a>This gives us the parse tree:</span>
<span id="cb57-2321"><a href="#cb57-2321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2322"><a href="#cb57-2322" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2323"><a href="#cb57-2323" aria-hidden="true" tabindex="-1"></a>       Word</span>
<span id="cb57-2324"><a href="#cb57-2324" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span></span>
<span id="cb57-2325"><a href="#cb57-2325" aria-hidden="true" tabindex="-1"></a>        N</span>
<span id="cb57-2326"><a href="#cb57-2326" aria-hidden="true" tabindex="-1"></a>       <span class="op">/</span> <span class="op">\</span></span>
<span id="cb57-2327"><a href="#cb57-2327" aria-hidden="true" tabindex="-1"></a>     Adj  Suffix</span>
<span id="cb57-2328"><a href="#cb57-2328" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span>  \    <span class="op">|</span></span>
<span id="cb57-2329"><a href="#cb57-2329" aria-hidden="true" tabindex="-1"></a>Prefix Adj  ness</span>
<span id="cb57-2330"><a href="#cb57-2330" aria-hidden="true" tabindex="-1"></a>   <span class="op">|</span>    <span class="op">|</span></span>
<span id="cb57-2331"><a href="#cb57-2331" aria-hidden="true" tabindex="-1"></a>  un  happy</span>
<span id="cb57-2332"><a href="#cb57-2332" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2333"><a href="#cb57-2333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2334"><a href="#cb57-2334" aria-hidden="true" tabindex="-1"></a>This tree correctly captures the structure `((un<span class="op">+</span>happy)<span class="op">+</span>ness)`.</span>
<span id="cb57-2335"><a href="#cb57-2335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2336"><a href="#cb57-2336" aria-hidden="true" tabindex="-1"></a><span class="co">## Handling Ambiguity: The "unlockable" Example</span></span>
<span id="cb57-2337"><a href="#cb57-2337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2338"><a href="#cb57-2338" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s revisit the ambiguous word "unlockable", which has two possible interpretations:</span></span>
<span id="cb57-2339"><a href="#cb57-2339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2340"><a href="#cb57-2340" aria-hidden="true" tabindex="-1"></a><span class="er">1. `un + </span>(lock <span class="op">+</span> able)` <span class="op">=</span> <span class="st">"not able to be locked"</span></span>
<span id="cb57-2341"><a href="#cb57-2341" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> `(un <span class="op">+</span> lock) <span class="op">+</span> able` <span class="op">=</span> <span class="st">"able to be unlocked"</span></span>
<span id="cb57-2342"><a href="#cb57-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2343"><a href="#cb57-2343" aria-hidden="true" tabindex="-1"></a>With the Earley algorithm, we can handle this ambiguity naturally. Let<span class="st">'s create a grammar that captures both interpretations:</span></span>
<span id="cb57-2344"><a href="#cb57-2344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2345"><a href="#cb57-2345" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2346"><a href="#cb57-2346" aria-hidden="true" tabindex="-1"></a>ambiguous_grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-2347"><a href="#cb57-2347" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'lock'</span>, <span class="st">'able'</span>},</span>
<span id="cb57-2348"><a href="#cb57-2348" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'V'</span>, <span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-2349"><a href="#cb57-2349" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-2350"><a href="#cb57-2350" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'lock'</span>),</span>
<span id="cb57-2351"><a href="#cb57-2351" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-2352"><a href="#cb57-2352" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'able'</span>),</span>
<span id="cb57-2353"><a href="#cb57-2353" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'V'</span>, <span class="st">'Prefix'</span>, <span class="st">'V'</span>),    <span class="co"># un + lock -&gt; unlock</span></span>
<span id="cb57-2354"><a href="#cb57-2354" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'V'</span>, <span class="st">'Suffix'</span>),  <span class="co"># lock + able -&gt; lockable OR unlock + able -&gt; unlockable</span></span>
<span id="cb57-2355"><a href="#cb57-2355" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>), <span class="co"># un + lockable -&gt; unlockable</span></span>
<span id="cb57-2356"><a href="#cb57-2356" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'Adj'</span>)</span>
<span id="cb57-2357"><a href="#cb57-2357" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-2358"><a href="#cb57-2358" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-2359"><a href="#cb57-2359" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-2360"><a href="#cb57-2360" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2361"><a href="#cb57-2361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2362"><a href="#cb57-2362" aria-hidden="true" tabindex="-1"></a>When we parse <span class="st">"unlockable"</span> <span class="cf">with</span> Earley, we<span class="st">'ll end up with two completed dotted rules in the final chart:</span></span>
<span id="cb57-2363"><a href="#cb57-2363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2364"><a href="#cb57-2364" aria-hidden="true" tabindex="-1"></a><span class="er">1. `Word -&gt; Adj • </span>[<span class="dv">0</span>,<span class="dv">3</span>]` where Adj comes <span class="im">from</span> `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">3</span>]` (un <span class="op">+</span> lockable)</span>
<span id="cb57-2365"><a href="#cb57-2365" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> `Word <span class="op">-&gt;</span> Adj • [<span class="dv">0</span>,<span class="dv">3</span>]` where Adj comes <span class="im">from</span> `Adj <span class="op">-&gt;</span> V Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (unlock <span class="op">+</span> able)</span>
<span id="cb57-2366"><a href="#cb57-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2367"><a href="#cb57-2367" aria-hidden="true" tabindex="-1"></a>Both of these analyses derive `Word`, resulting <span class="kw">in</span> two different parse trees:</span>
<span id="cb57-2368"><a href="#cb57-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2369"><a href="#cb57-2369" aria-hidden="true" tabindex="-1"></a>Parse Tree <span class="dv">1</span> (un <span class="op">+</span> lockable):</span>
<span id="cb57-2370"><a href="#cb57-2370" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2371"><a href="#cb57-2371" aria-hidden="true" tabindex="-1"></a>    Word</span>
<span id="cb57-2372"><a href="#cb57-2372" aria-hidden="true" tabindex="-1"></a>     <span class="op">|</span></span>
<span id="cb57-2373"><a href="#cb57-2373" aria-hidden="true" tabindex="-1"></a>    Adj</span>
<span id="cb57-2374"><a href="#cb57-2374" aria-hidden="true" tabindex="-1"></a>   <span class="op">/</span>   <span class="op">\</span></span>
<span id="cb57-2375"><a href="#cb57-2375" aria-hidden="true" tabindex="-1"></a>Prefix  Adj</span>
<span id="cb57-2376"><a href="#cb57-2376" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span>    <span class="op">/</span>  <span class="op">\</span></span>
<span id="cb57-2377"><a href="#cb57-2377" aria-hidden="true" tabindex="-1"></a> un    V  Suffix</span>
<span id="cb57-2378"><a href="#cb57-2378" aria-hidden="true" tabindex="-1"></a>       <span class="op">|</span>    <span class="op">|</span></span>
<span id="cb57-2379"><a href="#cb57-2379" aria-hidden="true" tabindex="-1"></a>     lock  able</span>
<span id="cb57-2380"><a href="#cb57-2380" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2381"><a href="#cb57-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2382"><a href="#cb57-2382" aria-hidden="true" tabindex="-1"></a>Parse Tree <span class="dv">2</span> (unlock <span class="op">+</span> able):</span>
<span id="cb57-2383"><a href="#cb57-2383" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2384"><a href="#cb57-2384" aria-hidden="true" tabindex="-1"></a>    Word</span>
<span id="cb57-2385"><a href="#cb57-2385" aria-hidden="true" tabindex="-1"></a>     <span class="op">|</span></span>
<span id="cb57-2386"><a href="#cb57-2386" aria-hidden="true" tabindex="-1"></a>    Adj</span>
<span id="cb57-2387"><a href="#cb57-2387" aria-hidden="true" tabindex="-1"></a>   <span class="op">/</span>   <span class="op">\</span></span>
<span id="cb57-2388"><a href="#cb57-2388" aria-hidden="true" tabindex="-1"></a>  V    Suffix</span>
<span id="cb57-2389"><a href="#cb57-2389" aria-hidden="true" tabindex="-1"></a> <span class="op">/</span> \     <span class="op">|</span></span>
<span id="cb57-2390"><a href="#cb57-2390" aria-hidden="true" tabindex="-1"></a>Prefix V able</span>
<span id="cb57-2391"><a href="#cb57-2391" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span>   <span class="op">|</span></span>
<span id="cb57-2392"><a href="#cb57-2392" aria-hidden="true" tabindex="-1"></a> un lock</span>
<span id="cb57-2393"><a href="#cb57-2393" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2394"><a href="#cb57-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2395"><a href="#cb57-2395" aria-hidden="true" tabindex="-1"></a>The Earley algorithm finds <span class="bu">all</span> possible parses, which <span class="kw">is</span> essential <span class="cf">for</span> accurately analyzing structurally ambiguous words.</span>
<span id="cb57-2396"><a href="#cb57-2396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2397"><a href="#cb57-2397" aria-hidden="true" tabindex="-1"></a><span class="co">## The Three Operations of Earley</span></span>
<span id="cb57-2398"><a href="#cb57-2398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2399"><a href="#cb57-2399" aria-hidden="true" tabindex="-1"></a>The Earley algorithm consists of three main operations:</span>
<span id="cb57-2400"><a href="#cb57-2400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2401"><a href="#cb57-2401" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Predict<span class="op">**</span>: For each dotted rule where the dot precedes a non<span class="op">-</span>terminal, add new dotted rules <span class="cf">for</span> <span class="bu">all</span> possible expansions of that non<span class="op">-</span>terminal. This operation looks ahead to determine what might come <span class="bu">next</span>.</span>
<span id="cb57-2402"><a href="#cb57-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2403"><a href="#cb57-2403" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Scan<span class="op">**</span>: For each dotted rule where the dot precedes a terminal that matches the current <span class="bu">input</span> symbol, advance the dot past that terminal. This operation represents recognizing an <span class="bu">input</span> symbol.</span>
<span id="cb57-2404"><a href="#cb57-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2405"><a href="#cb57-2405" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Complete<span class="op">**</span>: For each dotted rule where the dot <span class="kw">is</span> at the end (indicating a completed constituent), go back to the chart position where the constituent began <span class="kw">and</span> advance the dot <span class="kw">in</span> <span class="bu">all</span> dotted rules that were waiting <span class="cf">for</span> this constituent.</span>
<span id="cb57-2406"><a href="#cb57-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2407"><a href="#cb57-2407" aria-hidden="true" tabindex="-1"></a>These operations work together to efficiently parse the <span class="bu">input</span> <span class="cf">while</span> avoiding redundant work.</span>
<span id="cb57-2408"><a href="#cb57-2408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2409"><a href="#cb57-2409" aria-hidden="true" tabindex="-1"></a><span class="co">## Advantages of Earley for Morphological Analysis</span></span>
<span id="cb57-2410"><a href="#cb57-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2411"><a href="#cb57-2411" aria-hidden="true" tabindex="-1"></a>The Earley algorithm offers several advantages <span class="cf">for</span> morphological analysis:</span>
<span id="cb57-2412"><a href="#cb57-2412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2413"><a href="#cb57-2413" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Any CFG<span class="op">**</span>: Unlike CKY, Earley works <span class="cf">with</span> <span class="bu">any</span> context<span class="op">-</span>free grammar, including those <span class="cf">with</span> ε<span class="op">-</span>rules (empty productions), unary rules, <span class="kw">and</span> arbitrary rule lengths. This allows <span class="cf">for</span> more natural expression of morphological patterns.</span>
<span id="cb57-2414"><a href="#cb57-2414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2415"><a href="#cb57-2415" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Incremental processing<span class="op">**</span>: Earley processes the <span class="bu">input</span> left<span class="op">-</span>to<span class="op">-</span>right, which can be useful <span class="cf">for</span> interactive applications <span class="kw">or</span> streaming inputs.</span>
<span id="cb57-2416"><a href="#cb57-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2417"><a href="#cb57-2417" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Left recursion<span class="op">**</span>: Earley handles left<span class="op">-</span>recursive rules without modification, which <span class="kw">is</span> important <span class="cf">for</span> certain morphological patterns.</span>
<span id="cb57-2418"><a href="#cb57-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2419"><a href="#cb57-2419" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>Explicit predictions<span class="op">**</span>: The predict operation explicitly lists <span class="bu">all</span> the possible continuations at each position, which can be useful <span class="cf">for</span> generating suggestions <span class="kw">in</span> applications like spelling correction <span class="kw">or</span> auto<span class="op">-</span>completion.</span>
<span id="cb57-2420"><a href="#cb57-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2421"><a href="#cb57-2421" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">**</span>Efficiency<span class="op">**</span>: While the worst<span class="op">-</span>case complexity <span class="kw">is</span> O(n³), <span class="cf">for</span> many practical grammars Earley performs better, especially <span class="cf">for</span> unambiguous <span class="kw">or</span> nearly unambiguous grammars.</span>
<span id="cb57-2422"><a href="#cb57-2422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2423"><a href="#cb57-2423" aria-hidden="true" tabindex="-1"></a><span class="co">## Real-World Example: Predicting Next Morphemes</span></span>
<span id="cb57-2424"><a href="#cb57-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2425"><a href="#cb57-2425" aria-hidden="true" tabindex="-1"></a>One interesting application of the Earley algorithm <span class="kw">is</span> predicting what could come <span class="bu">next</span> <span class="kw">in</span> a partial word. Let<span class="st">'s look at how to use the algorithm to predict possible continuations for "un":</span></span>
<span id="cb57-2426"><a href="#cb57-2426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2427"><a href="#cb57-2427" aria-hidden="true" tabindex="-1"></a><span class="er">1. Run the Earley algorithm on the prefix "un"</span></span>
<span id="cb57-2428"><a href="#cb57-2428" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Look at the dotted rules <span class="kw">in</span> the chart at position <span class="dv">1</span> (after <span class="st">"un"</span>)</span>
<span id="cb57-2429"><a href="#cb57-2429" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Find <span class="bu">all</span> dotted rules where the dot precedes a terminal</span>
<span id="cb57-2430"><a href="#cb57-2430" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> These terminals are the possible <span class="bu">next</span> morphemes</span>
<span id="cb57-2431"><a href="#cb57-2431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2432"><a href="#cb57-2432" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">with</span> our grammar, after processing <span class="st">"un"</span>, Chart[<span class="dv">1</span>] includes:</span>
<span id="cb57-2433"><a href="#cb57-2433" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2434"><a href="#cb57-2434" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb57-2435"><a href="#cb57-2435" aria-hidden="true" tabindex="-1"></a>Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb57-2436"><a href="#cb57-2436" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2437"><a href="#cb57-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2438"><a href="#cb57-2438" aria-hidden="true" tabindex="-1"></a>This tells us that the <span class="bu">next</span> morpheme could be <span class="st">"happy"</span> <span class="kw">or</span> potentially other adjectives.</span>
<span id="cb57-2439"><a href="#cb57-2439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2440"><a href="#cb57-2440" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s extend our `EarleyParser` class to support prediction:</span></span>
<span id="cb57-2441"><a href="#cb57-2441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2442"><a href="#cb57-2442" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2443"><a href="#cb57-2443" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb57-2444"><a href="#cb57-2444" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb57-2445"><a href="#cb57-2445" aria-hidden="true" tabindex="-1"></a><span class="st">    Predict possible next words given a prefix</span></span>
<span id="cb57-2446"><a href="#cb57-2446" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb57-2447"><a href="#cb57-2447" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-2448"><a href="#cb57-2448" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-2449"><a href="#cb57-2449" aria-hidden="true" tabindex="-1"></a><span class="st">    prefix : list[str]</span></span>
<span id="cb57-2450"><a href="#cb57-2450" aria-hidden="true" tabindex="-1"></a><span class="st">        The prefix of a word, as a list of morphemes</span></span>
<span id="cb57-2451"><a href="#cb57-2451" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2452"><a href="#cb57-2452" aria-hidden="true" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb57-2453"><a href="#cb57-2453" aria-hidden="true" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb57-2454"><a href="#cb57-2454" aria-hidden="true" tabindex="-1"></a><span class="st">    dict[str, set[str]]</span></span>
<span id="cb57-2455"><a href="#cb57-2455" aria-hidden="true" tabindex="-1"></a><span class="st">        A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb57-2456"><a href="#cb57-2456" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-2457"><a href="#cb57-2457" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb57-2458"><a href="#cb57-2458" aria-hidden="true" tabindex="-1"></a>    chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb57-2459"><a href="#cb57-2459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2460"><a href="#cb57-2460" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb57-2461"><a href="#cb57-2461" aria-hidden="true" tabindex="-1"></a>    incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb57-2462"><a href="#cb57-2462" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2463"><a href="#cb57-2463" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by next expected symbol</span></span>
<span id="cb57-2464"><a href="#cb57-2464" aria-hidden="true" tabindex="-1"></a>    next_symbols <span class="op">=</span> {}</span>
<span id="cb57-2465"><a href="#cb57-2465" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb57-2466"><a href="#cb57-2466" aria-hidden="true" tabindex="-1"></a>        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-2467"><a href="#cb57-2467" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2468"><a href="#cb57-2468" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb57-2469"><a href="#cb57-2469" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-2470"><a href="#cb57-2470" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-2471"><a href="#cb57-2471" aria-hidden="true" tabindex="-1"></a>                next_symbols[<span class="bu">next</span><span class="op">---</span></span>
<span id="cb57-2472"><a href="#cb57-2472" aria-hidden="true" tabindex="-1"></a>title: Top<span class="op">-</span>Down Parsing <span class="cf">with</span> Earley</span>
<span id="cb57-2473"><a href="#cb57-2473" aria-hidden="true" tabindex="-1"></a>bibliography: ..<span class="op">/</span>references.bib</span>
<span id="cb57-2474"><a href="#cb57-2474" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb57-2475"><a href="#cb57-2475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2476"><a href="#cb57-2476" aria-hidden="true" tabindex="-1"></a>In the previous section, we explored the CKY algorithm, a bottom<span class="op">-</span>up parsing approach <span class="cf">for</span> context<span class="op">-</span>free grammars. Now, we<span class="st">'ll examine the Earley algorithm, which is a top-down parsing method that combines the advantages of both top-down and bottom-up approaches.</span></span>
<span id="cb57-2477"><a href="#cb57-2477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2478"><a href="#cb57-2478" aria-hidden="true" tabindex="-1"></a><span class="er">Unlike CKY, which requires the grammar to be in Chomsky Normal Form, the Earley algorithm can work with any context-free grammar. This flexibility makes it particularly useful for morphological analysis, where the natural expression of morphological rules might not conform to CNF.</span></span>
<span id="cb57-2479"><a href="#cb57-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2480"><a href="#cb57-2480" aria-hidden="true" tabindex="-1"></a><span class="co">## Top-Down vs. Bottom-Up Parsing</span></span>
<span id="cb57-2481"><a href="#cb57-2481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2482"><a href="#cb57-2482" aria-hidden="true" tabindex="-1"></a>Before diving into the Earley algorithm, let<span class="st">'s briefly compare top-down and bottom-up parsing approaches:</span></span>
<span id="cb57-2483"><a href="#cb57-2483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2484"><a href="#cb57-2484" aria-hidden="true" tabindex="-1"></a><span class="er">**Bottom-Up Parsing </span>(e.g., CKY):<span class="op">**</span></span>
<span id="cb57-2485"><a href="#cb57-2485" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the <span class="bu">input</span> <span class="kw">and</span> builds larger constituents</span>
<span id="cb57-2486"><a href="#cb57-2486" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Works well <span class="cf">with</span> grammars <span class="kw">in</span> normal forms</span>
<span id="cb57-2487"><a href="#cb57-2487" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Typically more efficient <span class="cf">for</span> highly ambiguous grammars</span>
<span id="cb57-2488"><a href="#cb57-2488" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May do unnecessary work on strings <span class="kw">not</span> <span class="kw">in</span> the language</span>
<span id="cb57-2489"><a href="#cb57-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2490"><a href="#cb57-2490" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Top<span class="op">-</span>Down Parsing:<span class="op">**</span></span>
<span id="cb57-2491"><a href="#cb57-2491" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Starts <span class="cf">with</span> the start symbol <span class="kw">and</span> tries to derive the <span class="bu">input</span></span>
<span id="cb57-2492"><a href="#cb57-2492" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> More intuitive <span class="cf">for</span> tracing the derivation process</span>
<span id="cb57-2493"><a href="#cb57-2493" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Can incorporate contextual constraints more easily</span>
<span id="cb57-2494"><a href="#cb57-2494" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> May get stuck <span class="kw">in</span> loops <span class="cf">with</span> left<span class="op">-</span>recursive grammars</span>
<span id="cb57-2495"><a href="#cb57-2495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2496"><a href="#cb57-2496" aria-hidden="true" tabindex="-1"></a>The Earley algorithm combines the strengths of both approaches by using a top<span class="op">-</span>down prediction strategy but avoiding redundant work through dynamic programming techniques similar to those used <span class="kw">in</span> CKY.</span>
<span id="cb57-2497"><a href="#cb57-2497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2498"><a href="#cb57-2498" aria-hidden="true" tabindex="-1"></a><span class="co">## Dotted Rules</span></span>
<span id="cb57-2499"><a href="#cb57-2499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2500"><a href="#cb57-2500" aria-hidden="true" tabindex="-1"></a>The key concept <span class="kw">in</span> the Earley algorithm <span class="kw">is</span> the <span class="st">"dotted rule"</span> (also called an <span class="st">"Earley item"</span>). A dotted rule <span class="kw">is</span> a context<span class="op">-</span>free rule <span class="cf">with</span> a dot (•) inserted somewhere on the right<span class="op">-</span>hand side to indicate how much of the rule has been recognized so far.</span>
<span id="cb57-2501"><a href="#cb57-2501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2502"><a href="#cb57-2502" aria-hidden="true" tabindex="-1"></a>For example, <span class="cf">if</span> we have the rule `N <span class="op">-&gt;</span> Adj Suffix`, we can have the following dotted rules:</span>
<span id="cb57-2503"><a href="#cb57-2503" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> • Adj Suffix` (nothing recognized yet)</span>
<span id="cb57-2504"><a href="#cb57-2504" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj • Suffix` (Adj recognized, Suffix expected)</span>
<span id="cb57-2505"><a href="#cb57-2505" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> `N <span class="op">-&gt;</span> Adj Suffix •` (everything recognized)</span>
<span id="cb57-2506"><a href="#cb57-2506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2507"><a href="#cb57-2507" aria-hidden="true" tabindex="-1"></a>Dotted rules also track their span (the portion of the <span class="bu">input</span> they cover) <span class="kw">and</span> <span class="bu">any</span> backpointers needed <span class="cf">for</span> reconstructing the parse tree.</span>
<span id="cb57-2508"><a href="#cb57-2508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2509"><a href="#cb57-2509" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s define a `DottedRule` class that will be the core of our Earley parser:</span></span>
<span id="cb57-2510"><a href="#cb57-2510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2511"><a href="#cb57-2511" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2512"><a href="#cb57-2512" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DottedRule(Rule):</span>
<span id="cb57-2513"><a href="#cb57-2513" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2514"><a href="#cb57-2514" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, rule: Rule, span: SpanIndices, dot: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb57-2515"><a href="#cb57-2515" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._rule <span class="op">=</span> rule</span>
<span id="cb57-2516"><a href="#cb57-2516" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._left_side <span class="op">=</span> rule.left_side</span>
<span id="cb57-2517"><a href="#cb57-2517" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._right_side <span class="op">=</span> rule.right_side</span>
<span id="cb57-2518"><a href="#cb57-2518" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2519"><a href="#cb57-2519" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._span <span class="op">=</span> span</span>
<span id="cb57-2520"><a href="#cb57-2520" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dot <span class="op">=</span> dot</span>
<span id="cb57-2521"><a href="#cb57-2521" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2522"><a href="#cb57-2522" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Rule, SpanIndices, <span class="bu">int</span>]:</span>
<span id="cb57-2523"><a href="#cb57-2523" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule, <span class="va">self</span>._span, <span class="va">self</span>._dot</span>
<span id="cb57-2524"><a href="#cb57-2524" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2525"><a href="#cb57-2525" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-2526"><a href="#cb57-2526" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-2527"><a href="#cb57-2527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2528"><a href="#cb57-2528" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-2529"><a href="#cb57-2529" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-2530"><a href="#cb57-2530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2531"><a href="#cb57-2531" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2532"><a href="#cb57-2532" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._left_side <span class="op">+</span> <span class="st">' -&gt; '</span> <span class="op">+\</span></span>
<span id="cb57-2533"><a href="#cb57-2533" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[:<span class="va">self</span>._dot]) <span class="op">+\</span></span>
<span id="cb57-2534"><a href="#cb57-2534" aria-hidden="true" tabindex="-1"></a>               <span class="st">' . '</span> <span class="op">+\</span></span>
<span id="cb57-2535"><a href="#cb57-2535" aria-hidden="true" tabindex="-1"></a>               <span class="st">' '</span>.join(<span class="va">self</span>._right_side[<span class="va">self</span>._dot:]) <span class="op">+\</span></span>
<span id="cb57-2536"><a href="#cb57-2536" aria-hidden="true" tabindex="-1"></a>               <span class="st">' ['</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">0</span>]) <span class="op">+</span> <span class="st">', '</span> <span class="op">+</span> <span class="bu">str</span>(<span class="va">self</span>._span[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">']'</span></span>
<span id="cb57-2537"><a href="#cb57-2537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2538"><a href="#cb57-2538" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'DottedRule'</span>:</span>
<span id="cb57-2539"><a href="#cb57-2539" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete the next symbol in this rule</span></span>
<span id="cb57-2540"><a href="#cb57-2540" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2541"><a href="#cb57-2541" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2542"><a href="#cb57-2542" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2543"><a href="#cb57-2543" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-2544"><a href="#cb57-2544" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-2545"><a href="#cb57-2545" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2546"><a href="#cb57-2546" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2547"><a href="#cb57-2547" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2548"><a href="#cb57-2548" aria-hidden="true" tabindex="-1"></a><span class="st">        DottedRule</span></span>
<span id="cb57-2549"><a href="#cb57-2549" aria-hidden="true" tabindex="-1"></a><span class="st">            A new dotted rule with the dot advanced</span></span>
<span id="cb57-2550"><a href="#cb57-2550" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2551"><a href="#cb57-2551" aria-hidden="true" tabindex="-1"></a>        dot <span class="op">=</span> <span class="va">self</span>._dot <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb57-2552"><a href="#cb57-2552" aria-hidden="true" tabindex="-1"></a>        span <span class="op">=</span> (<span class="va">self</span>._span[<span class="dv">0</span>], new_left_edge)</span>
<span id="cb57-2553"><a href="#cb57-2553" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2554"><a href="#cb57-2554" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> DottedRule(<span class="va">self</span>._rule, span, dot)</span>
<span id="cb57-2555"><a href="#cb57-2555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2556"><a href="#cb57-2556" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2557"><a href="#cb57-2557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2558"><a href="#cb57-2558" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_complete:</span>
<span id="cb57-2559"><a href="#cb57-2559" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">AttributeError</span>(<span class="st">'dotted rule is already complete'</span>)</span>
<span id="cb57-2560"><a href="#cb57-2560" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-2561"><a href="#cb57-2561" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._right_side[<span class="va">self</span>._dot]</span>
<span id="cb57-2562"><a href="#cb57-2562" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2563"><a href="#cb57-2563" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2564"><a href="#cb57-2564" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dot(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-2565"><a href="#cb57-2565" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot</span>
<span id="cb57-2566"><a href="#cb57-2566" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2567"><a href="#cb57-2567" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2568"><a href="#cb57-2568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-2569"><a href="#cb57-2569" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._span</span>
<span id="cb57-2570"><a href="#cb57-2570" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2571"><a href="#cb57-2571" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2572"><a href="#cb57-2572" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-2573"><a href="#cb57-2573" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dot <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>._right_side)</span>
<span id="cb57-2574"><a href="#cb57-2574" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2575"><a href="#cb57-2575" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2576"><a href="#cb57-2576" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> left_side(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2577"><a href="#cb57-2577" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._rule.left_side</span>
<span id="cb57-2578"><a href="#cb57-2578" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2579"><a href="#cb57-2579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2580"><a href="#cb57-2580" aria-hidden="true" tabindex="-1"></a>Now, let<span class="st">'s define the chart and chart entry classes for the Earley algorithm:</span></span>
<span id="cb57-2581"><a href="#cb57-2581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2582"><a href="#cb57-2582" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2583"><a href="#cb57-2583" aria-hidden="true" tabindex="-1"></a>EarleyBackPointer <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">int</span>]</span>
<span id="cb57-2584"><a href="#cb57-2584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2585"><a href="#cb57-2585" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChartEntry(ChartEntry):</span>
<span id="cb57-2586"><a href="#cb57-2586" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart entry for a Earley chart</span></span>
<span id="cb57-2587"><a href="#cb57-2587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2588"><a href="#cb57-2588" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-2589"><a href="#cb57-2589" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-2590"><a href="#cb57-2590" aria-hidden="true" tabindex="-1"></a><span class="st">    dotted_rule</span></span>
<span id="cb57-2591"><a href="#cb57-2591" aria-hidden="true" tabindex="-1"></a><span class="st">    backpointers</span></span>
<span id="cb57-2592"><a href="#cb57-2592" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-2593"><a href="#cb57-2593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2594"><a href="#cb57-2594" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dotted_rule: DottedRule, <span class="op">*</span>backpointers: EarleyBackPointer):</span>
<span id="cb57-2595"><a href="#cb57-2595" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._dotted_rule <span class="op">=</span> dotted_rule</span>
<span id="cb57-2596"><a href="#cb57-2596" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backpointers <span class="op">=</span> backpointers</span>
<span id="cb57-2597"><a href="#cb57-2597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2598"><a href="#cb57-2598" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_tuple(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[DottedRule, <span class="bu">tuple</span>[EarleyBackPointer, ...]]:</span>
<span id="cb57-2599"><a href="#cb57-2599" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule, <span class="va">self</span>._backpointers</span>
<span id="cb57-2600"><a href="#cb57-2600" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2601"><a href="#cb57-2601" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__hash__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-2602"><a href="#cb57-2602" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">hash</span>(<span class="va">self</span>.to_tuple())</span>
<span id="cb57-2603"><a href="#cb57-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2604"><a href="#cb57-2604" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, other) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-2605"><a href="#cb57-2605" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.to_tuple() <span class="op">==</span> other.to_tuple()</span>
<span id="cb57-2606"><a href="#cb57-2606" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2607"><a href="#cb57-2607" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2608"><a href="#cb57-2608" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.<span class="fu">__repr__</span>()</span>
<span id="cb57-2609"><a href="#cb57-2609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2610"><a href="#cb57-2610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2611"><a href="#cb57-2611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__repr__</span>()</span>
<span id="cb57-2612"><a href="#cb57-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2613"><a href="#cb57-2613" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2614"><a href="#cb57-2614" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backpointers(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[EarleyBackPointer, ...]:</span>
<span id="cb57-2615"><a href="#cb57-2615" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._backpointers</span>
<span id="cb57-2616"><a href="#cb57-2616" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2617"><a href="#cb57-2617" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2618"><a href="#cb57-2618" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dotted_rule(<span class="va">self</span>) <span class="op">-&gt;</span> DottedRule:</span>
<span id="cb57-2619"><a href="#cb57-2619" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule</span>
<span id="cb57-2620"><a href="#cb57-2620" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2621"><a href="#cb57-2621" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2622"><a href="#cb57-2622" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> next_symbol(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb57-2623"><a href="#cb57-2623" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.next_symbol</span>
<span id="cb57-2624"><a href="#cb57-2624" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2625"><a href="#cb57-2625" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2626"><a href="#cb57-2626" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> span(<span class="va">self</span>) <span class="op">-&gt;</span> SpanIndices:</span>
<span id="cb57-2627"><a href="#cb57-2627" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.span</span>
<span id="cb57-2628"><a href="#cb57-2628" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2629"><a href="#cb57-2629" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2630"><a href="#cb57-2630" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_complete(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-2631"><a href="#cb57-2631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.is_complete</span>
<span id="cb57-2632"><a href="#cb57-2632" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2633"><a href="#cb57-2633" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb57-2634"><a href="#cb57-2634" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete this entry with another entry</span></span>
<span id="cb57-2635"><a href="#cb57-2635" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2636"><a href="#cb57-2636" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2637"><a href="#cb57-2637" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2638"><a href="#cb57-2638" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2639"><a href="#cb57-2639" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry that completes this one</span></span>
<span id="cb57-2640"><a href="#cb57-2640" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-2641"><a href="#cb57-2641" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-2642"><a href="#cb57-2642" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2643"><a href="#cb57-2643" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2644"><a href="#cb57-2644" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2645"><a href="#cb57-2645" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChartEntry</span></span>
<span id="cb57-2646"><a href="#cb57-2646" aria-hidden="true" tabindex="-1"></a><span class="st">            A new entry with the dot advanced</span></span>
<span id="cb57-2647"><a href="#cb57-2647" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2648"><a href="#cb57-2648" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb57-2649"><a href="#cb57-2649" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2650"><a href="#cb57-2650" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb57-2651"><a href="#cb57-2651" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb57-2652"><a href="#cb57-2652" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2653"><a href="#cb57-2653" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> EarleyChartEntry(new_dotted_rule, <span class="op">*</span>backpointers)</span>
<span id="cb57-2654"><a href="#cb57-2654" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2655"><a href="#cb57-2655" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_completion_of(<span class="va">self</span>, other: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb57-2656"><a href="#cb57-2656" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Check if this entry completes another entry</span></span>
<span id="cb57-2657"><a href="#cb57-2657" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2658"><a href="#cb57-2658" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2659"><a href="#cb57-2659" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2660"><a href="#cb57-2660" aria-hidden="true" tabindex="-1"></a><span class="st">        other : EarleyChartEntry</span></span>
<span id="cb57-2661"><a href="#cb57-2661" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to check</span></span>
<span id="cb57-2662"><a href="#cb57-2662" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2663"><a href="#cb57-2663" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2664"><a href="#cb57-2664" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2665"><a href="#cb57-2665" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-2666"><a href="#cb57-2666" aria-hidden="true" tabindex="-1"></a><span class="st">            True if this entry completes the other entry</span></span>
<span id="cb57-2667"><a href="#cb57-2667" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2668"><a href="#cb57-2668" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._dotted_rule.left_side <span class="op">==</span> other.dotted_rule.next_symbol</span>
<span id="cb57-2669"><a href="#cb57-2669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2670"><a href="#cb57-2670" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyChart(Chart):</span>
<span id="cb57-2671"><a href="#cb57-2671" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""A chart for an Earley parser</span></span>
<span id="cb57-2672"><a href="#cb57-2672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2673"><a href="#cb57-2673" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-2674"><a href="#cb57-2674" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-2675"><a href="#cb57-2675" aria-hidden="true" tabindex="-1"></a><span class="st">    input_size</span></span>
<span id="cb57-2676"><a href="#cb57-2676" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-2677"><a href="#cb57-2677" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size: <span class="bu">int</span>, start_variable: <span class="bu">str</span> <span class="op">=</span> <span class="st">'S'</span>):</span>
<span id="cb57-2678"><a href="#cb57-2678" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._start_variable <span class="op">=</span> start_variable</span>
<span id="cb57-2679"><a href="#cb57-2679" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2680"><a href="#cb57-2680" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart: <span class="bu">list</span>[<span class="bu">set</span>[EarleyChartEntry]] <span class="op">=</span> [</span>
<span id="cb57-2681"><a href="#cb57-2681" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(input_size<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-2682"><a href="#cb57-2682" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb57-2683"><a href="#cb57-2683" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2684"><a href="#cb57-2684" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index) <span class="op">-&gt;</span> <span class="bu">set</span>[EarleyChartEntry]:</span>
<span id="cb57-2685"><a href="#cb57-2685" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._chart[index]</span>
<span id="cb57-2686"><a href="#cb57-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2687"><a href="#cb57-2687" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__setitem__</span>(<span class="va">self</span>, key, item) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-2688"><a href="#cb57-2688" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._chart[key] <span class="op">=</span> item</span>
<span id="cb57-2689"><a href="#cb57-2689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2690"><a href="#cb57-2690" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2691"><a href="#cb57-2691" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parses(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">set</span>[Tree]:</span>
<span id="cb57-2692"><a href="#cb57-2692" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb57-2693"><a href="#cb57-2693" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-2694"><a href="#cb57-2694" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb57-2695"><a href="#cb57-2695" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._parses <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-2696"><a href="#cb57-2696" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2697"><a href="#cb57-2697" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>._chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-2698"><a href="#cb57-2698" aria-hidden="true" tabindex="-1"></a>                is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._start_variable</span>
<span id="cb57-2699"><a href="#cb57-2699" aria-hidden="true" tabindex="-1"></a>                covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="va">self</span>.input_size)</span>
<span id="cb57-2700"><a href="#cb57-2700" aria-hidden="true" tabindex="-1"></a>                is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-2701"><a href="#cb57-2701" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2702"><a href="#cb57-2702" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-2703"><a href="#cb57-2703" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>._parses.add(<span class="va">self</span>._construct_parses(entry))</span>
<span id="cb57-2704"><a href="#cb57-2704" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2705"><a href="#cb57-2705" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parses</span>
<span id="cb57-2706"><a href="#cb57-2706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2707"><a href="#cb57-2707" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _construct_parses(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>) <span class="op">-&gt;</span> Tree:</span>
<span id="cb57-2708"><a href="#cb57-2708" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Construct the parses implied by the chart</span></span>
<span id="cb57-2709"><a href="#cb57-2709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2710"><a href="#cb57-2710" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2711"><a href="#cb57-2711" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2712"><a href="#cb57-2712" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2713"><a href="#cb57-2713" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to construct the parse from</span></span>
<span id="cb57-2714"><a href="#cb57-2714" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2715"><a href="#cb57-2715" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2716"><a href="#cb57-2716" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2717"><a href="#cb57-2717" aria-hidden="true" tabindex="-1"></a><span class="st">        Tree</span></span>
<span id="cb57-2718"><a href="#cb57-2718" aria-hidden="true" tabindex="-1"></a><span class="st">            The parse tree</span></span>
<span id="cb57-2719"><a href="#cb57-2719" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2720"><a href="#cb57-2720" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a node for this entry</span></span>
<span id="cb57-2721"><a href="#cb57-2721" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Tree(entry.dotted_rule.left_side)</span>
<span id="cb57-2722"><a href="#cb57-2722" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2723"><a href="#cb57-2723" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If the entry has backpointers, recursively construct the children</span></span>
<span id="cb57-2724"><a href="#cb57-2724" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> entry.backpointers:</span>
<span id="cb57-2725"><a href="#cb57-2725" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> bp <span class="kw">in</span> entry.backpointers:</span>
<span id="cb57-2726"><a href="#cb57-2726" aria-hidden="true" tabindex="-1"></a>                symbol, position <span class="op">=</span> bp</span>
<span id="cb57-2727"><a href="#cb57-2727" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2728"><a href="#cb57-2728" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Find the entry in the chart that matches the backpointer</span></span>
<span id="cb57-2729"><a href="#cb57-2729" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child_entry <span class="kw">in</span> <span class="va">self</span>._chart[position]:</span>
<span id="cb57-2730"><a href="#cb57-2730" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (child_entry.dotted_rule.left_side <span class="op">==</span> symbol </span>
<span id="cb57-2731"><a href="#cb57-2731" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">and</span> child_entry.dotted_rule.is_complete):</span>
<span id="cb57-2732"><a href="#cb57-2732" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Recursively construct the child's parse</span></span>
<span id="cb57-2733"><a href="#cb57-2733" aria-hidden="true" tabindex="-1"></a>                        child <span class="op">=</span> <span class="va">self</span>._construct_parses(child_entry)</span>
<span id="cb57-2734"><a href="#cb57-2734" aria-hidden="true" tabindex="-1"></a>                        node.children.append(child)</span>
<span id="cb57-2735"><a href="#cb57-2735" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb57-2736"><a href="#cb57-2736" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2737"><a href="#cb57-2737" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> node</span>
<span id="cb57-2738"><a href="#cb57-2738" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2739"><a href="#cb57-2739" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb57-2740"><a href="#cb57-2740" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> input_size(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-2741"><a href="#cb57-2741" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._chart) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb57-2742"><a href="#cb57-2742" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2743"><a href="#cb57-2743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2744"><a href="#cb57-2744" aria-hidden="true" tabindex="-1"></a>Now, let<span class="st">'s define the `EarleyParser` class:</span></span>
<span id="cb57-2745"><a href="#cb57-2745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2746"><a href="#cb57-2746" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-2747"><a href="#cb57-2747" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(ContextFreeGrammarParser):</span>
<span id="cb57-2748"><a href="#cb57-2748" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="cb57-2749"><a href="#cb57-2749" aria-hidden="true" tabindex="-1"></a><span class="st">    An Earley parser</span></span>
<span id="cb57-2750"><a href="#cb57-2750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2751"><a href="#cb57-2751" aria-hidden="true" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb57-2752"><a href="#cb57-2752" aria-hidden="true" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb57-2753"><a href="#cb57-2753" aria-hidden="true" tabindex="-1"></a><span class="st">    grammar : ContextFreeGrammar</span></span>
<span id="cb57-2754"><a href="#cb57-2754" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb57-2755"><a href="#cb57-2755" aria-hidden="true" tabindex="-1"></a>    normal_form <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-2756"><a href="#cb57-2756" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-2757"><a href="#cb57-2757" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _fill_chart(<span class="va">self</span>, string: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> EarleyChart:</span>
<span id="cb57-2758"><a href="#cb57-2758" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2759"><a href="#cb57-2759" aria-hidden="true" tabindex="-1"></a><span class="st">        Fill the chart using the Earley algorithm</span></span>
<span id="cb57-2760"><a href="#cb57-2760" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2761"><a href="#cb57-2761" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2762"><a href="#cb57-2762" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2763"><a href="#cb57-2763" aria-hidden="true" tabindex="-1"></a><span class="st">        string : list[str]</span></span>
<span id="cb57-2764"><a href="#cb57-2764" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-2765"><a href="#cb57-2765" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2766"><a href="#cb57-2766" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2767"><a href="#cb57-2767" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2768"><a href="#cb57-2768" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChart</span></span>
<span id="cb57-2769"><a href="#cb57-2769" aria-hidden="true" tabindex="-1"></a><span class="st">            The filled chart</span></span>
<span id="cb57-2770"><a href="#cb57-2770" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2771"><a href="#cb57-2771" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the string for use in the scan operation</span></span>
<span id="cb57-2772"><a href="#cb57-2772" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._string <span class="op">=</span> string</span>
<span id="cb57-2773"><a href="#cb57-2773" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2774"><a href="#cb57-2774" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart</span></span>
<span id="cb57-2775"><a href="#cb57-2775" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> EarleyChart(<span class="bu">len</span>(string), <span class="va">self</span>._grammar.start_variable)</span>
<span id="cb57-2776"><a href="#cb57-2776" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2777"><a href="#cb57-2777" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the chart with a dotted rule for the start symbol</span></span>
<span id="cb57-2778"><a href="#cb57-2778" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(<span class="va">self</span>._grammar.start_variable):</span>
<span id="cb57-2779"><a href="#cb57-2779" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, (<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb57-2780"><a href="#cb57-2780" aria-hidden="true" tabindex="-1"></a>            entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-2781"><a href="#cb57-2781" aria-hidden="true" tabindex="-1"></a>            chart[<span class="dv">0</span>].add(entry)</span>
<span id="cb57-2782"><a href="#cb57-2782" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2783"><a href="#cb57-2783" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill each position in the chart</span></span>
<span id="cb57-2784"><a href="#cb57-2784" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(string) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb57-2785"><a href="#cb57-2785" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process all entries at this position</span></span>
<span id="cb57-2786"><a href="#cb57-2786" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb57-2787"><a href="#cb57-2787" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep track of how many entries we've processed</span></span>
<span id="cb57-2788"><a href="#cb57-2788" aria-hidden="true" tabindex="-1"></a>                size_before <span class="op">=</span> <span class="bu">len</span>(chart[i])</span>
<span id="cb57-2789"><a href="#cb57-2789" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2790"><a href="#cb57-2790" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Process each entry</span></span>
<span id="cb57-2791"><a href="#cb57-2791" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> entry <span class="kw">in</span> <span class="bu">list</span>(chart[i]):</span>
<span id="cb57-2792"><a href="#cb57-2792" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is incomplete, it needs to be predicted or scanned</span></span>
<span id="cb57-2793"><a href="#cb57-2793" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> entry.is_complete:</span>
<span id="cb57-2794"><a href="#cb57-2794" aria-hidden="true" tabindex="-1"></a>                        next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-2795"><a href="#cb57-2795" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-2796"><a href="#cb57-2796" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a non-terminal, predict</span></span>
<span id="cb57-2797"><a href="#cb57-2797" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-2798"><a href="#cb57-2798" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._predict(chart, entry, i)</span>
<span id="cb57-2799"><a href="#cb57-2799" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb57-2800"><a href="#cb57-2800" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If the next symbol is a terminal and we're not at the end, scan</span></span>
<span id="cb57-2801"><a href="#cb57-2801" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">elif</span> i <span class="op">&lt;</span> <span class="bu">len</span>(string):</span>
<span id="cb57-2802"><a href="#cb57-2802" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>._scan(chart, entry, i)</span>
<span id="cb57-2803"><a href="#cb57-2803" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-2804"><a href="#cb57-2804" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If the entry is complete, it can be used to complete other entries</span></span>
<span id="cb57-2805"><a href="#cb57-2805" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb57-2806"><a href="#cb57-2806" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>._complete(chart, entry, i)</span>
<span id="cb57-2807"><a href="#cb57-2807" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2808"><a href="#cb57-2808" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If no new entries were added, we're done with this position</span></span>
<span id="cb57-2809"><a href="#cb57-2809" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(chart[i]) <span class="op">==</span> size_before:</span>
<span id="cb57-2810"><a href="#cb57-2810" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb57-2811"><a href="#cb57-2811" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2812"><a href="#cb57-2812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart</span>
<span id="cb57-2813"><a href="#cb57-2813" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb57-2814"><a href="#cb57-2814" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2815"><a href="#cb57-2815" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2816"><a href="#cb57-2816" aria-hidden="true" tabindex="-1"></a><span class="st">        Predict operation: add new dotted rules for the non-terminal</span></span>
<span id="cb57-2817"><a href="#cb57-2817" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2818"><a href="#cb57-2818" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2819"><a href="#cb57-2819" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2820"><a href="#cb57-2820" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2821"><a href="#cb57-2821" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2822"><a href="#cb57-2822" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2823"><a href="#cb57-2823" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to predict from</span></span>
<span id="cb57-2824"><a href="#cb57-2824" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2825"><a href="#cb57-2825" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2826"><a href="#cb57-2826" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2827"><a href="#cb57-2827" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(entry.next_symbol):</span>
<span id="cb57-2828"><a href="#cb57-2828" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position)</span>
<span id="cb57-2829"><a href="#cb57-2829" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span)</span>
<span id="cb57-2830"><a href="#cb57-2830" aria-hidden="true" tabindex="-1"></a>            new_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-2831"><a href="#cb57-2831" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2832"><a href="#cb57-2832" aria-hidden="true" tabindex="-1"></a>            chart[position].add(new_entry)</span>
<span id="cb57-2833"><a href="#cb57-2833" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb57-2834"><a href="#cb57-2834" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _scan(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2835"><a href="#cb57-2835" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2836"><a href="#cb57-2836" aria-hidden="true" tabindex="-1"></a><span class="st">        Scan operation: advance the dot by matching the next terminal</span></span>
<span id="cb57-2837"><a href="#cb57-2837" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2838"><a href="#cb57-2838" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2839"><a href="#cb57-2839" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2840"><a href="#cb57-2840" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2841"><a href="#cb57-2841" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2842"><a href="#cb57-2842" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2843"><a href="#cb57-2843" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry to scan from</span></span>
<span id="cb57-2844"><a href="#cb57-2844" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2845"><a href="#cb57-2845" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2846"><a href="#cb57-2846" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2847"><a href="#cb57-2847" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> <span class="va">self</span>._string[position]</span>
<span id="cb57-2848"><a href="#cb57-2848" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-2849"><a href="#cb57-2849" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2850"><a href="#cb57-2850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="op">==</span> expected:</span>
<span id="cb57-2851"><a href="#cb57-2851" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a rule for the terminal</span></span>
<span id="cb57-2852"><a href="#cb57-2852" aria-hidden="true" tabindex="-1"></a>            rule <span class="op">=</span> Rule(expected, word)</span>
<span id="cb57-2853"><a href="#cb57-2853" aria-hidden="true" tabindex="-1"></a>            span <span class="op">=</span> (position, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-2854"><a href="#cb57-2854" aria-hidden="true" tabindex="-1"></a>            dotted_rule <span class="op">=</span> DottedRule(rule, span, dot<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-2855"><a href="#cb57-2855" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2856"><a href="#cb57-2856" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the terminal</span></span>
<span id="cb57-2857"><a href="#cb57-2857" aria-hidden="true" tabindex="-1"></a>            terminal_entry <span class="op">=</span> EarleyChartEntry(dotted_rule)</span>
<span id="cb57-2858"><a href="#cb57-2858" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(terminal_entry)</span>
<span id="cb57-2859"><a href="#cb57-2859" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2860"><a href="#cb57-2860" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add a completed entry for the entry that was waiting for this terminal</span></span>
<span id="cb57-2861"><a href="#cb57-2861" aria-hidden="true" tabindex="-1"></a>            completed_entry <span class="op">=</span> entry.complete(terminal_entry, position<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb57-2862"><a href="#cb57-2862" aria-hidden="true" tabindex="-1"></a>            chart[position<span class="op">+</span><span class="dv">1</span>].add(completed_entry)</span>
<span id="cb57-2863"><a href="#cb57-2863" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2864"><a href="#cb57-2864" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _complete(<span class="va">self</span>, chart: EarleyChart, entry: EarleyChartEntry, position: <span class="bu">int</span>):</span>
<span id="cb57-2865"><a href="#cb57-2865" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2866"><a href="#cb57-2866" aria-hidden="true" tabindex="-1"></a><span class="st">        Complete operation: advance the dot for entries waiting for this one</span></span>
<span id="cb57-2867"><a href="#cb57-2867" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2868"><a href="#cb57-2868" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2869"><a href="#cb57-2869" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2870"><a href="#cb57-2870" aria-hidden="true" tabindex="-1"></a><span class="st">        chart : EarleyChart</span></span>
<span id="cb57-2871"><a href="#cb57-2871" aria-hidden="true" tabindex="-1"></a><span class="st">            The chart to update</span></span>
<span id="cb57-2872"><a href="#cb57-2872" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-2873"><a href="#cb57-2873" aria-hidden="true" tabindex="-1"></a><span class="st">            The completed entry</span></span>
<span id="cb57-2874"><a href="#cb57-2874" aria-hidden="true" tabindex="-1"></a><span class="st">        position : int</span></span>
<span id="cb57-2875"><a href="#cb57-2875" aria-hidden="true" tabindex="-1"></a><span class="st">            The current position in the input</span></span>
<span id="cb57-2876"><a href="#cb57-2876" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2877"><a href="#cb57-2877" aria-hidden="true" tabindex="-1"></a>        start, end <span class="op">=</span> entry.span</span>
<span id="cb57-2878"><a href="#cb57-2878" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2879"><a href="#cb57-2879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_entry <span class="kw">in</span> chart[start]:</span>
<span id="cb57-2880"><a href="#cb57-2880" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> prev_entry.is_complete <span class="kw">and</span> entry.is_completion_of(prev_entry):</span>
<span id="cb57-2881"><a href="#cb57-2881" aria-hidden="true" tabindex="-1"></a>                completed_entry <span class="op">=</span> prev_entry.complete(entry, end)</span>
<span id="cb57-2882"><a href="#cb57-2882" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-2883"><a href="#cb57-2883" aria-hidden="true" tabindex="-1"></a>                chart[position].add(completed_entry)</span>
<span id="cb57-2884"><a href="#cb57-2884" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2885"><a href="#cb57-2885" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-2886"><a href="#cb57-2886" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2887"><a href="#cb57-2887" aria-hidden="true" tabindex="-1"></a><span class="st">        Parse a string to find all possible parse trees</span></span>
<span id="cb57-2888"><a href="#cb57-2888" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2889"><a href="#cb57-2889" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2890"><a href="#cb57-2890" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2891"><a href="#cb57-2891" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-2892"><a href="#cb57-2892" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to parse</span></span>
<span id="cb57-2893"><a href="#cb57-2893" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2894"><a href="#cb57-2894" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2895"><a href="#cb57-2895" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2896"><a href="#cb57-2896" aria-hidden="true" tabindex="-1"></a><span class="st">        set[Tree]</span></span>
<span id="cb57-2897"><a href="#cb57-2897" aria-hidden="true" tabindex="-1"></a><span class="st">            The set of all possible parse trees</span></span>
<span id="cb57-2898"><a href="#cb57-2898" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2899"><a href="#cb57-2899" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-2900"><a href="#cb57-2900" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-2901"><a href="#cb57-2901" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-2902"><a href="#cb57-2902" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2903"><a href="#cb57-2903" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-2904"><a href="#cb57-2904" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-2905"><a href="#cb57-2905" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2906"><a href="#cb57-2906" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return all possible parses</span></span>
<span id="cb57-2907"><a href="#cb57-2907" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> chart.parses</span>
<span id="cb57-2908"><a href="#cb57-2908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2909"><a href="#cb57-2909" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _recognize(<span class="va">self</span>, string: <span class="bu">str</span> <span class="op">|</span> <span class="bu">list</span>[<span class="bu">str</span>]):</span>
<span id="cb57-2910"><a href="#cb57-2910" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-2911"><a href="#cb57-2911" aria-hidden="true" tabindex="-1"></a><span class="st">        Recognize whether a string is in the language</span></span>
<span id="cb57-2912"><a href="#cb57-2912" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-2913"><a href="#cb57-2913" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-2914"><a href="#cb57-2914" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-2915"><a href="#cb57-2915" aria-hidden="true" tabindex="-1"></a><span class="st">        string : str | list[str]</span></span>
<span id="cb57-2916"><a href="#cb57-2916" aria-hidden="true" tabindex="-1"></a><span class="st">            The string to recognize</span></span>
<span id="cb57-2917"><a href="#cb57-2917" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-2918"><a href="#cb57-2918" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-2919"><a href="#cb57-2919" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-2920"><a href="#cb57-2920" aria-hidden="true" tabindex="-1"></a><span class="st">        bool</span></span>
<span id="cb57-2921"><a href="#cb57-2921" aria-hidden="true" tabindex="-1"></a><span class="st">            True if the string is in the language, False otherwise</span></span>
<span id="cb57-2922"><a href="#cb57-2922" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-2923"><a href="#cb57-2923" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure the input is a list of tokens</span></span>
<span id="cb57-2924"><a href="#cb57-2924" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(string, <span class="bu">str</span>):</span>
<span id="cb57-2925"><a href="#cb57-2925" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.split()</span>
<span id="cb57-2926"><a href="#cb57-2926" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2927"><a href="#cb57-2927" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart</span></span>
<span id="cb57-2928"><a href="#cb57-2928" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(string)</span>
<span id="cb57-2929"><a href="#cb57-2929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-2930"><a href="#cb57-2930" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the start variable appears in the final position with a complete rule</span></span>
<span id="cb57-2931"><a href="#cb57-2931" aria-hidden="true" tabindex="-1"></a>        <span class="co"># that spans the entire input</span></span>
<span id="cb57-2932"><a href="#cb57-2932" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb57-2933"><a href="#cb57-2933" aria-hidden="true" tabindex="-1"></a>            is_start <span class="op">=</span> entry.dotted_rule.left_side <span class="op">==</span> <span class="va">self</span>._grammar.start_variable</span>
<span id="cb57-2934"><a href="#cb57-2934" aria-hidden="true" tabindex="-1"></a>            covers_string <span class="op">=</span> entry.dotted_rule.span <span class="op">==</span> (<span class="dv">0</span>, <span class="bu">len</span>(string))</span>
<span id="cb57-2935"><a href="#cb57-2935" aria-hidden="true" tabindex="-1"></a>            is_complete <span class="op">=</span> entry.dotted_rule.is_complete</span>
<span id="cb57-2936"><a href="#cb57-2936" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2937"><a href="#cb57-2937" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_start <span class="kw">and</span> covers_string <span class="kw">and</span> is_complete:</span>
<span id="cb57-2938"><a href="#cb57-2938" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb57-2939"><a href="#cb57-2939" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-2940"><a href="#cb57-2940" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb57-2941"><a href="#cb57-2941" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2942"><a href="#cb57-2942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2943"><a href="#cb57-2943" aria-hidden="true" tabindex="-1"></a><span class="co">## The Earley Algorithm</span></span>
<span id="cb57-2944"><a href="#cb57-2944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2945"><a href="#cb57-2945" aria-hidden="true" tabindex="-1"></a>The Earley algorithm consists of three main operations, which are applied to each position <span class="kw">in</span> the <span class="bu">input</span> string:</span>
<span id="cb57-2946"><a href="#cb57-2946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2947"><a href="#cb57-2947" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Predict<span class="op">**</span>: For each incomplete dotted rule where the <span class="bu">next</span> symbol <span class="kw">is</span> a non<span class="op">-</span>terminal, add new dotted rules <span class="cf">for</span> <span class="bu">all</span> possible expansions of that non<span class="op">-</span>terminal.</span>
<span id="cb57-2948"><a href="#cb57-2948" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Scan<span class="op">**</span>: For each incomplete dotted rule where the <span class="bu">next</span> symbol <span class="kw">is</span> a terminal matching the current <span class="bu">input</span> symbol, advance the dot <span class="kw">and</span> add the new dotted rule to the <span class="bu">next</span> position.</span>
<span id="cb57-2949"><a href="#cb57-2949" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Complete<span class="op">**</span>: For each complete dotted rule, find <span class="bu">all</span> incomplete dotted rules that were waiting <span class="cf">for</span> this rule to complete, advance their dots, <span class="kw">and</span> add the new dotted rules to the current position.</span>
<span id="cb57-2950"><a href="#cb57-2950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2951"><a href="#cb57-2951" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s walk through the algorithm with a simple example.</span></span>
<span id="cb57-2952"><a href="#cb57-2952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2953"><a href="#cb57-2953" aria-hidden="true" tabindex="-1"></a><span class="er">## Example: Parsing "unhappiness"</span></span>
<span id="cb57-2954"><a href="#cb57-2954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2955"><a href="#cb57-2955" aria-hidden="true" tabindex="-1"></a>Consider the morphological grammar <span class="kw">and</span> the word <span class="st">"unhappiness"</span> <span class="cf">with</span> segmentation `[<span class="st">"un"</span>, <span class="st">"happy"</span>, <span class="st">"ness"</span>]`:</span>
<span id="cb57-2956"><a href="#cb57-2956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2957"><a href="#cb57-2957" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb57-2958"><a href="#cb57-2958" aria-hidden="true" tabindex="-1"></a>grammar <span class="op">=</span> ContextFreeGrammar(</span>
<span id="cb57-2959"><a href="#cb57-2959" aria-hidden="true" tabindex="-1"></a>    alphabet<span class="op">=</span>{<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>},</span>
<span id="cb57-2960"><a href="#cb57-2960" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>{<span class="st">'Word'</span>, <span class="st">'Adj'</span>, <span class="st">'N'</span>, <span class="st">'Prefix'</span>, <span class="st">'Suffix'</span>},</span>
<span id="cb57-2961"><a href="#cb57-2961" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">=</span>{</span>
<span id="cb57-2962"><a href="#cb57-2962" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'happy'</span>),</span>
<span id="cb57-2963"><a href="#cb57-2963" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Prefix'</span>, <span class="st">'un'</span>),</span>
<span id="cb57-2964"><a href="#cb57-2964" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Suffix'</span>, <span class="st">'ness'</span>),</span>
<span id="cb57-2965"><a href="#cb57-2965" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Adj'</span>, <span class="st">'Prefix'</span>, <span class="st">'Adj'</span>),</span>
<span id="cb57-2966"><a href="#cb57-2966" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'N'</span>, <span class="st">'Adj'</span>, <span class="st">'Suffix'</span>),</span>
<span id="cb57-2967"><a href="#cb57-2967" aria-hidden="true" tabindex="-1"></a>        Rule(<span class="st">'Word'</span>, <span class="st">'N'</span>)</span>
<span id="cb57-2968"><a href="#cb57-2968" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb57-2969"><a href="#cb57-2969" aria-hidden="true" tabindex="-1"></a>    start_variable<span class="op">=</span><span class="st">'Word'</span></span>
<span id="cb57-2970"><a href="#cb57-2970" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-2971"><a href="#cb57-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2972"><a href="#cb57-2972" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parser class</span></span>
<span id="cb57-2973"><a href="#cb57-2973" aria-hidden="true" tabindex="-1"></a>ContextFreeGrammar.parser_class <span class="op">=</span> EarleyParser</span>
<span id="cb57-2974"><a href="#cb57-2974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2975"><a href="#cb57-2975" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the word</span></span>
<span id="cb57-2976"><a href="#cb57-2976" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> grammar([<span class="st">'un'</span>, <span class="st">'happy'</span>, <span class="st">'ness'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb57-2977"><a href="#cb57-2977" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-2978"><a href="#cb57-2978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2979"><a href="#cb57-2979" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s trace the execution of the Earley algorithm:</span></span>
<span id="cb57-2980"><a href="#cb57-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2981"><a href="#cb57-2981" aria-hidden="true" tabindex="-1"></a><span class="er">1. **Position 0 </span>(Start):<span class="op">**</span></span>
<span id="cb57-2982"><a href="#cb57-2982" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Initialize <span class="cf">with</span> `Word <span class="op">-&gt;</span> • N [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2983"><a href="#cb57-2983" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `N <span class="op">-&gt;</span> • Adj Suffix [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2984"><a href="#cb57-2984" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">0</span>,<span class="dv">0</span>]`, `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2985"><a href="#cb57-2985" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">0</span>,<span class="dv">0</span>]`</span>
<span id="cb57-2986"><a href="#cb57-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2987"><a href="#cb57-2987" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Position <span class="dv">0</span> to <span class="dv">1</span> (After seeing <span class="st">"un"</span>):<span class="op">**</span></span>
<span id="cb57-2988"><a href="#cb57-2988" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Scan: `Prefix <span class="op">-&gt;</span> un • [<span class="dv">0</span>,<span class="dv">1</span>]` (complete)</span>
<span id="cb57-2989"><a href="#cb57-2989" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Complete: Use the completed Prefix to advance `Adj <span class="op">-&gt;</span> Prefix • Adj [<span class="dv">0</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2990"><a href="#cb57-2990" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `Adj <span class="op">-&gt;</span> • happy [<span class="dv">1</span>,<span class="dv">1</span>]`, `Adj <span class="op">-&gt;</span> • Prefix Adj [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2991"><a href="#cb57-2991" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `Prefix <span class="op">-&gt;</span> • un [<span class="dv">1</span>,<span class="dv">1</span>]`</span>
<span id="cb57-2992"><a href="#cb57-2992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2993"><a href="#cb57-2993" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Position <span class="dv">1</span> to <span class="dv">2</span> (After seeing <span class="st">"happy"</span>):<span class="op">**</span></span>
<span id="cb57-2994"><a href="#cb57-2994" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Scan: `Adj <span class="op">-&gt;</span> happy • [<span class="dv">1</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-2995"><a href="#cb57-2995" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Complete: Use the completed Adj to advance `Adj <span class="op">-&gt;</span> Prefix Adj • [<span class="dv">0</span>,<span class="dv">2</span>]` (complete)</span>
<span id="cb57-2996"><a href="#cb57-2996" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Complete: Use the completed Adj to advance `N <span class="op">-&gt;</span> Adj • Suffix [<span class="dv">0</span>,<span class="dv">2</span>]`</span>
<span id="cb57-2997"><a href="#cb57-2997" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Predict: Add `Suffix <span class="op">-&gt;</span> • ness [<span class="dv">2</span>,<span class="dv">2</span>]`</span>
<span id="cb57-2998"><a href="#cb57-2998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2999"><a href="#cb57-2999" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>Position <span class="dv">2</span> to <span class="dv">3</span> (After seeing <span class="st">"ness"</span>):<span class="op">**</span></span>
<span id="cb57-3000"><a href="#cb57-3000" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Scan: `Suffix <span class="op">-&gt;</span> ness • [<span class="dv">2</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-3001"><a href="#cb57-3001" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Complete: Use the completed Suffix to advance `N <span class="op">-&gt;</span> Adj Suffix • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-3002"><a href="#cb57-3002" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Complete: Use the completed N to advance `Word <span class="op">-&gt;</span> N • [<span class="dv">0</span>,<span class="dv">3</span>]` (complete)</span>
<span id="cb57-3003"><a href="#cb57-3003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3004"><a href="#cb57-3004" aria-hidden="true" tabindex="-1"></a>Since we have a completed dotted rule <span class="cf">for</span> the start variable `Word` that spans the entire <span class="bu">input</span>, the string <span class="kw">is</span> <span class="kw">in</span> the language generated by the grammar.</span>
<span id="cb57-3005"><a href="#cb57-3005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3006"><a href="#cb57-3006" aria-hidden="true" tabindex="-1"></a>The parse tree would be:</span>
<span id="cb57-3007"><a href="#cb57-3007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3008"><a href="#cb57-3008" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3009"><a href="#cb57-3009" aria-hidden="true" tabindex="-1"></a>    Word</span>
<span id="cb57-3010"><a href="#cb57-3010" aria-hidden="true" tabindex="-1"></a>     <span class="op">|</span></span>
<span id="cb57-3011"><a href="#cb57-3011" aria-hidden="true" tabindex="-1"></a>     N</span>
<span id="cb57-3012"><a href="#cb57-3012" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> <span class="op">\</span></span>
<span id="cb57-3013"><a href="#cb57-3013" aria-hidden="true" tabindex="-1"></a>  Adj  Suffix</span>
<span id="cb57-3014"><a href="#cb57-3014" aria-hidden="true" tabindex="-1"></a> <span class="op">/</span>  \    <span class="op">|</span></span>
<span id="cb57-3015"><a href="#cb57-3015" aria-hidden="true" tabindex="-1"></a>Prefix Adj ness</span>
<span id="cb57-3016"><a href="#cb57-3016" aria-hidden="true" tabindex="-1"></a>  <span class="op">|</span>    <span class="op">|</span></span>
<span id="cb57-3017"><a href="#cb57-3017" aria-hidden="true" tabindex="-1"></a> un  happy</span>
<span id="cb57-3018"><a href="#cb57-3018" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3019"><a href="#cb57-3019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3020"><a href="#cb57-3020" aria-hidden="true" tabindex="-1"></a><span class="co">## Advantages of the Earley Algorithm for Morphological Parsing</span></span>
<span id="cb57-3021"><a href="#cb57-3021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3022"><a href="#cb57-3022" aria-hidden="true" tabindex="-1"></a>The Earley algorithm offers several advantages <span class="cf">for</span> morphological parsing:</span>
<span id="cb57-3023"><a href="#cb57-3023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3024"><a href="#cb57-3024" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Works <span class="cf">with</span> <span class="bu">any</span> CFG<span class="op">**</span>: Unlike CKY, Earley doesn<span class="st">'t require the grammar to be in Chomsky Normal Form, which allows for more natural expression of morphological rules.</span></span>
<span id="cb57-3025"><a href="#cb57-3025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3026"><a href="#cb57-3026" aria-hidden="true" tabindex="-1"></a><span class="er">2. **Handles ambiguity**: Like CKY, Earley can find all possible parses for ambiguous inputs.</span></span>
<span id="cb57-3027"><a href="#cb57-3027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3028"><a href="#cb57-3028" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Left recursion<span class="op">**</span>: Earley can handle left<span class="op">-</span>recursive rules (e.g., `A <span class="op">-&gt;</span> A B`) without modification, which <span class="kw">is</span> important <span class="cf">for</span> certain morphological patterns.</span>
<span id="cb57-3029"><a href="#cb57-3029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3030"><a href="#cb57-3030" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>Incremental processing<span class="op">**</span>: Earley processes the <span class="bu">input</span> left<span class="op">-</span>to<span class="op">-</span>right, which can be useful <span class="cf">for</span> interactive applications <span class="kw">or</span> streaming inputs.</span>
<span id="cb57-3031"><a href="#cb57-3031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3032"><a href="#cb57-3032" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">**</span>Prediction<span class="op">-</span>driven<span class="op">**</span>: Earley only considers rules that are relevant to the current <span class="bu">input</span>, potentially saving work compared to bottom<span class="op">-</span>up approaches like CKY.</span>
<span id="cb57-3033"><a href="#cb57-3033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3034"><a href="#cb57-3034" aria-hidden="true" tabindex="-1"></a><span class="co">## Example: Word Prediction with Earley</span></span>
<span id="cb57-3035"><a href="#cb57-3035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3036"><a href="#cb57-3036" aria-hidden="true" tabindex="-1"></a>One interesting application of the Earley algorithm <span class="kw">is</span> predicting what parts of speech (<span class="kw">and</span> ultimately, what words) could come <span class="bu">next</span> <span class="kw">in</span> a partially formed word. Let<span class="st">'s extend our `EarleyParser` class to support this:</span></span>
<span id="cb57-3037"><a href="#cb57-3037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3038"><a href="#cb57-3038" aria-hidden="true" tabindex="-1"></a><span class="er">```python</span></span>
<span id="cb57-3039"><a href="#cb57-3039" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EarleyParser(EarleyParser):</span>
<span id="cb57-3040"><a href="#cb57-3040" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-3041"><a href="#cb57-3041" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _predict_next_word(<span class="va">self</span>, prefix: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">set</span>[<span class="bu">str</span>]]:</span>
<span id="cb57-3042"><a href="#cb57-3042" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="cb57-3043"><a href="#cb57-3043" aria-hidden="true" tabindex="-1"></a><span class="st">        Predict possible next words given a prefix</span></span>
<span id="cb57-3044"><a href="#cb57-3044" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-3045"><a href="#cb57-3045" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-3046"><a href="#cb57-3046" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-3047"><a href="#cb57-3047" aria-hidden="true" tabindex="-1"></a><span class="st">        prefix : list[str]</span></span>
<span id="cb57-3048"><a href="#cb57-3048" aria-hidden="true" tabindex="-1"></a><span class="st">            The prefix of a word, as a list of morphemes</span></span>
<span id="cb57-3049"><a href="#cb57-3049" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-3050"><a href="#cb57-3050" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-3051"><a href="#cb57-3051" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-3052"><a href="#cb57-3052" aria-hidden="true" tabindex="-1"></a><span class="st">        dict[str, set[str]]</span></span>
<span id="cb57-3053"><a href="#cb57-3053" aria-hidden="true" tabindex="-1"></a><span class="st">            A dictionary mapping parts of speech to possible next morphemes</span></span>
<span id="cb57-3054"><a href="#cb57-3054" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-3055"><a href="#cb57-3055" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill the chart for the prefix</span></span>
<span id="cb57-3056"><a href="#cb57-3056" aria-hidden="true" tabindex="-1"></a>        chart <span class="op">=</span> <span class="va">self</span>._fill_chart(prefix)</span>
<span id="cb57-3057"><a href="#cb57-3057" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-3058"><a href="#cb57-3058" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find all incomplete entries in the final position</span></span>
<span id="cb57-3059"><a href="#cb57-3059" aria-hidden="true" tabindex="-1"></a>        incomplete_entries <span class="op">=</span> {entry <span class="cf">for</span> entry <span class="kw">in</span> chart[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="kw">not</span> entry.is_complete}</span>
<span id="cb57-3060"><a href="#cb57-3060" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-3061"><a href="#cb57-3061" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Group by next expected symbol</span></span>
<span id="cb57-3062"><a href="#cb57-3062" aria-hidden="true" tabindex="-1"></a>        next_symbols <span class="op">=</span> {}</span>
<span id="cb57-3063"><a href="#cb57-3063" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> incomplete_entries:</span>
<span id="cb57-3064"><a href="#cb57-3064" aria-hidden="true" tabindex="-1"></a>            next_symbol <span class="op">=</span> entry.next_symbol</span>
<span id="cb57-3065"><a href="#cb57-3065" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-3066"><a href="#cb57-3066" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the next symbol is a terminal, add it directly</span></span>
<span id="cb57-3067"><a href="#cb57-3067" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-3068"><a href="#cb57-3068" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-3069"><a href="#cb57-3069" aria-hidden="true" tabindex="-1"></a>                    next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-3070"><a href="#cb57-3070" aria-hidden="true" tabindex="-1"></a>                next_symbols[next_symbol].add(next_symbol)</span>
<span id="cb57-3071"><a href="#cb57-3071" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-3072"><a href="#cb57-3072" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the next symbol is a non-terminal, find all terminals it can derive</span></span>
<span id="cb57-3073"><a href="#cb57-3073" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> next_symbol <span class="kw">in</span> <span class="va">self</span>._grammar.variables:</span>
<span id="cb57-3074"><a href="#cb57-3074" aria-hidden="true" tabindex="-1"></a>                <span class="co"># For simplicity, only consider direct terminal derivations</span></span>
<span id="cb57-3075"><a href="#cb57-3075" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> rule <span class="kw">in</span> <span class="va">self</span>._grammar.rules(next_symbol):</span>
<span id="cb57-3076"><a href="#cb57-3076" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> rule.is_unary <span class="kw">and</span> rule.right_side[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>._grammar.alphabet:</span>
<span id="cb57-3077"><a href="#cb57-3077" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> next_symbol <span class="kw">not</span> <span class="kw">in</span> next_symbols:</span>
<span id="cb57-3078"><a href="#cb57-3078" aria-hidden="true" tabindex="-1"></a>                            next_symbols[next_symbol] <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb57-3079"><a href="#cb57-3079" aria-hidden="true" tabindex="-1"></a>                        next_symbols[next_symbol].add(rule.right_side[<span class="dv">0</span>])</span>
<span id="cb57-3080"><a href="#cb57-3080" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-3081"><a href="#cb57-3081" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> next_symbols</span>
<span id="cb57-3082"><a href="#cb57-3082" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3083"><a href="#cb57-3083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3084"><a href="#cb57-3084" aria-hidden="true" tabindex="-1"></a>This method allows us to predict what could come <span class="bu">next</span> <span class="kw">in</span> a word, which <span class="kw">is</span> useful <span class="cf">for</span> applications like auto<span class="op">-</span>completion <span class="kw">or</span> spelling correction.</span>
<span id="cb57-3085"><a href="#cb57-3085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3086"><a href="#cb57-3086" aria-hidden="true" tabindex="-1"></a>For example:</span>
<span id="cb57-3087"><a href="#cb57-3087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3088"><a href="#cb57-3088" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb57-3089"><a href="#cb57-3089" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un"</span></span>
<span id="cb57-3090"><a href="#cb57-3090" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> grammar.parser._predict_next_word([<span class="st">'un'</span>])</span>
<span id="cb57-3091"><a href="#cb57-3091" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Adj': {'happy'}}</span></span>
<span id="cb57-3092"><a href="#cb57-3092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3093"><a href="#cb57-3093" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un happy"</span></span>
<span id="cb57-3094"><a href="#cb57-3094" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> grammar.parser._predict_next_word([<span class="st">'un'</span>, <span class="st">'happy'</span>])</span>
<span id="cb57-3095"><a href="#cb57-3095" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Suffix': {'ness'}}</span></span>
<span id="cb57-3096"><a href="#cb57-3096" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3097"><a href="#cb57-3097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3098"><a href="#cb57-3098" aria-hidden="true" tabindex="-1"></a><span class="co">## Real-World Example: CELEX Data</span></span>
<span id="cb57-3099"><a href="#cb57-3099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3100"><a href="#cb57-3100" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s revisit our "unbelievably" example from CELEX:</span></span>
<span id="cb57-3101"><a href="#cb57-3101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3102"><a href="#cb57-3102" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb57-3103"><a href="#cb57-3103" aria-hidden="true" tabindex="-1"></a><span class="er">((((un)[Prefix] (believe)[V])[V] (able)[Suffix])[Adj] (ly)[Suffix])[Adv]</span></span>
<span id="cb57-3104"><a href="#cb57-3104" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb57-3105"><a href="#cb57-3105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3106"><a href="#cb57-3106" aria-hidden="true" tabindex="-1"></a><span class="er">With the Earley algorithm, we can parse this complex structure without converting to CNF:</span></span>
<span id="cb57-3107"><a href="#cb57-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3108"><a href="#cb57-3108" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb57-3109"><a href="#cb57-3109" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract grammar from CELEX</span></span>
<span id="cb57-3110"><a href="#cb57-3110" aria-hidden="true" tabindex="-1"></a>celex_grammar <span class="op">=</span> ContextFreeGrammar.from_treebank(celex_parses)</span>
<span id="cb57-3111"><a href="#cb57-3111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3112"><a href="#cb57-3112" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse a specific word</span></span>
<span id="cb57-3113"><a href="#cb57-3113" aria-hidden="true" tabindex="-1"></a>parses <span class="op">=</span> celex_grammar([<span class="st">'un'</span>, <span class="st">'believe'</span>, <span class="st">'able'</span>, <span class="st">'ly'</span>], mode<span class="op">=</span><span class="st">"parse"</span>)</span>
<span id="cb57-3114"><a href="#cb57-3114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> parse <span class="kw">in</span> parses:</span>
<span id="cb57-3115"><a href="#cb57-3115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(parse)</span>
<span id="cb57-3116"><a href="#cb57-3116" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3117"><a href="#cb57-3117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3118"><a href="#cb57-3118" aria-hidden="true" tabindex="-1"></a>We can also predict what might follow partial words:</span>
<span id="cb57-3119"><a href="#cb57-3119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3120"><a href="#cb57-3120" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb57-3121"><a href="#cb57-3121" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict what could follow "un believe"</span></span>
<span id="cb57-3122"><a href="#cb57-3122" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> celex_grammar.parser._predict_next_word([<span class="st">'un'</span>, <span class="st">'believe'</span>])</span>
<span id="cb57-3123"><a href="#cb57-3123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predictions)  <span class="co"># Might output {'Suffix': {'able', 'er', 'ing', ...}}</span></span>
<span id="cb57-3124"><a href="#cb57-3124" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb57-3125"><a href="#cb57-3125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3126"><a href="#cb57-3126" aria-hidden="true" tabindex="-1"></a><span class="co">## Comparison with CKY</span></span>
<span id="cb57-3127"><a href="#cb57-3127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3128"><a href="#cb57-3128" aria-hidden="true" tabindex="-1"></a>Both CKY <span class="kw">and</span> Earley are powerful parsing algorithms <span class="cf">with</span> different strengths:</span>
<span id="cb57-3129"><a href="#cb57-3129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3130"><a href="#cb57-3130" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Feature <span class="op">|</span> CKY <span class="op">|</span> Earley <span class="op">|</span></span>
<span id="cb57-3131"><a href="#cb57-3131" aria-hidden="true" tabindex="-1"></a><span class="op">|---------|-----|--------|</span></span>
<span id="cb57-3132"><a href="#cb57-3132" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Grammar <span class="bu">format</span> <span class="op">|</span> Requires CNF <span class="op">|</span> Any CFG <span class="op">|</span></span>
<span id="cb57-3133"><a href="#cb57-3133" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Parsing direction <span class="op">|</span> Bottom<span class="op">-</span>up <span class="op">|</span> Top<span class="op">-</span>down <span class="cf">with</span> bottom<span class="op">-</span>up filtering <span class="op">|</span></span>
<span id="cb57-3134"><a href="#cb57-3134" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Left recursion <span class="op">|</span> Handles it by design <span class="op">|</span> Handles it by design <span class="op">|</span></span>
<span id="cb57-3135"><a href="#cb57-3135" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Time complexity <span class="op">|</span> O(n³ \<span class="op">*</span> \<span class="op">|</span>V\<span class="op">|</span>²) <span class="op">|</span> O(n³) worst case, O(n²) <span class="cf">for</span> unambiguous <span class="op">|</span></span>
<span id="cb57-3136"><a href="#cb57-3136" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Space complexity <span class="op">|</span> O(n² \<span class="op">*</span> \<span class="op">|</span>V\<span class="op">|</span>) <span class="op">|</span> O(n²) <span class="op">|</span></span>
<span id="cb57-3137"><a href="#cb57-3137" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Incremental <span class="op">|</span> No <span class="op">|</span> Yes <span class="op">|</span></span>
<span id="cb57-3138"><a href="#cb57-3138" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Prediction <span class="op">|</span> Limited <span class="op">|</span> Strong <span class="op">|</span></span>
<span id="cb57-3139"><a href="#cb57-3139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3140"><a href="#cb57-3140" aria-hidden="true" tabindex="-1"></a>For morphological parsing, both algorithms are effective, but Earley<span class="st">'s ability to work with any CFG and its incremental nature make it particularly well-suited for morphological applications.</span></span>
<span id="cb57-3141"><a href="#cb57-3141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3142"><a href="#cb57-3142" aria-hidden="true" tabindex="-1"></a><span class="er">## Conclusion</span></span>
<span id="cb57-3143"><a href="#cb57-3143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3144"><a href="#cb57-3144" aria-hidden="true" tabindex="-1"></a>The Earley algorithm <span class="kw">is</span> a powerful tool <span class="cf">for</span> morphological parsing, offering flexibility <span class="kw">and</span> efficiency. Its ability to work <span class="cf">with</span> <span class="bu">any</span> context<span class="op">-</span>free grammar, handle ambiguity, <span class="kw">and</span> process <span class="bu">input</span> incrementally makes it well<span class="op">-</span>suited <span class="cf">for</span> morphological analysis.</span>
<span id="cb57-3145"><a href="#cb57-3145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3146"><a href="#cb57-3146" aria-hidden="true" tabindex="-1"></a>In this module, we<span class="st">'ve explored the formal definition of context-free grammars, operations on grammars, normal forms, and two powerful parsing algorithms: CKY and Earley. These tools provide a solid foundation for computational morphology, allowing us to model and analyze the complex structure of words in natural languages.</span></span>
<span id="cb57-3147"><a href="#cb57-3147" aria-hidden="true" tabindex="-1"></a><span class="er">dotted_rule.is_complete</span></span>
<span id="cb57-3148"><a href="#cb57-3148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-3149"><a href="#cb57-3149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complete(<span class="va">self</span>, entry: <span class="st">'EarleyChartEntry'</span>, new_left_edge: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="st">'EarleyChartEntry'</span>:</span>
<span id="cb57-3150"><a href="#cb57-3150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""Complete this entry with another entry</span></span>
<span id="cb57-3151"><a href="#cb57-3151" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb57-3152"><a href="#cb57-3152" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters</span></span>
<span id="cb57-3153"><a href="#cb57-3153" aria-hidden="true" tabindex="-1"></a><span class="st">        ----------</span></span>
<span id="cb57-3154"><a href="#cb57-3154" aria-hidden="true" tabindex="-1"></a><span class="st">        entry : EarleyChartEntry</span></span>
<span id="cb57-3155"><a href="#cb57-3155" aria-hidden="true" tabindex="-1"></a><span class="st">            The entry that completes this one</span></span>
<span id="cb57-3156"><a href="#cb57-3156" aria-hidden="true" tabindex="-1"></a><span class="st">        new_left_edge : int</span></span>
<span id="cb57-3157"><a href="#cb57-3157" aria-hidden="true" tabindex="-1"></a><span class="st">            The new left edge of the span</span></span>
<span id="cb57-3158"><a href="#cb57-3158" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb57-3159"><a href="#cb57-3159" aria-hidden="true" tabindex="-1"></a><span class="st">        Returns</span></span>
<span id="cb57-3160"><a href="#cb57-3160" aria-hidden="true" tabindex="-1"></a><span class="st">        -------</span></span>
<span id="cb57-3161"><a href="#cb57-3161" aria-hidden="true" tabindex="-1"></a><span class="st">        EarleyChartEntry</span></span>
<span id="cb57-3162"><a href="#cb57-3162" aria-hidden="true" tabindex="-1"></a><span class="st">            A new entry with the dot advanced</span></span>
<span id="cb57-3163"><a href="#cb57-3163" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span></span>
<span id="cb57-3164"><a href="#cb57-3164" aria-hidden="true" tabindex="-1"></a>        new_dotted_rule <span class="op">=</span> <span class="va">self</span>._dotted_rule.complete(new_left_edge)</span>
<span id="cb57-3165"><a href="#cb57-3165" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-3166"><a href="#cb57-3166" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> (<span class="va">self</span>._dotted_rule.next_symbol, <span class="va">self</span>._dotted_rule.span[<span class="dv">1</span>])</span>
<span id="cb57-3167"><a href="#cb57-3167" aria-hidden="true" tabindex="-1"></a>        backpointers <span class="op">=</span> <span class="va">self</span>._backpointers <span class="op">+</span> (bp,)</span>
<span id="cb57-3168"><a href="#cb57-3168" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-3169"><a href="#cb57-3169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Earley</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>